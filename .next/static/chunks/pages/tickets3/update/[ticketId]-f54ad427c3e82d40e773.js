_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[144],{"8Skl":function(e,t,a){"use strict";var c=a("VTBJ"),n=a("q1tI"),i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M884 256h-75c-5.1 0-9.9 2.5-12.9 6.6L512 654.2 227.9 262.6c-3-4.1-7.8-6.6-12.9-6.6h-75c-6.5 0-10.3 7.4-6.5 12.7l352.6 486.1c12.8 17.6 39 17.6 51.7 0l352.6-486.1c3.9-5.3.1-12.7-6.4-12.7z"}}]},name:"down",theme:"outlined"},l=a("6VBw"),s=function(e,t){return n.createElement(l.a,Object(c.a)(Object(c.a)({},e),{},{ref:t,icon:i}))};s.displayName="DownOutlined";t.a=n.forwardRef(s)},URSO:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets3/update/[ticketId]",function(){return a("qL5E")}])},qL5E:function(e,t,a){"use strict";a.r(t),a.d(t,"__N_SSP",(function(){return L}));var c=a("h0/l"),n=a.n(c),i=a("nKUr"),l=a("rmht"),s=a.n(l),r=a("iJl9"),o=a.n(r),d=a("wXtC"),u=a.n(d),b=a("FAat"),j=a.n(b),m=a("MM9K"),p=a.n(m),h=a("4IMT"),x=a.n(h),f=a("rR1Q"),O=a.n(f),_=a("rePB"),k=a("o0o1"),g=a.n(k),y=a("KQm4"),v=a("HaE+"),N=a("qu0K"),w=a.n(N),P=a("ODXe"),S=a("MX0m"),T=a.n(S),C=a("20a2"),D=a("q1tI"),I=a("YFqc"),q=a.n(I),E=a("8Skl"),B=a("ye1Q"),M=a("z7Xi"),V=a("/MfK"),F=a("vgPz"),J=a("wd/R"),R=a.n(J),A=a("ZV7/"),K=a("g6Xq"),z=a.n(K);function U(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,c)}return a}function X(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?U(Object(a),!0).forEach((function(t){Object(_.a)(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):U(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var L=!0;t.default=function(e){var t=e.initProps,a=e.dataProfile,c=e.sidemenu,l=e.ticketid,r=Object(C.useRouter)(),d=r.pathname.split("/").slice(1);d.splice(1,1),d[d.length-1]="Ubah Ticket";var b=w.a.useForm(),m=Object(P.a)(b,1)[0],h=Object(D.useState)({id:Number(l),requester_id:null,raised_at:null,closed_at:null,product_type:null,product_id:"",pic_name:"",pic_contact:"",location_id:null,problem:"",incident_time:null,files:[],description:""}),f=h[0],k=h[1],N=Object(D.useState)({ticket:{id:Number(l),raised_at:"",closed_at:"",original_closed_at:"",resolve_time:"",type:{id:null,name:"",code:""},status:{id:null,name:""},requester:{id:null,name:"",company_id:null,company:{id:null,parent_id:null,name:"",image_logo:"-",phone_number:"-",address:"-",role:null,is_enabled:!0,singkatan:"-",tanggal_pkp:"",penanggung_jawab:"-",npwp:"-",fax:"-",email:"-",website:"-",deleted_at:null}},ticketable:{id:null,product_type:null,product_id:"",pic_name:"",pic_contact:"",location_id:null,inventory_id:null,location:{company_id:null,company_name:""},problem:"",incident_time:"",files:[""],description:"",deleted_at:null},assignable:{id:null,name:""}}}),S=(N[0],N[1],Object(D.useState)({status_ticket:[],incident_type:[],requesters:[],requester_companies:[],companies:{data:[{id:0,title:"",key:"",value:0}]}})),I=S[0],J=S[1],K=Object(D.useState)([]),U=K[0],L=K[1],G=Object(D.useState)(!0),W=G[0],Q=G[1],Y=Object(D.useState)(!1),$=Y[0],H=Y[1],Z=Object(D.useState)(!1),ee=Z[0],te=Z[1],ae=Object(D.useState)([]),ce=ae[0],ne=ae[1],ie=Object(D.useState)(""),le=ie[0],se=ie[1],re=Object(D.useState)(!1),oe=re[0],de=re[1],ue=Object(D.useState)(-1),be=ue[0],je=ue[1],me=Object(D.useState)(null),pe=me[0],he=me[1],xe=Object(D.useState)(0),fe=xe[0],Oe=xe[1],_e=Object(D.useState)(!1),ke=_e[0],ge=_e[1],ye=function(){var e=Object(v.a)(g.a.mark((function e(t){var a,c,n,i;return g.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return de(!0),se("pointer-events-none"),a=t.target.files,(c=new FormData).append("file",a[0]),c.append("upload_preset","migsys"),e.next=8,fetch("https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload",{method:"POST",body:c});case 8:return n=e.sent,e.next=11,n.json();case 11:i=e.sent,he(i.secure_url),ne([].concat(Object(y.a)(ce),[i.secure_url])),je((function(e){return e+1})),de(!1),se("");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(D.useEffect)((function(){fetch("https://boiling-thicket-46501.herokuapp.com/getTicket?id=".concat(l),{method:"GET",headers:{Authorization:JSON.parse(t)}}).then((function(e){return e.json()})).then((function(e){var t={id:Number(l),requester_id:0===e.data.ticket.requester.id?null:e.data.ticket.requester.id,raised_at:e.data.ticket.original_raised_at,closed_at:e.data.ticket.closed_at,product_type:e.data.ticket.ticketable.product_type.id,product_id:e.data.ticket.ticketable.product_id,pic_name:e.data.ticket.ticketable.pic_name,pic_contact:e.data.ticket.ticketable.pic_contact,location_id:0===e.data.ticket.ticketable.location_id?null:e.data.ticket.ticketable.location_id,problem:e.data.ticket.ticketable.problem,incident_time:e.data.ticket.ticketable.incident_time,files:e.data.ticket.ticketable.files,description:e.data.ticket.ticketable.description};return k(t),ne(e.data.ticket.ticketable.files),ge(null===e.data.ticket.closed_at),Oe(e.data.ticket.requester.company.full_name),e.data.ticket.requester.company.id})).then((function(e){fetch("https://boiling-thicket-46501.herokuapp.com/getTicketRelation",{method:"GET",headers:{Authorization:JSON.parse(t)}}).then((function(e){return e.json()})).then((function(e){J(e.data),Q(!1)}))}))}),[]),Object(D.useEffect)((function(){fetch("https://boiling-thicket-46501.herokuapp.com/getFilterUsers",{method:"GET",headers:{Authorization:JSON.parse(t)}}).then((function(e){return e.json()})).then((function(e){L(e.data)}))}),[]),Object(D.useEffect)((function(){-1!==be&&k((function(e){var t=e;return t.files.push(pe),t}))}),[be]),Object(i.jsx)(A.a,{dataProfile:a,sidemenu:c,tok:t,st:z.a,pathArr:d,children:Object(i.jsxs)("div",{className:"w-full h-auto grid grid-cols-1 md:grid-cols-4",id:"createAssetsWrapper",children:[Object(i.jsx)("div",{className:" col-span-1 md:col-span-4 mb-8 p-3 z-20",children:Object(i.jsx)(F.a,{containerSelectorFocus:"#createAgentsWrapper",children:Object(i.jsxs)("div",{className:" col-span-4 flex justify-between pt-4 border-t-2 border-b-2 bg-white",children:[Object(i.jsx)("h1",{className:"font-semibold py-2",children:"Form Ubah Ticket"}),Object(i.jsxs)("div",{className:"flex space-x-2",children:[Object(i.jsx)(q.a,{href:"/tickets/detail/".concat(l),children:Object(i.jsx)(x.a,{type:"default",children:"Batal"})}),Object(i.jsx)(x.a,{disabled:$,loading:ee,type:"primary",onClick:function(){m.submit()},children:"Simpan"})]})]})})}),Object(i.jsx)("div",{className:"col-span-1 md:col-span-4 mb-6 py-3 px-16",children:W?Object(i.jsx)("div",{className:"flex justify-center",children:Object(i.jsx)(p.a,{})}):Object(i.jsxs)(i.Fragment,{children:[Object(i.jsxs)("div",{className:"shadow-md border py-5 px-10 flex flex-col rounded-md mb-5",children:[Object(i.jsxs)("div",{className:"jsx-2088094432 flex flex-col mb-5",children:[Object(i.jsxs)("div",{className:"jsx-2088094432 flex mb-2",children:[Object(i.jsx)("span",{className:"jsx-2088094432 raisedBy"}),Object(i.jsx)("p",{className:"jsx-2088094432 mb-0 ml-1",children:"Ticket Raised By"})]}),Object(i.jsx)(j.a,{placeholder:"Pilih Raised By",defaultValue:f.requester_id,onChange:function(e,t){k(X(X({},f),{},{requester_id:Number(e)})),Oe(t.company_name)},children:U.map((function(e,t){return Object(i.jsx)(j.a.Option,{value:e.id,company_name:null===e.company?"-":e.company.name,children:e.name},t)}))}),Object(i.jsx)(T.a,{id:"2088094432",children:[".raisedBy.jsx-2088094432::before{content:'*';color:red;}"]})]}),Object(i.jsxs)("div",{className:"jsx-2088094432 flex flex-col mb-5",children:[Object(i.jsxs)("div",{className:"jsx-2088094432 flex mb-2",children:[Object(i.jsx)("span",{className:"jsx-2088094432 raisedBy"}),Object(i.jsx)("p",{className:"jsx-2088094432 mb-0 ml-1",children:"Lokasi Pembuat"})]}),Object(i.jsxs)("div",{className:"jsx-2088094432 w-full rounded-sm flex items-center justify-between bg-gray-100 border p-2 h-8",children:[Object(i.jsx)("p",{className:"jsx-2088094432 mb-0",children:fe}),Object(i.jsx)(E.a,{style:{color:"rgb(213,214,196)"}})]}),Object(i.jsx)(T.a,{id:"2088094432",children:[".raisedBy.jsx-2088094432::before{content:'*';color:red;}"]})]}),Object(i.jsxs)("div",{className:"jsx-2088094432 flex flex-col mb-5",children:[Object(i.jsxs)("div",{className:"jsx-2088094432 flex mb-2",children:[Object(i.jsx)("span",{className:"jsx-2088094432 raisedBy"}),Object(i.jsx)("p",{className:"jsx-2088094432 mb-0 ml-1",children:"Date Raised Ticket"})]}),Object(i.jsx)(u.a,{allowClear:!1,value:""===f.raised_at?null:R()(f.raised_at),defaultValue:R()(f.raised_at),showTime:!0,style:{width:"100%"},onChange:function(e,t){k(X(X({},f),{},{raised_at:t}))}}),Object(i.jsx)(T.a,{id:"2088094432",children:[".raisedBy.jsx-2088094432::before{content:'*';color:red;}"]})]}),Object(i.jsxs)("div",{className:"jsx-4250785741 flex flex-col mb-5",children:[Object(i.jsxs)("div",{className:"jsx-4250785741 flex mb-2",children:[Object(i.jsx)("span",{className:"jsx-4250785741 closedBy"}),Object(i.jsx)("p",{className:"jsx-4250785741 mb-0 ml-1",children:"Date Closed Ticket"})]}),Object(i.jsx)(u.a,{disabled:ke,disabledDate:function(e){return e<R()(f.raised_at)},value:null===f.closed_at||""===f.closed_at?null:R()(f.closed_at),defaultValue:null===f.closed_at?null:R()(f.closed_at),placeholder:"Masukkan Date Closed",showTime:!0,allowClear:!1,style:{width:"100%"},onChange:function(e,t){""===t?(k(X(X({},f),{},{closed_at:""})),H(!0)):(k(X(X({},f),{},{closed_at:t})),H(!1))}}),ke?Object(i.jsxs)("p",{className:"jsx-4250785741 mb-0 text-red-500",children:["Date closed dapat dirubah jika status ticket telah ",Object(i.jsx)("strong",{className:"jsx-4250785741",children:"closed"})]}):null,Object(i.jsx)(T.a,{id:"4250785741",children:[".closedBy.jsx-4250785741::before{content:'*';color:red;}"]})]})]}),Object(i.jsx)("div",{className:"shadow-md border py-5 px-10 flex flex-col rounded-md mb-5",children:Object(i.jsxs)(w.a,{form:m,layout:"vertical",onFinish:function(){te(!0),fetch("https://boiling-thicket-46501.herokuapp.com/updateTicket",{method:"PUT",headers:{Authorization:JSON.parse(t),"Content-Type":"application/json"},body:JSON.stringify(X(X({},f),{},Object(_.a)({},"location_id",null===f.location_id?0:f.location_id)))}).then((function(e){return e.json()})).then((function(e){te(!1),e.success?(O.a.success({message:"Ticket berhasil diubah",duration:3}),r.push("/tickets/detail/".concat(l))):e.success||O.a.error({message:e.message,duration:3})}))},initialValues:f,children:[Object(i.jsx)(w.a.Item,{name:"product_type",label:"Jenis Produk",rules:[{required:!0,message:"Jenis Produk wajib dipilih"}],children:Object(i.jsxs)(j.a,{defaultValue:f.product_type,placeholder:"Pilih Produk",onChange:function(e){k(X(X({},f),{},{product_type:e}))},children:[Object(i.jsx)(j.a.Option,{value:1,children:"UPS"}),Object(i.jsx)(j.a.Option,{value:2,children:"ATM"}),Object(i.jsx)(j.a.Option,{value:3,children:"PC"})]})}),Object(i.jsx)(w.a.Item,{name:"product_id",label:2===f.product_type?"Terminal ID":"ID Produk",rules:[{required:!0,message:"".concat(2===f.product_type?"Terminal ID":"ID Produk"," wajib diisi")},{pattern:/(\-)|(^\d*$)/,message:"".concat(2===f.product_type?"Terminal ID":"ID Produk"," harus berisi angka")}],children:Object(i.jsx)(o.a,{defaultValue:f.product_id,placeholder:"Masukkan ".concat(2===f.product_type?"Terminal ID":"ID Produk"),onChange:function(e){k(X(X({},f),{},{product_id:Number(e.target.value)}))}})}),Object(i.jsx)(w.a.Item,{name:"pic_name",label:"Nama PIC",children:Object(i.jsx)(o.a,{value:f.pic_name,defaultValue:f.pic_name,placeholder:"Masukkan Problem",onChange:function(e){k(X(X({},f),{},{pic_name:e.target.value}))}})}),Object(i.jsx)(w.a.Item,{name:"pic_contact",label:"Kontak PIC",rules:[{pattern:/(\-)|(^\d*$)/,message:"Kontak harus berisi angka"}],children:Object(i.jsx)(o.a,{value:f.pic_contact,defaultValue:f.pic_contact,placeholder:"Masukkan Problem",onChange:function(e){k(X(X({},f),{},{pic_contact:e.target.value}))}})}),Object(i.jsx)(w.a.Item,{name:"location_id",label:"Lokasi Problem",children:Object(i.jsx)(s.a,{value:f.location_id,defaultValue:f.location_id,placeholder:"Pilih Lokasi Problem",treeData:[I.companies],treeDefaultExpandAll:!0,onChange:function(e,t,a){k(X(X({},f),{},{location_id:a.allCheckedNodes[0].node.props.id}))}})}),Object(i.jsx)(w.a.Item,{name:"problem",label:"Problem",children:Object(i.jsx)(o.a,{value:f.problem,defaultValue:f.problem,placeholder:"Masukkan Problem",onChange:function(e){k(X(X({},f),{},{problem:e.target.value}))}})}),Object(i.jsxs)("div",{className:"mb-5 flex flex-col",children:[Object(i.jsx)("div",{className:"flex mb-2",children:Object(i.jsx)("p",{className:"mb-0 ml-1",children:"Waktu Kejadian"})}),Object(i.jsx)(u.a,{defaultValue:null===f.incident_time?null:R()(f.incident_time),name:"incident_time",showTime:!0,placeholder:"Masukkan Waktu Kejadian",style:{width:"100%"},onChange:function(e,t){k(X(X({},f),{},{incident_time:""===t?null:t}))}})]}),Object(i.jsx)(w.a.Item,{children:Object(i.jsxs)("div",{className:"flex flex-col",children:[Object(i.jsx)("p",{className:"mb-2 ml-1",children:"Bukti Incident (Support File: PNG/JPEG, PDF, dan Word)"}),Object(i.jsxs)("label",{className:"custom-file-upload py-2 w-52 px-2 inline-block cursor-pointer text-sm text-black border rounded-sm bg-white hover:border-blue-500 hover:text-blue-500 mb-3 ".concat(le),children:[Object(i.jsx)("input",{type:"file",style:{display:"none"},name:"urlgambarProduct",onChange:ye}),oe?Object(i.jsx)(B.a,{style:{marginRight:"1rem"}}):Object(i.jsxs)(i.Fragment,{children:[" ",Object(i.jsx)(M.a,{style:{marginRight:"1rem"}})]}),"Unggah File(Max: 25Mb)"]}),Object(i.jsx)("div",{className:"flex flex-col",children:ce.map((function(e,t){return Object(i.jsxs)("div",{className:"border border-dashed px-8 py-4 flex justify-between items-center w-6/12 mb-1 relative cursor-pointer hover:text-blue-500",children:[Object(i.jsx)("div",{className:"mr-5 flex items-center",children:Object(i.jsx)("img",{src:e,alt:"imageProfile",className:" object-cover w-16 h-16 mr-10"})}),Object(i.jsx)("div",{className:"flex items-center",children:Object(i.jsx)(n.a,{title:"Yakin ingin menghapus bukti incident ini?",onConfirm:function(){ne((function(e){return e.filter((function(e,a){return a!==t}))})),k((function(e){var a=e;return a.files.splice(t,1),a}))},okText:"Ya",cancelText:"Tidak",children:Object(i.jsx)(V.a,{style:{color:"red",cursor:"pointer",fontSize:"1.5rem"}})})})]},t)}))})]})}),Object(i.jsx)(w.a.Item,{name:"description",label:"Deskripsi Kerusakan",children:Object(i.jsx)(o.a.TextArea,{value:f.description,defaultValue:f.description,rows:4,placeholder:"Masukkan deskripsi kerusakan",onChange:function(e){k(X(X({},f),{},{description:e.target.value}))}})})]})})]})})]})})}}},[["URSO",0,2,18,1,3,4,5,6,7,8,9,10,12,16,19,20,42]]]);