_N_E=(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[139],{RZLj:function(e,t,n){"use strict";n.r(t),n.d(t,"__N_SSP",(function(){return A}));var a=n("h0/l"),c=n.n(a),r=n("nKUr"),i=n("wXtC"),s=n.n(i),l=n("rmht"),o=n.n(l),d=n("iJl9"),u=n.n(d),p=n("cpVT"),b=n("FAat"),j=n.n(b),m=n("4IMT"),h=n.n(m),O=n("rR1Q"),x=n.n(O),f=n("vJKn"),k=n.n(f),g=n("rg98"),v=n("qu0K"),y=n.n(v),_=n("xvhg"),P=n("MX0m"),w=n.n(P),N=n("20a2"),T=n("q1tI"),I=(n("YFqc"),n("ye1Q")),S=n("z7Xi"),C=n("/MfK"),D=n("vgPz"),F=n("ZV7/"),E=n("g6Xq"),M=n.n(E);function J(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function q(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?J(Object(n),!0).forEach((function(t){Object(p.a)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):J(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var A=!0;t.default=function(e){var t=e.initProps,n=e.sidemenu,a=e.dataProfile,i=Object(N.useRouter)(),l=i.pathname.split("/").slice(1);l.splice(3,1),l[l.length-1]="Tambah Ticket";var d=y.a.useForm(),p=Object(_.a)(d,1)[0],b=Object(T.useState)({type_id:1,product_type:null,product_id:null,pic_name:"",pic_contact:"",location_id:0,problem:"",incident_time:null,files:[],description:""}),m=b[0],O=b[1],f=Object(T.useState)({status_ticket:[],incident_type:[],requesters:[],requester_companies:[],companies:{data:[{id:0,title:"",key:"",value:0}]}}),v=f[0],P=f[1],E=Object(T.useState)([]),J=E[0],A=E[1],K=Object(T.useState)(""),R=K[0],X=K[1],W=Object(T.useState)(!1),z=W[0],L=W[1],G=Object(T.useState)(!1),U=G[0],V=(G[1],Object(T.useState)(!1)),Y=V[0],Z=V[1],B=Object(T.useState)(-1),Q=B[0],$=B[1],H=Object(T.useState)(null),ee=H[0],te=H[1],ne=function(){var e=Object(g.a)(k.a.mark((function e(t){var n,a,c,r;return k.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(!0),X("pointer-events-none"),n=t.target.files,(a=new FormData).append("file",n[0]),a.append("upload_preset","migsys"),e.next=8,fetch("https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload",{method:"POST",body:a});case 8:return c=e.sent,e.next=11,c.json();case 11:r=e.sent,te(r.secure_url),A((function(e){var t=e;return t.push({url:r.secure_url,name:n[0].name}),t})),$((function(e){return e+1})),Z(!1),X("");case 17:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(T.useEffect)((function(){fetch("https://boiling-thicket-46501.herokuapp.com/".concat(1===a.data.role?"getTicketRelation":"getClientTicketRelation"),{method:"GET",headers:{Authorization:JSON.parse(t)}}).then((function(e){return e.json()})).then((function(e){P(e.data)}))}),[]),Object(T.useEffect)((function(){-1!==Q&&O((function(e){var t=e;return t.files.push(ee),t}))}),[Q]),Object(r.jsx)(F.a,{dataProfile:a,sidemenu:n,tok:t,st:M.a,pathArr:l,children:Object(r.jsxs)("div",{className:"w-full h-auto grid grid-cols-1 md:grid-cols-4",id:"createAssetsWrapper",children:[Object(r.jsx)("div",{className:" col-span-1 md:col-span-4 mb-8 p-3 z-20",children:Object(r.jsx)(D.a,{containerSelectorFocus:"#createAgentsWrapper",children:Object(r.jsxs)("div",{className:" col-span-4 flex justify-between pt-4 border-t-2 border-b-2 bg-white",children:[Object(r.jsx)("h1",{className:"font-semibold py-2",children:"Form Tambah Ticket"}),Object(r.jsxs)("div",{className:"flex space-x-2",children:[Object(r.jsx)(h.a,{type:"default",onClick:function(){i.push("/tickets")},children:"Batal"}),Object(r.jsx)(h.a,{disabled:U,loading:z,type:"primary",onClick:function(){p.submit()},children:"Simpan"})]})]})})}),Object(r.jsxs)("div",{className:"col-span-1 md:col-span-4 mb-6 py-3 px-16",children:[Object(r.jsxs)("div",{className:"jsx-1783008176 shadow-md border py-5 px-10 flex flex-col rounded-md mb-5",children:[Object(r.jsxs)("div",{className:"jsx-1783008176 flex mb-2",children:[Object(r.jsx)("span",{className:"jsx-1783008176 judulField"}),Object(r.jsx)("p",{className:"jsx-1783008176 mb-0 ml-1",children:"Ticket Type"})]}),Object(r.jsx)(j.a,{value:m.type,defaultValue:1,children:Object(r.jsx)(j.a.Option,{value:1,children:"Incident"})}),Object(r.jsx)(w.a,{id:"1783008176",children:[".judulField.jsx-1783008176::before{content:'*';color:red;}"]})]}),Object(r.jsx)("div",{className:"shadow-md border py-5 px-10 flex flex-col rounded-md mb-5",children:Object(r.jsxs)(y.a,{form:p,layout:"vertical",onFinish:function(){L(!0),fetch("https://boiling-thicket-46501.herokuapp.com/addTicket",{method:"POST",headers:{Authorization:JSON.parse(t),"Content-Type":"application/json"},body:JSON.stringify(m)}).then((function(e){return e.json()})).then((function(e){L(!1),e.success?(x.a.success({message:"Ticket berhasil ditambahkan",duration:3}),i.push("/tickets/detail/".concat(e.id))):e.success||x.a.error({message:e.message,duration:3})}))},children:[Object(r.jsx)(y.a.Item,{name:"product_type",label:"Jenis Produk",rules:[{required:!0,message:"Jenis Produk wajib dipilih"}],children:Object(r.jsxs)(j.a,{placeholder:"Pilih Produk",onChange:function(e){O(q(q({},m),{},{product_type:e}))},children:[Object(r.jsx)(j.a.Option,{value:1,children:"UPS"}),Object(r.jsx)(j.a.Option,{value:2,children:"ATM"}),Object(r.jsx)(j.a.Option,{value:3,children:"PC"})]})}),Object(r.jsx)(y.a.Item,{name:"product_id",label:2===m.product_type?"Terminal ID":"ID Produk",rules:[{required:!0,message:"".concat(2===m.product_type?"Terminal ID":"ID Produk"," wajib diisi")},{pattern:/(\-)|(^\d*$)/,message:"".concat(2===m.product_type?"Terminal ID":"ID Produk"," harus berisi angka")}],children:Object(r.jsx)(u.a,{placeholder:"Masukkan ".concat(2===m.product_type?"Terminal ID":"ID Produk"),onChange:function(e){O(q(q({},m),{},{product_id:Number(e.target.value)}))}})}),Object(r.jsx)(y.a.Item,{name:"pic_name",label:"Nama PIC",children:Object(r.jsx)(u.a,{placeholder:"Masukkan Problem",onChange:function(e){O(q(q({},m),{},{pic_name:e.target.value}))}})}),Object(r.jsx)(y.a.Item,{name:"pic_contact",label:"Kontak PIC",rules:[{pattern:/(\-)|(^\d*$)/,message:"Kontak harus berisi angka"}],children:Object(r.jsx)(u.a,{placeholder:"Masukkan Problem",onChange:function(e){O(q(q({},m),{},{pic_contact:e.target.value}))}})}),Object(r.jsx)(y.a.Item,{name:"location_id",label:"Lokasi Problem",children:Object(r.jsx)(o.a,{placeholder:"Pilih Lokasi Problem",treeData:1===a.data.role?[v.companies]:[v.companies.data],treeDefaultExpandAll:!0,onChange:function(e,t,n){O(q(q({},m),{},{location_id:n.allCheckedNodes[0].node.props.id}))}})}),Object(r.jsx)(y.a.Item,{name:"problem",label:"Problem",children:Object(r.jsx)(u.a,{placeholder:"Masukkan Problem",onChange:function(e){O(q(q({},m),{},{problem:e.target.value}))}})}),Object(r.jsx)(y.a.Item,{name:"incident_time",label:"Waktu Kejadian",children:Object(r.jsx)(s.a,{showTime:!0,placeholder:"Masukkan Waktu Kejadian",style:{width:"100%"},onChange:function(e,t){O(q(q({},m),{},{incident_time:t}))}})}),Object(r.jsx)(y.a.Item,{children:Object(r.jsxs)("div",{className:"flex flex-col",children:[Object(r.jsx)("p",{className:"mb-2 ml-1",children:"Bukti Incident (Support File: PNG/JPEG, PDF, dan Word)"}),Object(r.jsxs)("label",{className:"custom-file-upload py-2 w-52 px-2 inline-block cursor-pointer text-sm text-black border rounded-sm bg-white hover:border-blue-500 hover:text-blue-500 mb-3 ".concat(R),children:[Object(r.jsx)("input",{type:"file",style:{display:"none"},name:"urlgambarProduct",onChange:ne}),Y?Object(r.jsx)(I.a,{style:{marginRight:"1rem"}}):Object(r.jsxs)(r.Fragment,{children:[" ",Object(r.jsx)(S.a,{style:{marginRight:"1rem"}})]}),"Unggah File(Max: 25Mb)"]}),Object(r.jsx)("div",{className:"flex flex-col",children:J.map((function(e,t){return Object(r.jsxs)("div",{className:"border border-dashed px-8 py-4 flex justify-between items-center w-6/12 mb-1 relative hover:text-blue-500",children:[Object(r.jsx)("a",{href:e.url,target:"_blank",children:Object(r.jsxs)("div",{className:"mr-5 flex items-center cursor-pointer text-black hover:text-blue-500",children:[Object(r.jsx)("img",{src:e.url,alt:"imageProfile",className:" object-cover w-16 h-16 mr-10"}),Object(r.jsx)("p",{className:"mb-0 mr-3",children:e.name})]})}),Object(r.jsx)("div",{className:"flex items-center",children:Object(r.jsx)(c.a,{title:"Yakin ingin menghapus bukti incident ini?",onConfirm:function(){A((function(e){return e.filter((function(e,n){return n!==t}))})),O((function(e){var n=e;return n.files.splice(t,1),n}))},okText:"Ya",cancelText:"Tidak",children:Object(r.jsx)(C.a,{style:{color:"red",cursor:"pointer",fontSize:"1.5rem"}})})})]},t)}))})]})}),Object(r.jsx)(y.a.Item,{name:"description",label:"Deskripsi Kerusakan",children:Object(r.jsx)(u.a.TextArea,{rows:4,placeholder:"Masukkan deskripsi kerusakan",onChange:function(e){O(q(q({},m),{},{description:e.target.value}))}})})]})})]})]})})}},oWIX:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tickets3/create",function(){return n("RZLj")}])}},[["oWIX",0,2,18,1,3,4,5,6,7,8,9,10,12,16,19,20,41]]]);