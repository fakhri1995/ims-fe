{"ast":null,"code":"import _Input from \"antd/lib/input\";\nimport _notification from \"antd/lib/notification\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport moment from \"moment\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useRef, useState } from \"react\";\nimport Buttonsys from \"../../../components/button\";\nimport DrawerTaskTypesCreate from \"../../../components/drawer/tasks/drawerTaskTypesCreate\";\nimport DrawerTaskTypesUpdate from \"../../../components/drawer/tasks/drawerTaskTypesUpdate\";\nimport { AlerttriangleIconSvg, ArrowsSortIconSvg, BackIconSvg, CalendartimeIconSvg, CircleXIconSvg, ClipboardcheckIconSvg, ClockIconSvg, EditIconSvg, ListcheckIconSvg, LocationIconSvg, MappinIconSvg, SearchIconSvg, SortAscendingIconSvg, SortDescendingIconSvg, TrashIconSvg, UserIconSvg } from \"../../../components/icon\";\nimport st from \"../../../components/layout-dashboard.module.css\";\nimport Layout from \"../../../components/layout-dashboardNew\";\nimport { ModalHapusTipeTask } from \"../../../components/modal/modalCustom\";\nimport { TableCustomTipeTask } from \"../../../components/table/tableCustom\";\nimport { H1, H2, Label, Text } from \"../../../components/typography\";\nimport httpcookie from \"cookie\";\n\nconst TaskTypes = ({\n  initProps,\n  dataProfile,\n  sidemenu\n}) => {\n  //1.Init\n  const rt = useRouter();\n  const pathArr = rt.pathname.split(\"/\").slice(1); //2.Use State\n  //TASK TYPES\n\n  const {\n    0: datarawtipetask,\n    1: setdatarawtipetask\n  } = useState({\n    current_page: \"\",\n    data: [],\n    first_page_url: \"\",\n    from: null,\n    last_page: null,\n    last_page_url: \"\",\n    next_page_url: \"\",\n    path: \"\",\n    per_page: null,\n    prev_page_url: null,\n    to: null,\n    total: null\n  });\n  const {\n    0: datatipetasks,\n    1: setdatatipetasks\n  } = useState([]);\n  const {\n    0: loadingtipetasks,\n    1: setloadingtipetasks\n  } = useState(false);\n  const {\n    0: viewdetailtipetask,\n    1: setviewdetailtipetask\n  } = useState(false);\n  const {\n    0: pagetipetask,\n    1: setpagetipetask\n  } = useState(1);\n  const {\n    0: rowstipetask,\n    1: setrowstipetask\n  } = useState(10);\n  const {\n    0: sortingtipetask,\n    1: setsortingtipetask\n  } = useState({\n    sort_by: \"\",\n    sort_type: \"\"\n  });\n  const {\n    0: searcingtipetask,\n    1: setsearcingtipetask\n  } = useState(\"\");\n  const {\n    0: datafiltertipetasks,\n    1: setdatafiltertipetasks\n  } = useState([]); //create - task type\n\n  const {\n    0: drawertasktypecreate,\n    1: setdrawertasktypecreate\n  } = useState(false); //update - task type\n\n  const {\n    0: triggertasktypupdate,\n    1: settriggertasktypupdate\n  } = useState(-1);\n  const {\n    0: idtasktypupdate,\n    1: setidtasktypupdate\n  } = useState(-1); // const [tempidtasktypeupdate, settempidtasktypeupdate] = useState(-1)\n\n  const tempidtasktypeupdate = useRef(-1);\n  const {\n    0: drawertasktypupdate,\n    1: setdrawertasktypupdate\n  } = useState(false); //delete - task type\n\n  const {\n    0: datatipetaskdelete,\n    1: setdatatipetaskdelete\n  } = useState({\n    id: null,\n    name: \"\"\n  });\n  const {\n    0: modaltipetaskdelete,\n    1: setmodaltipetaskdelete\n  } = useState(false);\n  const {\n    0: loadingtipetaskdelete,\n    1: setloadingtipetaskdelete\n  } = useState(false); //2. Column Table\n\n  const columnsTipetask = [{\n    title: \"No\",\n    dataIndex: \"num\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: datarawtipetask.from + index\n        })\n      };\n    }\n  }, {\n    title: \"Tipe Task\",\n    dataIndex: \"name\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.name\n        })\n      };\n    },\n    sorter: (a, b) => a.name.localeCompare(b.name)\n  }, {\n    title: \"Deskripsi\",\n    dataIndex: \"description\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.description\n        })\n      };\n    }\n  }, {\n    title: \"Jumlah Task\",\n    dataIndex: \"count\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.tasks_count\n        })\n      };\n    },\n    sorter: (a, b) => a.tasks_count > b.tasks_count\n  }, {\n    title: \"Opsi\",\n    dataIndex: \"option\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1\",\n            children: /*#__PURE__*/_jsx(Buttonsys, {\n              type: \"default\",\n              onClick: () => {\n                // settempidtasktypeupdate(record.id)\n                tempidtasktypeupdate.current = record.id;\n                settriggertasktypupdate(prev => prev + 1);\n                setdrawertasktypupdate(true);\n              },\n              children: /*#__PURE__*/_jsx(EditIconSvg, {\n                size: 15,\n                color: `#35763B`\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1\",\n            children: /*#__PURE__*/_jsx(Buttonsys, {\n              type: \"default\",\n              color: \"danger\",\n              onClick: () => {\n                setdatatipetaskdelete({\n                  id: record.id,\n                  name: record.name\n                });\n                setmodaltipetaskdelete(true);\n              },\n              children: /*#__PURE__*/_jsx(TrashIconSvg, {\n                size: 15,\n                color: `#BF4A40`\n              })\n            })\n          })]\n        })\n      };\n    }\n  }]; //3. Handler\n\n  const handleDeleteTipeTask = () => {\n    setloadingtipetaskdelete(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/deleteTaskType`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: datatipetaskdelete.id\n      })\n    }).then(res => res.json()).then(res2 => {\n      setloadingtipetaskdelete(false);\n\n      if (res2.success) {\n        setmodaltipetaskdelete(false);\n\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n      } else {\n        _notification[\"error\"]({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //4.Use Effect\n\n\n  useEffect(() => {\n    setloadingtipetasks(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getTaskTypes?page=${pagetipetask}&rows=${rowstipetask}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatarawtipetask(res2.data);\n      setdatatipetasks(res2.data.data);\n      setdatafiltertipetasks(res2.data.data);\n      setloadingtipetasks(false);\n    });\n  }, [drawertasktypecreate, modaltipetaskdelete]); // useEffect(() => {\n  //     if (triggertasktypupdate !== -1) {\n  //         setidtasktypupdate(tempidtasktypeupdate.current)\n  //     }\n  // }, [triggertasktypupdate])\n\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: initProps,\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    pathArr: pathArr,\n    st: st,\n    prevpath: \"admin\",\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"flex flex-col\",\n      id: \"mainWrapper\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"px-5\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col shadow-md rounded-lg bg-white p-5 mb-6 mx-3\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex justify-between items-center mb-5\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"mr-2 cursor-pointer\",\n                onClick: () => {\n                  rt.push(`/tasks/admin`);\n                },\n                children: /*#__PURE__*/_jsx(BackIconSvg, {\n                  size: 15,\n                  color: `#000000`\n                })\n              }), /*#__PURE__*/_jsx(H1, {\n                children: \"Semua Tipe Task\"\n              })]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"w-8/12 flex justify-end\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \" mx-2\",\n                children: /*#__PURE__*/_jsx(Buttonsys, {\n                  type: \"primary\",\n                  onClick: () => {\n                    setdrawertasktypecreate(true);\n                  },\n                  children: \"+ Tambah Tipe Task\"\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"mx-2\",\n                children: /*#__PURE__*/_jsx(_Input, {\n                  style: {\n                    width: `20rem`\n                  },\n                  placeholder: \"Nama tipe task..\",\n                  allowClear: true,\n                  onChange: e => {\n                    setsearcingtipetask(e.target.value);\n                    setloadingtipetasks(true);\n                    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getTaskTypes?page=${pagetipetask}&rows=${rowstipetask}&name=${e.target.value}&sort_by=${sortingtipetask.sort_by}&sort_type=${sortingtipetask.sort_type}`, {\n                      method: `GET`,\n                      headers: {\n                        Authorization: JSON.parse(initProps)\n                      }\n                    }).then(res => res.json()).then(res2 => {\n                      setdatarawtipetask(res2.data);\n                      setdatatipetasks(res2.data.data);\n                      setloadingtipetasks(false);\n                    });\n                  }\n                })\n              })]\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(TableCustomTipeTask, {\n              dataSource: datatipetasks,\n              setDataSource: setdatatipetasks,\n              columns: columnsTipetask,\n              loading: loadingtipetasks,\n              setpraloading: setloadingtipetasks,\n              pageSize: rowstipetask,\n              total: datarawtipetask.total,\n              initProps: initProps,\n              setpage: setpagetipetask,\n              pagefromsearch: pagetipetask,\n              setdataraw: setdatarawtipetask,\n              setsortingtipetask: setsortingtipetask,\n              sortingtipetask: sortingtipetask,\n              searcingtipetask: searcingtipetask\n            })\n          })]\n        }), /*#__PURE__*/_jsx(ModalHapusTipeTask, {\n          title: \"Konfirmasi Hapus Tipe Task\",\n          visible: modaltipetaskdelete,\n          onvisible: setmodaltipetaskdelete,\n          onCancel: () => {\n            setmodaltipetaskdelete(false);\n          },\n          loading: loadingtipetaskdelete,\n          datadelete: datatipetaskdelete,\n          onOk: handleDeleteTipeTask\n        }), /*#__PURE__*/_jsx(DrawerTaskTypesCreate, {\n          title: \"Tambah Tipe Task\",\n          visible: drawertasktypecreate,\n          onClose: () => {\n            setdrawertasktypecreate(false);\n          },\n          buttonOkText: \"Simpan Tipe Task\",\n          initProps: initProps,\n          onvisible: setdrawertasktypecreate\n        }), /*#__PURE__*/_jsx(DrawerTaskTypesUpdate, {\n          title: \"Ubah Tipe Task\",\n          visible: drawertasktypupdate,\n          onClose: () => {\n            setdrawertasktypupdate(false);\n          },\n          buttonOkText: \"Simpan Tipe Task\",\n          initProps: initProps,\n          onvisible: setdrawertasktypupdate,\n          loading: loadingtipetasks,\n          id: tempidtasktypeupdate,\n          trigger: triggertasktypupdate\n        })]\n      })\n    })\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP;\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"201\"\n    }\n  };\n}\nexport default TaskTypes;","map":null,"metadata":{},"sourceType":"module"}