{"ast":null,"code":"import _Tree from \"antd/lib/tree\";\nimport _Empty from \"antd/lib/empty\";\nimport _Spin from \"antd/lib/spin\";\nimport _Modal from \"antd/lib/modal\";\nimport _Form from \"antd/lib/form\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Input from \"antd/lib/input\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _defineProperty from \"/home/kjokken/mig/code/frontend/ims-fe-ssh-dev/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport Layout from '../../../components/layout-dashboard';\nimport st from '../../../components/layout-dashboard.module.css';\n\nfunction AssetsIndex(_ref) {\n  var initProps = _ref.initProps,\n      dataProfile = _ref.dataProfile,\n      sidemenu = _ref.sidemenu,\n      dataAssetsList = _ref.dataAssetsList;\n  var rt = useRouter();\n  var tok = initProps;\n  var pathArr = rt.pathname.split(\"/\").slice(1);\n\n  var _useState = useState(false),\n      loadingbtn = _useState[0],\n      setloadingbtn = _useState[1];\n\n  var _useState2 = useState(false),\n      loadingbtnfromparent = _useState2[0],\n      setloadingbtnparent = _useState2[1];\n\n  var _useState3 = useState(false),\n      loadingdelete = _useState3[0],\n      setlaodingdelete = _useState3[1];\n\n  var _useState4 = useState(\"\"),\n      searchValue = _useState4[0],\n      setSearchValue = _useState4[1]; //useState\n\n\n  var _useState5 = useState([]),\n      maindata = _useState5[0],\n      setmaindata = _useState5[1];\n\n  var _useState6 = useState(true),\n      praloading = _useState6[0],\n      setpraloading = _useState6[1];\n\n  var _useState7 = useState(false),\n      newmodal = _useState7[0],\n      setNewmodal = _useState7[1];\n\n  var _useState8 = useState(false),\n      newmodalparent = _useState8[0],\n      setNewmodalparent = _useState8[1];\n\n  var _useState9 = useState(false),\n      modaldelete = _useState9[0],\n      setmodaldelete = _useState9[1];\n\n  var _useState10 = useState(\"\"),\n      parentadd = _useState10[0],\n      setParentadd = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      parenttitle = _useState11[0],\n      setParenttitle = _useState11[1];\n\n  var _useState12 = useState({\n    name: '',\n    parent: ''\n  }),\n      datanew = _useState12[0],\n      setDatanew = _useState12[1];\n\n  var _useState13 = useState({\n    id: 0\n  }),\n      datadelete = _useState13[0],\n      setDatadelete = _useState13[1];\n\n  var onChangeAddAssets = function onChangeAddAssets(e) {\n    setDatanew(_objectSpread(_objectSpread({}, datanew), {}, _defineProperty({}, e.target.name, e.target.value)));\n  };\n\n  var _useState14 = useState(true),\n      autoExpandParent = _useState14[0],\n      setAutoExpandParent = _useState14[1];\n\n  var _useState15 = useState([]),\n      expandedKeys = _useState15[0],\n      setExpandedKeys = _useState15[1]; //onChange\n\n\n  var onChangeParent = function onChangeParent(value) {\n    setDatanew(_objectSpread(_objectSpread({}, datanew), {}, _defineProperty({}, \"parent\", value)));\n  };\n\n  var onExpand = function onExpand(expandedKeys) {\n    setExpandedKeys(expandedKeys);\n    setAutoExpandParent(false);\n  }; //filterAsset\n\n\n  var dataList = [];\n\n  var generateList = function generateList(data) {\n    for (var i = 0; i < data.length; i++) {\n      var node = data[i];\n      var id = node.id,\n          key = node.key,\n          value = node.value,\n          id_parent = node.id_parent,\n          title = node.title;\n      dataList.push({\n        id: id,\n        key: key,\n        value: value,\n        id_parent: id_parent,\n        title: title\n      });\n\n      if (node.children) {\n        generateList(node.children);\n      }\n    }\n  };\n\n  generateList(maindata);\n\n  var getParentKey = function getParentKey(key, tree) {\n    var parentKey;\n\n    for (var i = 0; i < tree.length; i++) {\n      var node = tree[i];\n\n      if (node.children) {\n        if (node.children.some(function (item) {\n          return item.key === key;\n        })) {\n          parentKey = node.key;\n        } else if (getParentKey(key, node.children)) {\n          parentKey = getParentKey(key, node.children);\n        }\n      }\n    }\n\n    return parentKey;\n  };\n\n  var onChangeFilterAsset = function onChangeFilterAsset(e) {\n    var value = e.target.value;\n    var expandedKeys = dataList.map(function (item) {\n      if (item.title.indexOf(value) > -1) {\n        return getParentKey(item.key, maindata);\n      }\n\n      return null;\n    }).filter(function (item, i, self) {\n      return item && self.indexOf(item) === i;\n    });\n\n    if (value) {\n      setExpandedKeys(expandedKeys);\n      setSearchValue(value);\n      setAutoExpandParent(true);\n    } else {\n      setExpandedKeys(maindata.map(function (doc) {\n        return doc.key;\n      }));\n      setSearchValue(\"\");\n      setAutoExpandParent(false);\n    }\n  };\n\n  var filterTreeNode = function filterTreeNode(node) {\n    var title = node.title.props.children[0].props ? node.title.props.children[0].props.children[2] : node.title.props.children[2];\n    var result = title ? title.indexOf(searchValue) !== -1 ? true : false : false;\n    return result;\n  };\n\n  var loop = function loop(data) {\n    return data.map(function (item) {\n      var index = item.title.indexOf(searchValue);\n      var beforeStr = item.title.substr(0, index);\n      var afterStr = item.title.substr(index + searchValue.length); // const prt = item.value.substring(0, item.value.length - 4)\n\n      var title = index > -1 ? /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex justify-between md:h-7 hover:bg-blue-100 text-black\",\n        onMouseOver: function onMouseOver() {\n          var d = document.getElementById(\"node\".concat(item.key));\n          d.classList.add(\"flex\");\n          d.classList.remove(\"hidden\");\n        },\n        onMouseLeave: function onMouseLeave() {\n          var e = document.getElementById(\"node\".concat(item.key));\n          e.classList.add(\"hidden\");\n          e.classList.remove(\"flex\");\n        },\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"w-full\",\n          onClick: function onClick() {\n            rt.push(\"/admin/assets/detail/\".concat(item.id));\n          },\n          children: [beforeStr, /*#__PURE__*/_jsx(\"span\", {\n            className: \" text-blue-500\",\n            children: searchValue\n          }), afterStr]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"hidden mx-2\",\n          id: \"node\".concat(item.key),\n          children: /*#__PURE__*/_jsx(\"a\", {\n            className: \"mx-2 py-2 flex items-center\",\n            alt: \"add\",\n            onClick: function onClick() {\n              rt.push(\"/admin/assets/create?idparent=\".concat(item.id, \"&codeparent=\").concat(item.value));\n              /*setNewmodalparent(true); fungsiSetParent(item.value); setParenttitle(item.title)*/\n            },\n            children: /*#__PURE__*/_jsx(\"div\", {\n              className: \"rounded-full bg-black text-white h-5 w-5 flex items-center text-xs justify-center hover:bg-gray-700\",\n              children: \"+\"\n            })\n          })\n        })]\n      }) : /*#__PURE__*/_jsx(\"span\", {\n        children: item.title\n      });\n\n      if (item.children) {\n        return {\n          title: title,\n          key: item.key,\n          children: loop(item.children)\n        };\n      }\n\n      return {\n        title: title,\n        key: item.key\n      };\n    });\n  };\n\n  var handleAddAssets = function handleAddAssets() {\n    // rt.push(`/assets/update/${datanew.name}?originPath=Admin&title=${datanew.name}&parent=${datanew.parent}&create=true`)\n    setloadingbtn(true);\n    setloadingbtnparent(true);\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/addAsset\", {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(datanew)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setloadingbtn(false);\n      setloadingbtnparent(false); // return\n\n      if (res2.success) {\n        setNewmodal(false);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(function () {\n          rt.push(\"/admin/assets/\".concat(datanew.name, \"?parent=\").concat(datanew.parent, \"&create=true\"));\n        }, 500);\n      } else if (!res2.success) {\n        setNewmodal(false);\n\n        _notification['error']({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n      }\n    });\n  };\n\n  var handleDeleteAssets = function handleDeleteAssets() {\n    setlaodingdelete(true);\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/deleteAsset\", {\n      method: 'DELETE',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(datadelete)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      if (res2.success) {\n        setlaodingdelete(false);\n        setmodaldelete(false);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(function () {\n          rt.push(\"/admin/assets\");\n        }, 500);\n      } else if (!res2.success) {\n        setlaodingdelete(false);\n        setmodaldelete(false);\n\n        _notification['error']({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(function () {\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/getAssets\", {\n      method: \"GET\",\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      if (typeof res2.data === 'undefined') {\n        res2.data = [];\n        setmaindata(res2.data);\n        setpraloading(false);\n      } else {\n        setmaindata(res2.data);\n        var defaultexpand = res2.data.map(function (doc) {\n          return doc.key;\n        });\n        setExpandedKeys(defaultexpand);\n        setpraloading(false);\n      }\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    dataProfile: dataProfile,\n    st: st,\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"w-full h-auto border-t border-opacity-30 border-gray-500 bg-white\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-4\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-span-1 md:col-span-4 flex flex-col\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"p-2 md:p-5 mb-5 border-b flex justify-between\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"text-xs md:text-sm font-semibold\",\n              children: /*#__PURE__*/_jsx(\"h1\", {\n                className: \"mt-2 font-semibold text-xl\",\n                children: \"Assets Types\"\n              })\n            }), /*#__PURE__*/_jsx(_Button, {\n              disabled: praloading,\n              type: \"primary\",\n              size: \"large\",\n              onClick: function onClick() {\n                /*setNewmodal(true)*/\n                rt.push(\"/admin/assets/create?idparent=&codeparent=\");\n              },\n              children: \"Tambah\"\n            }), praloading ? null : /*#__PURE__*/_jsx(_Modal, {\n              title: \"Tambah Assets Type & Field\",\n              visible: newmodal,\n              onCancel: function onCancel() {\n                return setNewmodal(false);\n              },\n              maskClosable: false,\n              footer: null,\n              style: {\n                top: \"3rem\"\n              },\n              width: 800,\n              destroyOnClose: true,\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                onFinish: handleAddAssets,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"grid grid-cols-1 md:grid-cols-3 mb-5\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Nama:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      onChange: onChangeAddAssets,\n                      name: \"name\",\n                      value: datanew.name,\n                      allowClear: true,\n                      required: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Deskripsi:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      name: \"description\",\n                      allowClear: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Parent:\"\n                    }), /*#__PURE__*/_jsx(_TreeSelect, {\n                      style: {\n                        width: '100%'\n                      },\n                      dropdownStyle: {\n                        maxHeight: 400,\n                        overflow: 'auto'\n                      },\n                      treeData: maindata,\n                      placeholder: \"Pilih parent\",\n                      treeDefaultExpandAll: true,\n                      onChange: function onChange(value) {\n                        onChangeParent(value);\n                      },\n                      allowClear: true,\n                      required: true\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex justify-end\",\n                  children: [/*#__PURE__*/_jsx(_Button, {\n                    type: \"default\",\n                    onClick: function onClick() {\n                      setNewmodal(false);\n                    },\n                    style: {\n                      marginRight: \"1rem\"\n                    },\n                    children: \"Cancel\"\n                  }), /*#__PURE__*/_jsx(_Button, {\n                    htmlType: \"submit\",\n                    loading: loadingbtn,\n                    type: \"primary\",\n                    size: \"middle\",\n                    children: \"Save\"\n                  })]\n                })]\n              })\n            }), praloading ? null : /*#__PURE__*/_jsx(_Modal, {\n              title: \"Tambah Assets Type & Field dari parent \".concat(parenttitle),\n              visible: newmodalparent,\n              onCancel: function onCancel() {\n                setNewmodalparent(false);\n                setParentadd(\"\");\n              },\n              maskClosable: false,\n              footer: null,\n              style: {\n                top: \"3rem\"\n              },\n              width: 800,\n              destroyOnClose: true,\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                onFinish: handleAddAssets,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"grid grid-cols-1 md:grid-cols-3 mb-5\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Nama:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      onChange: onChangeAddAssets,\n                      name: \"name\",\n                      value: datanew.name,\n                      allowClear: true,\n                      required: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Deskripsi:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      name: \"description\",\n                      allowClear: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Parent:\"\n                    }), /*#__PURE__*/_jsx(_TreeSelect, {\n                      style: {\n                        width: '100%'\n                      },\n                      dropdownStyle: {\n                        maxHeight: 400,\n                        overflow: 'auto'\n                      },\n                      defaultValue: parentadd // value={parentadd}\n                      ,\n                      treeData: maindata,\n                      placeholder: \"Pilih parent\",\n                      treeDefaultExpandAll: true // onChange={(value) => { onChangeParent(value) }}\n                      ,\n                      disabled: true,\n                      allowClear: true\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsx(_Button, {\n                  htmlType: \"submit\",\n                  loading: loadingbtnfromparent,\n                  type: \"primary\",\n                  size: \"middle\",\n                  children: \"Submit\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(_Modal, {\n              title: \"Konfirmasi hapus asset\",\n              visible: modaldelete,\n              okButtonProps: {\n                disabled: loadingdelete\n              },\n              onCancel: function onCancel() {\n                setmodaldelete(false);\n              },\n              onOk: handleDeleteAssets,\n              maskClosable: false,\n              style: {\n                top: \"3rem\"\n              },\n              width: 500,\n              destroyOnClose: true,\n              children: \"Yakin ingin hapus asset ini?\"\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex mb-2 md:mb-5\",\n            children: /*#__PURE__*/_jsx(_Input, {\n              placeholder: \"Masukkan Nama Asset Type\",\n              style: {\n                width: \"75%\"\n              },\n              onChange: onChangeFilterAsset,\n              allowClear: true\n            })\n          }), praloading ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex\",\n            children: /*#__PURE__*/_jsx(_Spin, {})\n          }) : /*#__PURE__*/_jsx(\"div\", {\n            className: \"p-2 md:p-5 w-full md:w-9/12 border rounded-md shadow-md\",\n            children: maindata.length === 0 ? /*#__PURE__*/_jsx(_Empty, {\n              image: _Empty.PRESENTED_IMAGE_SIMPLE\n            }) : /*#__PURE__*/_jsx(_Tree, {\n              onExpand: onExpand,\n              expandedKeys: expandedKeys,\n              autoExpandParent: autoExpandParent,\n              treeData: loop(maindata),\n              filterTreeNode: filterTreeNode,\n              showLine: {\n                showLeafIcon: false\n              },\n              blockNode: true\n            })\n          })]\n        })\n      })\n    })\n  });\n}\n\nexport var __N_SSP = true;\nexport default AssetsIndex;","map":null,"metadata":{},"sourceType":"module"}