{"ast":null,"code":"import _Popconfirm from \"antd/lib/popconfirm\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Input from \"antd/lib/input\";\nimport _Select from \"antd/lib/select\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport httpcookie from 'cookie';\nimport Link from 'next/link';\nimport { LoadingOutlined, UploadOutlined, DeleteOutlined } from '@ant-design/icons';\nimport Sticky from 'wil-react-sticky';\nimport Layout from '../../../components/layout-dashboard2';\nimport st from '../../../components/layout-dashboard.module.css';\n\nconst TicketCreate = ({\n  initProps,\n  sidemenu,\n  dataProfile\n}) => {\n  // 1.Init\n  const rt = useRouter();\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(3, 1);\n  pathArr[pathArr.length - 1] = \"Tambah Ticket\";\n\n  const [instanceForm] = _Form.useForm(); //2.useState\n\n\n  const {\n    0: newdata,\n    1: setnewdata\n  } = useState({\n    type_id: 1,\n    product_type: null,\n    product_id: null,\n    pic_name: \"\",\n    pic_contact: \"\",\n    location_id: 0,\n    problem: \"\",\n    incident_time: null,\n    files: [],\n    description: \"\"\n  });\n  const {\n    0: ticketrelations,\n    1: setticketrelations\n  } = useState({\n    status_ticket: [],\n    incident_type: [],\n    requesters: [],\n    requester_companies: [],\n    companies: {\n      data: [{\n        id: 0,\n        title: '',\n        key: '',\n        value: 0\n      }]\n    }\n  });\n  const {\n    0: filesupload,\n    1: setfilesupload\n  } = useState([]);\n  const {\n    0: disabledupload,\n    1: setdisabledupload\n  } = useState(\"\");\n  const {\n    0: loadingcreate,\n    1: setloadingcreate\n  } = useState(false);\n  const {\n    0: disabledfield,\n    1: setdisabledfield\n  } = useState(false);\n  const {\n    0: loadingfoto,\n    1: setloadingfoto\n  } = useState(false);\n  const {\n    0: uploadtrigger,\n    1: setuploadtrigger\n  } = useState(-1);\n  const {\n    0: uploaddata,\n    1: setuploaddata\n  } = useState(null); //handler\n\n  const onChangeGambar = async e => {\n    // setloadingfoto(true)\n    // const foto = e.target.files\n    // setuploaddata(foto[0])\n    // setloadingfoto(false)\n    // setfilesupload(prev => {\n    //     var temp = prev\n    //     temp.push(foto[0])\n    //     return temp\n    // })\n    // setuploadtrigger(prev => prev + 1)\n    setloadingfoto(true);\n    setdisabledupload(\"pointer-events-none\");\n    const foto = e.target.files;\n    const formdata = new FormData();\n    formdata.append('file', foto[0]);\n    formdata.append('upload_preset', 'migsys');\n    const fetching = await fetch(`https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload`, {\n      method: 'POST',\n      body: formdata\n    });\n    const datajson = await fetching.json();\n    setuploaddata(datajson.secure_url);\n    setfilesupload(prev => {\n      var temp = prev;\n      temp.push({\n        url: datajson.secure_url,\n        name: foto[0].name\n      });\n      return temp;\n    });\n    setuploadtrigger(prev => prev + 1);\n    setloadingfoto(false);\n    setdisabledupload(\"\");\n  };\n\n  const handleCreateTicket = () => {\n    setloadingcreate(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/addTicket`, {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(initProps),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(newdata)\n    }).then(res => res.json()).then(res2 => {\n      setloadingcreate(false);\n\n      if (res2.success) {\n        _notification['success']({\n          message: \"Ticket berhasil ditambahkan\",\n          duration: 3\n        });\n\n        rt.push(`/tickets/detail/${res2.id}`);\n      } else if (!res2.success) {\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getTicketRelation\" : \"getClientTicketRelation\"}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setticketrelations(res2.data);\n    });\n  }, []);\n  useEffect(() => {\n    if (uploadtrigger !== -1) {\n      setnewdata(prev => {\n        var temp = prev;\n        temp.files.push(uploaddata);\n        return temp;\n      });\n    }\n  }, [uploadtrigger]);\n  return /*#__PURE__*/_jsx(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      id: \"createAssetsWrapper\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-4 mb-8 p-3 z-20\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#createAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" col-span-4 flex justify-between pt-4 border-t-2 border-b-2 bg-white\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold py-2\",\n              children: \"Form Tambah Ticket\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [/*#__PURE__*/_jsx(_Button, {\n                type: \"default\",\n                onClick: () => {\n                  /*console.log(newdata); console.log(filesupload)*/\n                  rt.push(`/tickets`);\n                },\n                children: \"Batal\"\n              }), /*#__PURE__*/_jsx(_Button, {\n                disabled: disabledfield,\n                loading: loadingcreate,\n                type: \"primary\",\n                onClick: () => {\n                  instanceForm.submit();\n                },\n                children: \"Simpan\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-span-1 md:col-span-4 mb-6 py-3 px-16\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-1783008176\" + \" \" + \"shadow-md border py-5 px-10 flex flex-col rounded-md mb-5\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"jsx-1783008176\" + \" \" + \"flex mb-2\",\n            children: [/*#__PURE__*/_jsx(\"span\", {\n              className: \"jsx-1783008176\" + \" \" + \"judulField\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: \"jsx-1783008176\" + \" \" + \"mb-0 ml-1\",\n              children: \"Ticket Type\"\n            })]\n          }), /*#__PURE__*/_jsx(_Select, {\n            value: newdata.type,\n            defaultValue: 1,\n            children: /*#__PURE__*/_jsx(_Select.Option, {\n              value: 1,\n              children: \"Incident\"\n            })\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"1783008176\",\n            children: [\".judulField.jsx-1783008176::before{content:'*';color:red;}\"]\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"shadow-md border py-5 px-10 flex flex-col rounded-md mb-5\",\n          children: /*#__PURE__*/_jsxs(_Form, {\n            form: instanceForm,\n            layout: \"vertical\",\n            onFinish: handleCreateTicket,\n            children: [/*#__PURE__*/_jsx(_Form.Item, {\n              name: \"product_type\",\n              label: \"Jenis Produk\",\n              rules: [{\n                required: true,\n                message: 'Jenis Produk wajib dipilih'\n              }],\n              children: /*#__PURE__*/_jsxs(_Select, {\n                placeholder: \"Pilih Produk\",\n                onChange: value => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    product_type: value\n                  }));\n                },\n                children: [/*#__PURE__*/_jsx(_Select.Option, {\n                  value: 1,\n                  children: \"UPS\"\n                }), /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 2,\n                  children: \"ATM\"\n                }), /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 3,\n                  children: \"PC\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"product_id\",\n              label: newdata.product_type === 2 ? \"Terminal ID\" : \"ID Produk\",\n              rules: [{\n                required: true,\n                message: `${newdata.product_type === 2 ? 'Terminal ID' : 'ID Produk'} wajib diisi`\n              }, {\n                pattern: /(\\-)|(^\\d*$)/,\n                message: `${newdata.product_type === 2 ? 'Terminal ID' : 'ID Produk'} harus berisi angka`\n              }],\n              children: /*#__PURE__*/_jsx(_Input, {\n                placeholder: `Masukkan ${newdata.product_type === 2 ? \"Terminal ID\" : \"ID Produk\"}`,\n                onChange: e => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    product_id: Number(e.target.value)\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"pic_name\",\n              label: \"Nama PIC\",\n              children: /*#__PURE__*/_jsx(_Input, {\n                placeholder: `Masukkan Problem`,\n                onChange: e => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    pic_name: e.target.value\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"pic_contact\",\n              label: \"Kontak PIC\",\n              rules: [{\n                pattern: /(\\-)|(^\\d*$)/,\n                message: 'Kontak harus berisi angka'\n              }],\n              children: /*#__PURE__*/_jsx(_Input, {\n                placeholder: `Masukkan Problem`,\n                onChange: e => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    pic_contact: e.target.value\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"location_id\",\n              label: \"Lokasi Problem\",\n              children: /*#__PURE__*/_jsx(_TreeSelect, {\n                placeholder: \"Pilih Lokasi Problem\",\n                treeData: dataProfile.data.role === 1 ? [ticketrelations.companies] : [ticketrelations.companies.data],\n                treeDefaultExpandAll: true,\n                onChange: (value, label, extra) => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    location_id: extra.allCheckedNodes[0].node.props.id\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"problem\",\n              label: \"Problem\",\n              children: /*#__PURE__*/_jsx(_Input, {\n                placeholder: `Masukkan Problem`,\n                onChange: e => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    problem: e.target.value\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"incident_time\",\n              label: \"Waktu Kejadian\",\n              children: /*#__PURE__*/_jsx(_DatePicker, {\n                showTime: true,\n                placeholder: \"Masukkan Waktu Kejadian\",\n                style: {\n                  width: `100%`\n                },\n                onChange: (date, datestring) => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    incident_time: datestring\n                  }));\n                }\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex flex-col\",\n                children: [/*#__PURE__*/_jsx(\"p\", {\n                  className: \"mb-2 ml-1\",\n                  children: \"Bukti Incident (Support File: PNG/JPEG, PDF, dan Word)\"\n                }), /*#__PURE__*/_jsxs(\"label\", {\n                  className: `custom-file-upload py-2 w-52 px-2 inline-block cursor-pointer text-sm text-black border rounded-sm bg-white hover:border-blue-500 hover:text-blue-500 mb-3 ${disabledupload}`,\n                  children: [/*#__PURE__*/_jsx(\"input\", {\n                    type: \"file\",\n                    style: {\n                      display: `none`\n                    },\n                    name: \"urlgambarProduct\",\n                    onChange: onChangeGambar\n                  }), loadingfoto ? /*#__PURE__*/_jsx(LoadingOutlined, {\n                    style: {\n                      marginRight: `1rem`\n                    }\n                  }) : /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [\" \", /*#__PURE__*/_jsx(UploadOutlined, {\n                      style: {\n                        marginRight: `1rem`\n                      }\n                    })]\n                  }), \"Unggah File(Max: 25Mb)\"]\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \"flex flex-col\",\n                  children: filesupload.map((docfile, idxfile) => {\n                    return /*#__PURE__*/_jsxs(\"div\", {\n                      className: \"border border-dashed px-8 py-4 flex justify-between items-center w-6/12 mb-1 relative hover:text-blue-500\",\n                      children: [/*#__PURE__*/_jsx(\"a\", {\n                        href: docfile.url,\n                        target: \"_blank\",\n                        children: /*#__PURE__*/_jsxs(\"div\", {\n                          className: \"mr-5 flex items-center cursor-pointer text-black hover:text-blue-500\",\n                          children: [/*#__PURE__*/_jsx(\"img\", {\n                            src: docfile.url,\n                            alt: \"imageProfile\",\n                            className: \" object-cover w-16 h-16 mr-10\"\n                          }), /*#__PURE__*/_jsx(\"p\", {\n                            className: \"mb-0 mr-3\",\n                            children: docfile.name\n                          })]\n                        })\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: \"flex items-center\",\n                        children: /*#__PURE__*/_jsx(_Popconfirm, {\n                          title: \"Yakin ingin menghapus bukti incident ini?\",\n                          onConfirm: () => {\n                            setfilesupload(prev => prev.filter((_, idxfilt) => idxfilt !== idxfile));\n                            setnewdata(prev => {\n                              var temp = prev;\n                              temp.files.splice(idxfile, 1);\n                              return temp;\n                            });\n                          },\n                          okText: \"Ya\",\n                          cancelText: \"Tidak\",\n                          children: /*#__PURE__*/_jsx(DeleteOutlined, {\n                            style: {\n                              color: `red`,\n                              cursor: `pointer`,\n                              fontSize: `1.5rem`\n                            }\n                          })\n                        })\n                      })]\n                    }, idxfile);\n                  })\n                })]\n              })\n            }), /*#__PURE__*/_jsx(_Form.Item, {\n              name: \"description\",\n              label: \"Deskripsi Kerusakan\",\n              children: /*#__PURE__*/_jsx(_Input.TextArea, {\n                rows: 4,\n                placeholder: `Masukkan deskripsi kerusakan`,\n                onChange: e => {\n                  setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                    description: e.target.value\n                  }));\n                }\n              })\n            })]\n          })\n        })]\n      })]\n    })\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![107, 108, 109, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"2\"\n    }\n  };\n}\nexport default TicketCreate;","map":null,"metadata":{},"sourceType":"module"}