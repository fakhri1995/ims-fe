{"ast":null,"code":"import _Empty from \"antd/lib/empty\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Checkbox from \"antd/lib/checkbox\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\nimport _Tabs from \"antd/lib/tabs\";\nimport _Input from \"antd/lib/input\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../../../components/layout-dashboard\";\nimport st from \"../../../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nfunction RolesUpdate({\n  initProps,\n  dataProfile,\n  sidemenu,\n  dataRolesDetail,\n  dataListModules,\n  idrole\n}) {\n  const rt = useRouter();\n  const tok = initProps;\n  const {\n    TextArea\n  } = _Input;\n  const {\n    TabPane\n  } = _Tabs;\n\n  const [instanceForm] = _Form.useForm();\n\n  const {\n    0: praloading1,\n    1: setpraloading1\n  } = useState(true);\n  const {\n    0: praloading2,\n    1: setpraloading2\n  } = useState(true);\n  const {\n    0: patharr,\n    1: setpatharr\n  } = useState([]);\n  const {\n    0: loadingupdate,\n    1: setloadingupdate\n  } = useState(false);\n  const {\n    0: loadingdelete,\n    1: setloadingdelete\n  } = useState(false);\n  const {\n    0: modaldelete,\n    1: setmodaldelete\n  } = useState(false); // const featureMap = dataRolesDetail.data.role_features.map((doc, idx) => {\n  //     return (doc.feature_id)\n  // })\n  //----------CreateGroup-------------\n  // const [editroles, setEditroles] = useState({\n  //     id: dataRolesDetail.data.role_detail.id,\n  //     name: dataRolesDetail.data.role_detail.name,\n  //     description: dataRolesDetail.data.role_detail.description,\n  //     feature_ids: featureMap\n  // })\n\n  const {\n    0: editroles,\n    1: setEditroles\n  } = useState({\n    id: \"\",\n    name: \"\",\n    description: \"\",\n    feature_ids: []\n  });\n  const {\n    0: modules,\n    1: setmodules\n  } = useState([{\n    id: \"\",\n    key: \"\",\n    name: \"\",\n    status: \"\",\n    company_id: 0,\n    description: \"\",\n    feature: [{\n      id: \"\",\n      key: \"\",\n      name: \"\"\n    }]\n  }]);\n\n  const onChangeEditRoles = e => {\n    var val = e.target.value;\n    setEditroles(_objectSpread(_objectSpread({}, editroles), {}, {\n      [e.target.name]: val\n    }));\n  };\n\n  const onChangeUpdateCheckbox = (e, id) => {\n    if (e.target.checked) {\n      const temp = editroles.feature_ids;\n      temp.push(id);\n      setEditroles(_objectSpread(_objectSpread({}, editroles), {}, {\n        feature_ids: temp\n      }));\n    } else {\n      var temp = editroles.feature_ids;\n      var idx = temp.indexOf(id);\n      temp.splice(idx, 1);\n      setEditroles(_objectSpread(_objectSpread({}, editroles), {}, {\n        feature_ids: temp\n      }));\n    }\n  };\n\n  const handleUpdateRoles = () => {\n    setloadingupdate(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/updateRole`, {\n      method: \"PUT\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(editroles)\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: \"Role berhasil diubah\",\n          duration: 3\n        });\n\n        setEditroles({\n          id: 0,\n          name: \"\",\n          description: \"\",\n          feature_ids: []\n        });\n        setTimeout(() => {\n          setloadingupdate(false);\n          rt.push(`/admin/roles/detail/${idrole}`);\n        }, 300);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n\n        setloadingupdate(false);\n      }\n    });\n  };\n\n  const handleDeleteRoles = () => {\n    setloadingdelete(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/deleteRole`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: editroles.id\n      })\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          setloadingdelete(false);\n          rt.push(`/admin/roles`);\n        }, 300);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n\n        setloadingdelete(false);\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRole?id=${idrole}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      var temp = {\n        id: res2.data.id,\n        name: res2.data.name,\n        description: res2.data.description,\n        feature_ids: res2.data.features.length === 0 ? [] : res2.data.features.map(doc => doc.id)\n      };\n      setEditroles(temp);\n      var pathArr = rt.pathname.split(\"/\").slice(1);\n      pathArr.splice(2, 1);\n      pathArr[pathArr.length - 1] = `Update Role - ` + res2.data.name;\n      setpatharr(pathArr);\n      setpraloading1(false);\n    });\n  }, []);\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getModules`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setmodules(res2.data);\n      setpraloading2(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: patharr,\n    sidemenu: sidemenu,\n    st: st,\n    children: /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n        id: \"formAgentsWrapper\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"col-span-1 md:col-span-4\",\n          children: /*#__PURE__*/_jsx(Sticky, {\n            containerSelectorFocus: \"#formAgentsWrapper\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex justify-between p-4 border-gray-400 border-t border-b bg-white mb-8\",\n              children: [/*#__PURE__*/_jsx(\"h1\", {\n                className: \"font-semibold text-base w-auto \",\n                children: \"Edit Role\"\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex space-x-2\",\n                children: [/*#__PURE__*/_jsx(Link, {\n                  href: `/admin/roles/detail/${idrole}`,\n                  children: /*#__PURE__*/_jsx(_Button, {\n                    type: \"default\",\n                    size: \"middle\",\n                    children: \"Batal\"\n                  })\n                }),\n                /*#__PURE__*/\n                // [177].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n                _jsx(_Button, {\n                  type: \"primary\",\n                  size: \"middle\",\n                  onClick: instanceForm.submit,\n                  loading: loadingupdate,\n                  children: \"Simpan\"\n                })]\n              })]\n            })\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \" col-span-1 md:col-span-3 flex flex-col\",\n          children: [praloading1 ? null : /*#__PURE__*/_jsxs(_Form, {\n            layout: \"vertical\",\n            style: {\n              display: \"contents\"\n            },\n            form: instanceForm,\n            onFinish: handleUpdateRoles,\n            initialValues: editroles,\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0 \",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"name\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Nama Role\",\n                rules: [{\n                  required: true,\n                  message: \"Nama Role wajib diisi\"\n                }],\n                children:\n                /*#__PURE__*/\n                // [177].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n                _jsx(_Input, {\n                  placeholder: \"Role Name\",\n                  name: `name`,\n                  onChange: onChangeEditRoles,\n                  defaultValue: editroles.name\n                }) // :\n                // <div className=\"col-span-1 flex flex-col mb-5\">\n                //     <h1 className=\"font-semibold text-sm\">Role Name:</h1>\n                //     <h1 className=\"text-sm font-normal text-black\">{editroles.name}</h1>\n                // </div>\n\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0\",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"description\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Deskripsi\",\n                rules: [{\n                  required: true,\n                  message: \"Deskripsi wajib diisi\"\n                }],\n                children:\n                /*#__PURE__*/\n                // [177].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n                _jsx(TextArea, {\n                  placeholder: \"Description\",\n                  rows: 2,\n                  name: `description`,\n                  defaultValue: editroles.description,\n                  onChange: onChangeEditRoles\n                }) // :\n                // <div className=\"col-span-1 flex flex-col mb-5\">\n                //     <h1 className=\"font-semibold text-sm\">Description:</h1>\n                //     <h1 className=\"text-sm font-normal text-black\">{editroles.description}</h1>\n                // </div>\n\n              })\n            })]\n          }), /*#__PURE__*/_jsx(\"hr\", {}), praloading2 ? null : /*#__PURE__*/_jsx(_Fragment, {\n            children:\n            /*#__PURE__*/\n            // [177].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n            _jsxs(_Fragment, {\n              children: [/*#__PURE__*/_jsx(\"h1\", {\n                className: \"font-semibold text-base w-auto p-2\",\n                children: \"Permissions\"\n              }), /*#__PURE__*/_jsx(_Tabs, {\n                defaultActiveKey: \"1\",\n                tabPosition: \"left\",\n                children: modules.map((doc, idx) => {\n                  return /*#__PURE__*/_jsx(TabPane, {\n                    tab: doc.name,\n                    children: /*#__PURE__*/_jsx(\"div\", {\n                      className: \" overflow-y-auto h-80 mb-5\",\n                      children: doc.features !== null ? /*#__PURE__*/_jsx(_Fragment, {\n                        children: doc.features.map((doc, idx) => {\n                          const checkedStatus = editroles.feature_ids.includes(doc.id);\n                          return /*#__PURE__*/_jsxs(\"div\", {\n                            className: \"flex items-center hover:bg-gray-300 p-3\",\n                            children: [/*#__PURE__*/_jsx(_Checkbox, {\n                              style: {\n                                marginRight: `1rem`\n                              },\n                              onChange: e => {\n                                onChangeUpdateCheckbox(e, doc.id);\n                              },\n                              defaultChecked: checkedStatus\n                            }), \" \", doc.name]\n                          }, idx);\n                        })\n                      }) : /*#__PURE__*/_jsx(_Fragment, {\n                        children: /*#__PURE__*/_jsx(_Empty, {\n                          image: _Empty.PRESENTED_IMAGE_SIMPLE\n                        })\n                      })\n                    })\n                  }, idx + 1);\n                })\n              })]\n            }) // :\n            // <>\n            //     <h1 className=\"font-semibold text-base w-auto p-2\">Permissions</h1>\n            //     <Tabs defaultActiveKey=\"1\" tabPosition=\"left\">\n            //         {\n            //             modules.map((doc, idx) => {\n            //                 return (\n            //                     <TabPane tab={doc.name} key={idx + 1}>\n            //                         <div className=\" overflow-y-auto h-80 mb-5\">\n            //                             {\n            //                                 doc.feature !== null ?\n            //                                     <>\n            //                                         {\n            //                                             doc.feature.map((doc, idx) => {\n            //                                                 const checkedStatus = editroles.feature_ids.includes(doc.id)\n            //                                                 return (\n            //                                                     <div key={idx} className=\"flex items-center hover:bg-gray-300 p-3\">\n            //                                                         <Checkbox disabled style={{ marginRight: `1rem` }} onChange={(e) => { onChangeUpdateCheckbox(e, doc.id) }} defaultChecked={checkedStatus} /> {doc.name}\n            //                                                     </div>\n            //                                                 )\n            //                                             })\n            //                                         }\n            //                                     </>\n            //                                     :\n            //                                     <>\n            //                                         <Empty image={Empty.PRESENTED_IMAGE_SIMPLE}></Empty>\n            //                                     </>\n            //                             }\n            //                         </div>\n            //                     </TabPane>\n            //                 )\n            //             })\n            //         }\n            //     </Tabs>\n            // </>\n\n          })]\n        })]\n      })\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res,\n  params\n}) {\n  const idrole = params.rolesId;\n  const data = [{\n    key: 1,\n    name: \"Account Admin\",\n    description: \"Admin Tamvan\",\n    agent: \"4 Agents\",\n    actionss: \"clone\"\n  }, {\n    key: 2,\n    name: \"Admin\",\n    description: \"Saya Tamvan\",\n    agent: \"No Agents\",\n    actionss: \"clone\"\n  }, {\n    key: 3,\n    name: \"SD Supervisor\",\n    description: \"Saya Tamvan Sekali\",\n    agent: \"No Agents\",\n    actionss: \"clone\"\n  }];\n  var dataDetailRole;\n\n  for (let index = 0; index < data.length; index++) {\n    if (data[index].key == idrole) {\n      dataDetailRole = data[index];\n      break;\n    } else {\n      dataDetailRole = \"gagal\";\n    }\n  }\n\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![174, 177].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n  // const resourcesGR = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRole?id=${idrole}`, {\n  //     method: `GET`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGR = await resourcesGR.json()\n  // const dataRolesDetail = resjsonGR\n  // const resourcesGM = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getModules`, {\n  //     method: `POST`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGM = await resourcesGM.json()\n  // const dataListModules = resjsonGM\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataRolesDetail,\n      // dataListModules,\n      idrole,\n      sidemenu: \"71\"\n    }\n  };\n}\nexport default RolesUpdate;","map":null,"metadata":{},"sourceType":"module"}