{"ast":null,"code":"import _TreeSelect from \"antd/lib/tree-select\";\nimport _Input from \"antd/lib/input\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport _Select from \"antd/lib/select\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Spin from \"antd/lib/spin\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport React, { useState, useEffect } from 'react';\nimport DrawerCore from '../drawerCore';\nimport { InputRequired, SelectRequired, TextAreaNotRequired } from '../../input';\nimport { AssetIconSvg, CalendartimeIconSvg, CircleXIconSvg, CloudUploadIconSvg, TrashIconSvg, UserIconSvg } from '../../icon';\nimport { Label, H1, H2 } from '../../typography';\nimport { SearchOutlined, LoadingOutlined } from '@ant-design/icons';\nimport ButtonSys from '../../button';\nimport moment from 'moment';\n\nconst DrawerTicketUpdate = ({\n  title,\n  visible,\n  onvisible,\n  onClose,\n  buttonOkText,\n  disabled,\n  initProps,\n  refreshtickets,\n  setrefreshtickets,\n  setrefreshclosed,\n  dataprofile,\n  displaydata,\n  datapayload,\n  setdatapayload,\n  ticketid,\n  disabledsubmit,\n  setdisabledsubmit\n}) => {\n  var _datatypetickets$filt;\n\n  //useState\n  const {\n    0: loadingsave,\n    1: setloadingsave\n  } = useState(false); //data for each field\n\n  const {\n    0: datatypetickets,\n    1: setdatatypetickets\n  } = useState([]);\n  const {\n    0: datatasktickets,\n    1: setdatatasktickets\n  } = useState([]);\n  const {\n    0: dataloctickets,\n    1: setdataloctickets\n  } = useState([]);\n  const {\n    0: listusers,\n    1: setlistusers\n  } = useState([]);\n  const {\n    0: warningphonenumber,\n    1: setwarningphonenumber\n  } = useState(false);\n  const {\n    0: warningproductid,\n    1: setwarningproductid\n  } = useState(false); //files\n\n  const {\n    0: loadingfile,\n    1: setloadingfile\n  } = useState(false); //disabled save button\n\n  const {\n    0: disabledtrigger,\n    1: setdisabledtrigger\n  } = useState(-1); //handler\n\n  const onChangeGambar = async e => {\n    setloadingfile(true);\n    const foto = e.target.files;\n    const formdata = new FormData();\n    formdata.append('file', foto[0]);\n    formdata.append('upload_preset', 'migsys');\n    const fetching = await fetch(`https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload`, {\n      method: 'POST',\n      body: formdata\n    });\n    const datajson = await fetching.json();\n    var tempfile = [...datapayload.files];\n    tempfile.push(datajson.secure_url);\n    setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n      files: tempfile\n    }));\n    setloadingfile(false);\n  };\n\n  const handleUpdateTicket = () => {\n    if (/(^\\d+$)/.test(datapayload.pic_contact) === false || /(^\\d+$)/.test(datapayload.product_id) === false) {\n      if (datapayload.pic_contact === \"\") {\n        setloadingsave(true);\n        setdisabledsubmit(true);\n        fetch(`https://boiling-thicket-46501.herokuapp.com/updateTicket`, {\n          method: 'PUT',\n          headers: {\n            'Authorization': JSON.parse(initProps),\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(datapayload)\n        }).then(res => res.json()).then(res2 => {\n          setrefreshtickets(prev => prev + 1);\n          setloadingsave(false);\n          setdisabledsubmit(false);\n\n          if (res2.success) {\n            setdatapayload({\n              id: Number(ticketid),\n              requester_id: null,\n              raised_at: null,\n              closed_at: null,\n              product_id: \"\",\n              pic_name: \"\",\n              pic_contact: \"\",\n              location_id: null,\n              problem: \"\",\n              incident_time: null,\n              files: [],\n              description: \"\"\n            });\n            onvisible(false);\n\n            _notification['success']({\n              message: res2.message,\n              duration: 3\n            });\n          } else {\n            _notification['error']({\n              message: res2.message,\n              duration: 3\n            });\n          }\n        });\n      } else {\n        new RegExp(/(^\\d+$)/).test(datapayload.pic_contact) === false ? setwarningphonenumber(true) : setwarningphonenumber(false);\n        new RegExp(/(^\\d+$)/).test(datapayload.product_id) === false ? setwarningproductid(true) : setwarningproductid(false);\n        setdisabledsubmit(true);\n      }\n    } else {\n      setloadingsave(true);\n      setdisabledsubmit(true);\n      fetch(`https://boiling-thicket-46501.herokuapp.com/updateTicket`, {\n        method: 'PUT',\n        headers: {\n          'Authorization': JSON.parse(initProps),\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(datapayload)\n      }).then(res => res.json()).then(res2 => {\n        setrefreshtickets(prev => prev + 1);\n        setloadingsave(false);\n        setdisabledsubmit(false);\n\n        if (res2.success) {\n          setdatapayload({\n            id: Number(ticketid),\n            requester_id: null,\n            raised_at: null,\n            closed_at: null,\n            product_id: \"\",\n            pic_name: \"\",\n            pic_contact: \"\",\n            location_id: null,\n            problem: \"\",\n            incident_time: null,\n            files: [],\n            description: \"\"\n          });\n          onvisible(false);\n\n          _notification['success']({\n            message: res2.message,\n            duration: 3\n          });\n        } else {\n          _notification['error']({\n            message: res2.message,\n            duration: 3\n          });\n        }\n      });\n    }\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getTicketRelation`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatatypetickets(res2.data.ticket_types);\n      setdatatasktickets(res2.data.ticket_task_types);\n      setdataloctickets([res2.data.companies]);\n    });\n  }, []);\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getFilterUsers`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setlistusers(res2.data);\n    });\n  }, []);\n  useEffect(() => {\n    console.log(datapayload);\n\n    if (datapayload.type_id !== null && datapayload.name !== \"\" && datapayload.ticket_task_type_id !== null && datapayload.product_id !== \"\" && datapayload.incident_time !== null && datapayload.location_id !== null) {\n      console.log(\"tidak\");\n      setdisabledsubmit(false);\n    } else {\n      console.log(\"ya\");\n      setdisabledsubmit(true);\n    }\n  }, [disabledtrigger]);\n  return /*#__PURE__*/_jsx(DrawerCore, {\n    title: title,\n    visible: visible,\n    onClose: () => {\n      setrefreshclosed(prev => prev + 1);\n      onvisible(false);\n    },\n    buttonOkText: buttonOkText,\n    onClick: handleUpdateTicket,\n    disabled: disabledsubmit,\n    children: loadingsave ? /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsx(_Spin, {})\n    }) : /*#__PURE__*/_jsxs(\"div\", {\n      className: \"flex flex-col\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"mb-6\",\n        children: /*#__PURE__*/_jsx(\"p\", {\n          className: \"mb-0 text-red-500 text-xs italic\",\n          children: \"*Informasi ini harus diisi\"\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsx(Label, {\n          children: \"No. Tiket\"\n        }), /*#__PURE__*/_jsx(\"p\", {\n          className: \" mb-0 text-lg font-bold\",\n          children: displaydata.name\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Nama Pembuat\"\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \" mb-2 flex\",\n          children: /*#__PURE__*/_jsx(_Select, {\n            suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n            showArrow: true,\n            style: {\n              width: `100%`\n            },\n            onChange: (value, option) => {\n              setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                requester_id: value\n              }));\n            },\n            defaultValue: datapayload.requester_id,\n            children: listusers.map((doc, idx) => /*#__PURE__*/_jsx(_Select.Option, {\n              value: doc.id,\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \" flex items-center\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \"mr-1 w-7 h7 rounded-full\",\n                  children: /*#__PURE__*/_jsx(\"img\", {\n                    src: doc.profile_image === \"-\" ? `/image/stafftask.png` : doc.profile_image,\n                    className: \" object-contain\",\n                    alt: \"\"\n                  })\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  children: doc.name\n                })]\n              })\n            }))\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Tanggal Dibuat\"\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \" mb-2 flex\",\n          children: /*#__PURE__*/_jsx(_DatePicker, {\n            suffixIcon: /*#__PURE__*/_jsx(CalendartimeIconSvg, {\n              size: 15,\n              color: `#000000`\n            }),\n            style: {\n              width: `100%`\n            },\n            showTime: true,\n            allowClear: true,\n            className: \"datepickerStatus\",\n            defaultValue: datapayload.raised_at === null ? null : moment(datapayload.raised_at),\n            onChange: (date, datestring) => {\n              setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                raised_at: datestring === \"\" ? null : datestring\n              }));\n            }\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Tanggal Closed\"\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \" mb-2 flex\",\n          children: /*#__PURE__*/_jsx(_DatePicker, {\n            suffixIcon: /*#__PURE__*/_jsx(CalendartimeIconSvg, {\n              size: 15,\n              color: `#000000`\n            }),\n            style: {\n              width: `100%`\n            },\n            showTime: true,\n            allowClear: true,\n            className: \"datepickerStatus\",\n            defaultValue: datapayload.closed_at === null ? null : moment(datapayload.closed_at),\n            onChange: (date, datestring) => {\n              setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                closed_at: datestring === \"\" ? null : datestring\n              }));\n            }\n          })\n        })]\n      }), /*#__PURE__*/_jsx(\"hr\", {}), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col my-6\",\n        children: [/*#__PURE__*/_jsx(Label, {\n          children: \"Tipe Tiket\"\n        }), /*#__PURE__*/_jsx(\"p\", {\n          className: \" mb-0 text-lg font-bold\",\n          children: (_datatypetickets$filt = datatypetickets.filter(type => type.id === displaydata.ticketable.asset_type.ticket_type_id)[0]) === null || _datatypetickets$filt === void 0 ? void 0 : _datatypetickets$filt.name\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsx(Label, {\n          children: \"Jenis Aset\"\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mr-2 flex items-center\",\n            children: /*#__PURE__*/_jsx(AssetIconSvg, {\n              size: 50\n            })\n          }), /*#__PURE__*/_jsx(H2, {\n            children: displaydata.ticketable.asset_type.name\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" mb-6 flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-4263238570\" + \" \" + \"flex mb-2\",\n          children: [/*#__PURE__*/_jsx(Label, {\n            children: \"ID Produk\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"jsx-4263238570\" + \" \" + \"idproduk\"\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"4263238570\",\n            children: [\".idproduk.jsx-4263238570::before{content:'*';color:red;}\"]\n          })]\n        }), /*#__PURE__*/_jsx(_Input, {\n          defaultValue: datapayload.product_id,\n          onChange: e => {\n            setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n              product_id: e.target.value\n            }));\n            setdisabledtrigger(prev => prev + 1);\n          }\n        }), warningproductid && /*#__PURE__*/_jsx(\"p\", {\n          className: \" text-red-500 text-sm mb-0\",\n          children: \"ID Produk harus angka\"\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-2493184868\" + \" \" + \"flex mb-2\",\n          children: [/*#__PURE__*/_jsx(Label, {\n            children: \"Waktu Kejadian\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"jsx-2493184868\" + \" \" + \"timeincident\"\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"2493184868\",\n            children: [\".timeincident.jsx-2493184868::before{content:'*';color:red;}\"]\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \" mb-2 flex\",\n          children: /*#__PURE__*/_jsx(_DatePicker, {\n            suffixIcon: /*#__PURE__*/_jsx(CalendartimeIconSvg, {\n              size: 15,\n              color: `#000000`\n            }),\n            style: {\n              width: `100%`\n            },\n            showTime: true,\n            allowClear: true,\n            className: \"datepickerStatus\",\n            defaultValue: datapayload.incident_time === null ? null : moment(datapayload.incident_time),\n            onChange: (date, datestring) => {\n              setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                incident_time: datestring === \"\" ? null : datestring\n              }));\n              setdisabledtrigger(prev => prev + 1);\n            }\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-1976207010\" + \" \" + \"flex mb-2\",\n          children: [/*#__PURE__*/_jsx(Label, {\n            children: \"Lokasi Kejadian\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"jsx-1976207010\" + \" \" + \"locincident\"\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"1976207010\",\n            children: [\".locincident.jsx-1976207010::before{content:'*';color:red;}\"]\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \" mb-2 flex\",\n          children: /*#__PURE__*/_jsx(_TreeSelect, {\n            style: {\n              width: `100%`\n            },\n            allowClear: true,\n            placeholder: \"Semua Lokasi\",\n            showSearch: true,\n            suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n            showArrow: true,\n            name: `locations_id`,\n            onChange: value => {\n              typeof value === 'undefined' ? setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                location_id: null\n              })) : setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                location_id: value\n              }));\n              setdisabledtrigger(prev => prev + 1);\n            },\n            treeData: dataloctickets,\n            treeDefaultExpandAll: true,\n            defaultValue: datapayload.location_id\n          })\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" mb-6 flex flex-col\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"PIC\"\n          })\n        }), /*#__PURE__*/_jsx(_Input, {\n          defaultValue: datapayload.pic_name,\n          onChange: e => {\n            setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n              pic_name: e.target.value\n            }));\n          }\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" mb-6 flex flex-col\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Kontak PIC\"\n          })\n        }), /*#__PURE__*/_jsx(_Input, {\n          defaultValue: datapayload.pic_contact,\n          onChange: e => {\n            setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n              pic_contact: e.target.value\n            }));\n            setdisabledtrigger(prev => prev + 1);\n          }\n        }), warningphonenumber && /*#__PURE__*/_jsx(\"p\", {\n          className: \" text-red-500 text-sm mb-0\",\n          children: \"Kontak PIC harus angka\"\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" mb-6 flex flex-col\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Deskripsi Masalah\"\n          })\n        }), /*#__PURE__*/_jsx(_Input.TextArea, {\n          rows: 5,\n          defaultValue: datapayload.description,\n          onChange: e => {\n            setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n              description: e.target.value\n            }));\n          }\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" mb-6 flex flex-col\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-2\",\n          children: /*#__PURE__*/_jsx(Label, {\n            children: \"Bukti Kejadian\"\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \" flex justify-between items-center mb-2\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsx(Label, {\n              children: \"Unggah JPG/MP4 (Maks. 5 MB)\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            children: /*#__PURE__*/_jsxs(ButtonSys, {\n              type: `primaryInput`,\n              onChangeGambar: onChangeGambar,\n              children: [loadingfile ? /*#__PURE__*/_jsx(LoadingOutlined, {\n                style: {\n                  marginRight: `0.5rem`\n                }\n              }) : /*#__PURE__*/_jsx(\"div\", {\n                className: \"mr-1\",\n                children: /*#__PURE__*/_jsx(CloudUploadIconSvg, {\n                  size: 15,\n                  color: `#ffffff`\n                })\n              }), \"Unggah File\"]\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"grid grid-cols-3\",\n          children: datapayload.files.map((doc, idx) => /*#__PURE__*/_jsxs(\"div\", {\n            className: \" col-span-1 mx-1 flex flex-col items-center mb-2\",\n            children: [/*#__PURE__*/_jsx(\"img\", {\n              src: doc,\n              className: \" object-contain mb-1 h-28 w-full\",\n              alt: \"\"\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \" cursor-pointer\",\n              onClick: () => {\n                var tempfiles = [...datapayload.files];\n                tempfiles.splice(idx, 1);\n                setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                  files: tempfiles\n                }));\n              },\n              children: /*#__PURE__*/_jsx(TrashIconSvg, {\n                size: 15,\n                color: `#BF4A40`\n              })\n            })]\n          }))\n        })]\n      })]\n    })\n  });\n};\n\nexport default DrawerTicketUpdate;","map":null,"metadata":{},"sourceType":"module"}