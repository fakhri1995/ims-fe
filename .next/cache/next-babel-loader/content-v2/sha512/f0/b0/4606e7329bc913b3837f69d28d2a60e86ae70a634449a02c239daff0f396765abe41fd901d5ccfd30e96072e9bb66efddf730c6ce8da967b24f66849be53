{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Upload from \"antd/lib/upload\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _Input from \"antd/lib/input\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Layout from '../../../components/layout-dashboard';\nimport st from '../../../components/layout-dashboard.module.css';\nimport httpcookie from 'cookie';\nimport { useRouter } from 'next/router';\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport Sticky from 'wil-react-sticky';\nimport UploadOutlined from '@ant-design/icons/UploadOutlined';\n\nfunction IncidentsCreate({\n  initProps,\n  dataProfile,\n  sidemenu\n}) {\n  const rt = useRouter();\n  const tok = initProps; // const pathArr = rt.pathname.split(\"/\").slice(1)\n\n  const pathArr = ['incidents'];\n  const {\n    originPath\n  } = rt.query;\n\n  const [instanceForm] = _Form.useForm();\n\n  const {\n    0: loadingbtn,\n    1: setLoadingbtn\n  } = useState(false); //----------Create Incident-------------\n\n  const {\n    0: newincident,\n    1: setNewincident\n  } = useState({\n    requester: dataProfile.data.user_id,\n    requester_email: dataProfile.data.email,\n    subject: '',\n    description: '',\n    file: [],\n    associate_asset: 1\n  });\n\n  const onChangeCreateIncident = e => {\n    var val = e.target.value;\n    setNewincident(_objectSpread(_objectSpread({}, newincident), {}, {\n      [e.target.name]: val\n    }));\n  }; //-----------------Handle create incident-----------------------------\n\n\n  const handleCreateIncident = () => {\n    setLoadingbtn(true);\n    let formData = new FormData();\n    newincident['file'].forEach(file => {\n      formData.append('file[]', file);\n    }); // formData.append('file', newincident.file[0]);\n\n    formData.append('requester', newincident.requester);\n    formData.append('subject', newincident.subject);\n    formData.append('description', newincident.description);\n    formData.append('associate_asset', newincident.associate_asset); // for (var value of formData.values()) {\n    //     console.log(value);\n    //  }\n    // console.log(formData.values().requester)\n\n    fetch(`https://boiling-thicket-46501.herokuapp.com/addIncident`, {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(tok)\n      },\n      body: formData\n    }).then(res => res.json()).then(res2 => {\n      setLoadingbtn(false);\n\n      if (res2.success) {\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/dashboard/home`);\n        }, 100);\n      } else if (!res2.success) {\n        console.log(res2);\n\n        _notification['error']({\n          message: res2.message.errorInfo[3],\n          // message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //------------------------------------------\n  //----------------------------------------------\n\n\n  const {\n    TextArea\n  } = _Input;\n\n  const checkFile = () => {\n    console.log(newincident);\n  };\n\n  const {\n    0: fileList,\n    1: setFileList\n  } = useState([]);\n\n  const props = _objectSpread({\n    onRemove: file => {\n      const index = fileList.indexOf(file);\n      const newFileList = fileList.slice();\n      newFileList.splice(index, 1);\n      setFileList(newFileList);\n    },\n    beforeUpload: file => {\n      setFileList([...fileList, file]);\n      return false;\n    }\n  }, newincident['file'] = fileList);\n\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    originPath: originPath,\n    st: st,\n    children: /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n        children: [/*#__PURE__*/_jsx(_Form, {\n          layout: \"vertical\",\n          onFinish: handleCreateIncident,\n          style: {\n            display: 'contents'\n          },\n          form: instanceForm,\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" col-span-1 md:col-span-3 flex flex-col\",\n            id: \"formAgentsWrapper\",\n            children: [/*#__PURE__*/_jsx(Sticky, {\n              containerSelectorFocus: \"#formAgentsWrapper\",\n              children: /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex justify-between p-4 border-gray-400 border-t border-b bg-white mb-8\",\n                children: [/*#__PURE__*/_jsx(\"h1\", {\n                  className: \"font-semibold text-base w-auto\",\n                  children: \"Report an Issue\"\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex space-x-2\",\n                  children: [/*#__PURE__*/_jsx(Link, {\n                    href: \"/groups?originPath=Admin\",\n                    children: /*#__PURE__*/_jsx(_Button, {\n                      type: \"default\",\n                      size: \"middle\",\n                      children: \"Batalkan\"\n                    })\n                  }), /*#__PURE__*/_jsx(_Button, {\n                    type: \"primary\",\n                    size: \"middle\",\n                    onClick: instanceForm.submit,\n                    loading: loadingbtn,\n                    children: \"Simpan\"\n                  })]\n                })]\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0 \",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                hidden: true,\n                name: \"requester\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Requester\",\n                rules: [{\n                  required: true,\n                  message: 'Requester harus diisi'\n                }],\n                initialValue: newincident.requester,\n                children: /*#__PURE__*/_jsx(_Input, {\n                  placeholder: \"Requester\",\n                  name: `requester`,\n                  onChange: onChangeCreateIncident\n                })\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0 \",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"requester_email\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Requester\",\n                rules: [{\n                  required: true,\n                  message: 'Requester harus diisi'\n                }],\n                initialValue: newincident.requester_email,\n                children: /*#__PURE__*/_jsx(_Input, {\n                  disabled: true,\n                  placeholder: \"Requester\",\n                  name: `requester_email`,\n                  onChange: onChangeCreateIncident\n                })\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0 \",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"subject\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Subject\",\n                rules: [{\n                  required: true,\n                  message: 'Subject harus diisi'\n                }],\n                initialValue: newincident.subject,\n                children: /*#__PURE__*/_jsx(_Input, {\n                  placeholder: \"Subject\",\n                  name: `subject`,\n                  onChange: onChangeCreateIncident\n                })\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0\",\n              children: /*#__PURE__*/_jsx(_Form.Item, {\n                name: \"description\",\n                style: {\n                  marginRight: `1rem`\n                },\n                label: \"Description\",\n                rules: [{\n                  required: true,\n                  message: 'Deskripsi harus diisi'\n                }],\n                initialValue: newincident.description,\n                children: /*#__PURE__*/_jsx(TextArea, {\n                  placeholder: \"Description\",\n                  rows: 2,\n                  name: `description`,\n                  onChange: onChangeCreateIncident\n                })\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"pb-4 md:mb-0\",\n              children: /*#__PURE__*/_jsx(_Upload, _objectSpread(_objectSpread({}, props), {}, {\n                children: /*#__PURE__*/_jsx(_Button, {\n                  icon: /*#__PURE__*/_jsx(UploadOutlined, {}),\n                  children: \"Select File\"\n                })\n              }))\n            }), /*#__PURE__*/_jsx(_Button, {\n              onClick: checkFile,\n              children: \"Check Data\"\n            })]\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: `${st.grupdesc} flex flex-col space-y-3 px-4`,\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"font-semibold text-base\",\n            children: \"Incidents\"\n          }), /*#__PURE__*/_jsx(\"p\", {\n            className: \"font-normal text-base\",\n            children: \"Tralala Trilili\"\n          })]\n        })]\n      })\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (req && req.headers) {\n    const cookies = req.headers.cookie;\n\n    if (!cookies) {\n      res.writeHead(302, {\n        Location: '/login'\n      });\n      res.end();\n    }\n\n    if (typeof cookies === 'string') {\n      const cookiesJSON = httpcookie.parse(cookies);\n      initProps = cookiesJSON.token;\n    }\n  }\n\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP;\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"4\"\n    }\n  };\n}\nexport default IncidentsCreate;","map":null,"metadata":{},"sourceType":"module"}