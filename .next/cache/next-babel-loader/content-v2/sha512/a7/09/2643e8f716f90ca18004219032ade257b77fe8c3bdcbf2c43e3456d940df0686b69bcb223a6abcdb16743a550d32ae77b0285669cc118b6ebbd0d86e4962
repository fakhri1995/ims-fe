{"ast":null,"code":"import _Select from \"antd/lib/select\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Input from \"antd/lib/input\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Upload from \"antd/lib/upload\";\nimport _Button from \"antd/lib/button\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _regeneratorRuntime from \"/home/kjokken/mig/code/frontend/ims-fe-ssh-dev/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/home/kjokken/mig/code/frontend/ims-fe-ssh-dev/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/home/kjokken/mig/code/frontend/ims-fe-ssh-dev/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"/home/kjokken/mig/code/frontend/ims-fe-ssh-dev/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Layout from '../../../../components/layout-dashboard';\nimport { useRouter } from 'next/router';\nimport { LoadingOutlined } from '@ant-design/icons';\nimport { PlusOutlined } from '@ant-design/icons';\nimport Sticky from 'wil-react-sticky';\nimport Link from 'next/link';\nimport { useState, useEffect } from 'react';\nimport st from '../../../../components/layout-dashboard.module.css';\n\nfunction AgentsCreate(_ref) {\n  var initProps = _ref.initProps,\n      dataProfile = _ref.dataProfile,\n      sidemenu = _ref.sidemenu;\n  var rt = useRouter();\n  var originPath = rt.query.originPath;\n  var tok = initProps; //Breadcrumb\n\n  var pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr[pathArr.length - 1] = \"Create\"; //init Form instance\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      instanceForm = _Form$useForm2[0]; //useState\n  //data payload\n\n\n  var _useState = useState({\n    fullname: '',\n    email: '',\n    role_ids: [],\n    phone_number: '',\n    profile_image: '',\n    company_id: 1,\n    password: \"\",\n    confirm_password: \"\",\n    position: \"\"\n  }),\n      newuser = _useState[0],\n      setNewuser = _useState[1]; //is loading upload image\n\n\n  var _useState2 = useState(false),\n      loadingupload = _useState2[0],\n      setLoadingupload = _useState2[1]; //is loading upddate\n\n\n  var _useState3 = useState(false),\n      loadingsave = _useState3[0],\n      setLoadingsave = _useState3[1]; //data companies\n\n\n  var _useState4 = useState([]),\n      datacompanylist = _useState4[0],\n      setdatacompanylist = _useState4[1]; //data roles\n\n\n  var _useState5 = useState([]),\n      dataroles = _useState5[0],\n      setdataroles = _useState5[1]; //is pra rendered loading\n\n\n  var _useState6 = useState(true),\n      praloading = _useState6[0],\n      setpraloading = _useState6[1]; //handle CreateAgent\n\n\n  var handleCreateAgents = function handleCreateAgents() {\n    setLoadingsave(true);\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/addAgentMember\", {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(newuser)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setLoadingsave(false);\n\n      if (res2.success) {\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(function () {\n          rt.push(\"/admin/agents/detail/\".concat(res2.id));\n        }, 1000);\n      } else if (!res2.success) {\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n    console.log(\"isi new user: \" + newuser.profile_image);\n  }; //on change create agent\n\n\n  var onChangeCreateAgents = function onChangeCreateAgents(e) {\n    var val = e.target.value;\n\n    if (e.target.name === \"role\") {\n      val = parseInt(e.target.value);\n    }\n\n    setNewuser(_objectSpread(_objectSpread({}, newuser), {}, _defineProperty({}, e.target.name, val)));\n  }; //handle before upload\n\n\n  var beforeUploadProfileImage = function beforeUploadProfileImage(file) {\n    var isJpgOrPng = file.type === 'image/jpeg' || file.type === 'image/png' || file.type === 'image/jpg';\n\n    if (!isJpgOrPng) {\n      message.error('You can only upload JPG/PNG file!');\n    }\n\n    var isLt2M = file.size / 1024 / 1024 < 2;\n\n    if (!isLt2M) {\n      message.error('Image must smaller than 2MB!');\n    }\n\n    return isJpgOrPng && isLt2M;\n  };\n\n  var onChangeProfileImage = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(info) {\n      var formData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              if (!(info.file.status === 'uploading')) {\n                _context.next = 3;\n                break;\n              }\n\n              setLoadingupload(true);\n              return _context.abrupt(\"return\");\n\n            case 3:\n              if (!(info.file.status === 'done')) {\n                _context.next = 9;\n                break;\n              }\n\n              console.log(\"isi upload: \" + info.file.originFileObj.name);\n              formData = new FormData();\n              formData.append('file', info.file.originFileObj);\n              formData.append('upload_preset', 'migsys');\n              return _context.abrupt(\"return\", fetch(\"https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload\", {\n                method: 'POST',\n                body: formData\n              }).then(function (res) {\n                return res.json();\n              }).then(function (res2) {\n                setNewuser(_objectSpread(_objectSpread({}, newuser), {}, {\n                  profile_image: res2.secure_url\n                }));\n              }));\n\n            case 9:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onChangeProfileImage(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var uploadButton = /*#__PURE__*/_jsxs(\"div\", {\n    children: [loadingupload ? /*#__PURE__*/_jsx(LoadingOutlined, {}) : /*#__PURE__*/_jsx(PlusOutlined, {}), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: \"Unggah\"\n    })]\n  }); //useEffect\n  //get Asal Lokasi\n\n\n  useEffect(function () {\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/getBranchCompanyList\", {\n      method: \"GET\",\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdatacompanylist([res2.data]);\n      setpraloading(false);\n    });\n  }, []); //data Roles\n\n  useEffect(function () {\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/getRoles\", {\n      method: \"GET\",\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdataroles(res2.data);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    originPath: originPath,\n    st: st,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      id: \"createAgentsWrapper\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-4\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#createAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" col-span-4 flex justify-between p-2 pt-4 border-t-2 border-b-2 bg-white mb-8\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold py-2\",\n              children: \"Buat Akun Agent\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/admin/agents\",\n                children: /*#__PURE__*/_jsx(_Button, {\n                  type: \"default\",\n                  children: \"Batal\"\n                })\n              }), /*#__PURE__*/_jsx(_Button, {\n                disabled: praloading,\n                type: \"primary\",\n                loading: loadingsave,\n                onClick: instanceForm.submit,\n                children: \"Simpan\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-3 flex flex-col\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"shadow-lg flex flex-col rounded-md w-full h-auto p-4 mb-14\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"border-b border-black p-4 font-semibold mb-5\",\n            children: [\"Akun Agent - \", newuser.fullname]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"grid grid-cols-1 md:grid-cols-4\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-1\",\n              children: /*#__PURE__*/_jsx(_Upload, {\n                name: \"profile_image\",\n                listType: \"picture-card\",\n                className: \"profileImage\",\n                showUploadList: false,\n                beforeUpload: beforeUploadProfileImage,\n                onChange: onChangeProfileImage,\n                children: newuser.profile_image ? /*#__PURE__*/_jsx(\"img\", {\n                  src: newuser.profile_image,\n                  alt: \"avatar\",\n                  style: {\n                    width: '100%'\n                  }\n                }) : uploadButton\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-3\",\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                form: instanceForm,\n                className: \"createAgentsForm\",\n                onFinish: handleCreateAgents,\n                children: [/*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Asal Lokasi\",\n                  name: \"company_id\",\n                  rules: [{\n                    required: true,\n                    message: 'Asal Lokasi wajib diisi'\n                  }],\n                  children: /*#__PURE__*/_jsx(_TreeSelect, {\n                    allowClear: true,\n                    dropdownStyle: {\n                      maxHeight: 400,\n                      overflow: 'auto'\n                    },\n                    treeData: datacompanylist,\n                    placeholder: \"Pilih Asal Lokasi\",\n                    treeDefaultExpandAll: true,\n                    onChange: function onChange(value) {\n                      setNewuser(_objectSpread(_objectSpread({}, newuser), {}, {\n                        company_id: value\n                      }));\n                    }\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Nama Lengkap\",\n                  required: true,\n                  name: \"fullname\",\n                  rules: [{\n                    required: true,\n                    message: 'Nama Lengkap wajib diisi'\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuser.fullname,\n                    name: \"fullname\",\n                    onChange: onChangeCreateAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Email\",\n                  required: true,\n                  name: \"email\",\n                  rules: [{\n                    required: true,\n                    message: 'Email wajib diisi'\n                  }, {\n                    pattern: /(\\-)|(^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$)/,\n                    message: 'Email belum diisi dengan benar'\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuser.email,\n                    name: \"email\",\n                    onChange: onChangeCreateAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Posisi\",\n                  required: true,\n                  name: \"position\",\n                  rules: [{\n                    required: true,\n                    message: 'Posisi wajib diisi'\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuser.position,\n                    name: \"position\",\n                    onChange: onChangeCreateAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"No. Handphone\",\n                  name: \"phone_number\",\n                  rules: [{\n                    required: true,\n                    message: 'No.Handphone wajib diisi'\n                  }, {\n                    pattern: /(\\-)|(^\\d*$)/,\n                    message: 'No. Handphone harus berisi angka'\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuser.phone_number,\n                    name: \"phone_number\",\n                    onChange: onChangeCreateAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Password\",\n                  name: \"password\",\n                  rules: [{\n                    required: true,\n                    message: 'Password wajib diisi'\n                  }, {\n                    pattern: /([A-z0-9]{8})/,\n                    message: 'Password minimal 8 karakter'\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input.Password, {\n                    value: newuser.password,\n                    name: \"password\",\n                    onChange: onChangeCreateAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Konfirmasi Password\",\n                  name: \"password\",\n                  rules: [{\n                    required: true,\n                    message: 'Confirm Password wajib diisi'\n                  }, {\n                    pattern: /([A-z0-9]{8})/,\n                    message: 'Confirm Password minimal 8 karakter'\n                  }],\n                  children: /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [/*#__PURE__*/_jsx(_Input.Password, {\n                      value: newuser.confirm_password,\n                      name: \"confirm_password\",\n                      onChange: onChangeCreateAgents\n                    }), newuser.password !== newuser.confirm_password && /*#__PURE__*/_jsx(\"p\", {\n                      className: \" text-red-500 mb-0\",\n                      children: \"Confirm Password harus sesuai dengan password\"\n                    })]\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Role\",\n                  name: \"role\",\n                  children: /*#__PURE__*/_jsx(_Select, {\n                    mode: \"multiple\",\n                    onChange: function onChange(value) {\n                      setNewuser(_objectSpread(_objectSpread({}, newuser), {}, {\n                        role_ids: value\n                      }));\n                    }\n                    /*defaultValue={idrole}*/\n                    ,\n                    style: {\n                      width: \"100%\"\n                    },\n                    children: dataroles.map(function (doc, idx) {\n                      return /*#__PURE__*/_jsx(_Select.Option, {\n                        value: doc.id,\n                        children: doc.name\n                      }, doc.id);\n                    })\n                  })\n                })]\n              })\n            })]\n          })]\n        })\n      })]\n    })\n  });\n}\n\nexport var __N_SSP = true;\nexport default AgentsCreate;","map":null,"metadata":{},"sourceType":"module"}