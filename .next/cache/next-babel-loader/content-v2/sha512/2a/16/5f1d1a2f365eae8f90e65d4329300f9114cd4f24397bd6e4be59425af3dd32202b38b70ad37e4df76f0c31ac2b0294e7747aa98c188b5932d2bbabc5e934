{"ast":null,"code":"import _Input from \"antd/lib/input\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _regeneratorRuntime from \"/tmp/mig/ims-fe/node_modules/next/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"/tmp/mig/ims-fe/node_modules/next/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _defineProperty from \"/tmp/mig/ims-fe/node_modules/next/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _Select from \"antd/lib/select\";\nimport _Form from \"antd/lib/form\";\nimport _slicedToArray from \"/tmp/mig/ims-fe/node_modules/next/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { EditOutlined, LoadingOutlined } from \"@ant-design/icons\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../../../components/layout-dashboard\";\nimport st from \"../../../../../components/layout-dashboard.module.css\";\n\nfunction AgentUpdate(_ref) {\n  var initProps = _ref.initProps,\n      dataProfile = _ref.dataProfile,\n      dataDetailRequester = _ref.dataDetailRequester,\n      dataRoles = _ref.dataRoles,\n      sidemenu = _ref.sidemenu,\n      userid = _ref.userid;\n  var rt = useRouter();\n  var tok = initProps;\n\n  var _Form$useForm = _Form.useForm(),\n      _Form$useForm2 = _slicedToArray(_Form$useForm, 1),\n      instanceForm = _Form$useForm2[0];\n\n  var Option = _Select.Option; //loading upload image\n\n  var _useState = useState(false),\n      loadingfoto = _useState[0],\n      setLoadingfoto = _useState[1]; //data payload\n\n\n  var _useState2 = useState({\n    id: Number(userid),\n    fullname: \"\",\n    phone_number: \"\",\n    profile_image: \"/default-users.jpeg\",\n    role_ids: [],\n    position: \"\"\n  }),\n      dataupdate = _useState2[0],\n      setdataupdate = _useState2[1]; //data asal lokasi\n\n\n  var _useState3 = useState([]),\n      datacompanylist = _useState3[0],\n      setdatacompanylist = _useState3[1]; //data default roles\n\n\n  var _useState4 = useState(0),\n      defaultroles = _useState4[0],\n      setdefaultroles = _useState4[1]; //data breadcrumb\n\n\n  var _useState5 = useState([]),\n      patharr = _useState5[0],\n      setpatharr = _useState5[1]; //loading pre render\n\n\n  var _useState6 = useState(true),\n      preloading = _useState6[0],\n      setpreloading = _useState6[1]; //data default asal lokasi\n\n\n  var _useState7 = useState(0),\n      defaultcompany = _useState7[0],\n      setdefaultcompany = _useState7[1]; //loading update button\n\n\n  var _useState8 = useState(false),\n      loadingupdate = _useState8[0],\n      setLoadingupdate = _useState8[1]; //data roles\n\n\n  var _useState9 = useState({\n    data: []\n  }),\n      dataroles = _useState9[0],\n      setdataroles = _useState9[1];\n\n  var onChangeRole = function onChangeRole(value) {\n    setdataupdate(_objectSpread(_objectSpread({}, dataupdate), {}, {\n      role_ids: value\n    }));\n  };\n\n  var onChangeEditAgents = function onChangeEditAgents(e) {\n    setdataupdate(_objectSpread(_objectSpread({}, dataupdate), {}, _defineProperty({}, e.target.name, e.target.value)));\n  };\n\n  var onChangeEditFoto = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(e) {\n      var foto, formdata, fetching, datajson;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              setLoadingfoto(true);\n              foto = e.target.files;\n              formdata = new FormData();\n              formdata.append(\"file\", foto[0]);\n              formdata.append(\"upload_preset\", \"migsys\");\n              _context.next = 7;\n              return fetch(\"https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload\", {\n                method: \"POST\",\n                body: formdata\n              });\n\n            case 7:\n              fetching = _context.sent;\n              _context.next = 10;\n              return fetching.json();\n\n            case 10:\n              datajson = _context.sent;\n              setdataupdate(_objectSpread(_objectSpread({}, dataupdate), {}, {\n                profile_image: datajson.secure_url\n              }));\n              setLoadingfoto(false);\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function onChangeEditFoto(_x) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var handleSubmitEditAccount = function handleSubmitEditAccount() {\n    setLoadingupdate(true);\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/updateAgentDetail\"), {\n      method: \"PUT\",\n      headers: {\n        Authorization: JSON.parse(tok),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(dataupdate)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setLoadingupdate(false);\n\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(function () {\n          rt.push(\"/admin/agents/detail/\".concat(dataupdate.id));\n        }, 300);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    }); // }\n  }; //useEffect\n\n\n  useEffect(function () {\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/getAgentDetail?account_id=\").concat(userid), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      var temp = {\n        id: res2.data.id,\n        fullname: res2.data.name,\n        role: res2.data.role,\n        phone_number: res2.data.phone_number,\n        profile_image: res2.data.profile_image === \"\" || res2.data.profile_image === \"-\" ? \"/default-users.jpeg\" : res2.data.profile_image,\n        email: res2.data.email,\n        role_ids: res2.data.roles.map(function (docmap) {\n          return docmap.id;\n        }),\n        position: res2.data.position\n      };\n      setdataupdate(temp);\n      setdefaultroles(res2.data.roles.map(function (docmap) {\n        return docmap.id;\n      }));\n      var pathArr = rt.pathname.split(\"/\").slice(1);\n      pathArr.splice(3, 1);\n      pathArr[pathArr.length - 1] = \"Ubah Profil Agent - \" + res2.data.name;\n      setpatharr(pathArr);\n      setdefaultcompany(res2.data.company_id);\n      setpreloading(false);\n    });\n  }, []);\n  useEffect(function () {\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/getBranchCompanyList\"), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdatacompanylist([res2.data]);\n    });\n  }, []);\n  useEffect(function () {\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/getRoles\"), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdataroles(res2);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: patharr,\n    sidemenu: sidemenu,\n    dataDetailAccount: dataupdate,\n    st: st,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-4\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#formAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex justify-between p-2 pt-4 border-t-2 border-b-2 bg-white mb-8\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold py-2\",\n              children: \"Ubah Profil Agent\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [/*#__PURE__*/_jsx(_Button, {\n                disabled: preloading,\n                onClick: function onClick() {\n                  rt.push(\"/admin/agents/detail/\".concat(userid));\n                },\n                type: \"default\",\n                children: \"Batal\"\n              }), /*#__PURE__*/_jsx(_Button, {\n                disabled: preloading,\n                type: \"primary\",\n                loading: loadingupdate,\n                onClick: instanceForm.submit,\n                children: \"Simpan\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-3 flex flex-col\",\n        id: \"formAgentsWrapper\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"shadow-lg flex flex-col rounded-md w-full h-auto p-4 mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"border-b border-black p-4 font-semibold mb-5 flex\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \" mr-3 md:mr-5 pt-1\",\n              children: [\"Ubah Profil Agent - \", dataupdate.fullname]\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"grid grid-cols-1 md:grid-cols-4\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-1 flex flex-col items-center\",\n              children: [/*#__PURE__*/_jsx(\"img\", {\n                src: dataupdate.profile_image,\n                alt: \"imageProfile\",\n                className: \" object-cover w-32 h-32 rounded-full mb-4\"\n              }), /*#__PURE__*/_jsxs(\"label\", {\n                className: \"custom-file-upload py-2 px-2 inline-block cursor-pointer text-sm text-black border rounded-sm bg-white hover:border-blue-500 hover:text-blue-500 mb-3\",\n                children: [/*#__PURE__*/_jsx(\"input\", {\n                  type: \"file\",\n                  style: {\n                    display: \"none\"\n                  },\n                  name: \"profile_image\",\n                  onChange: onChangeEditFoto\n                }), loadingfoto ? /*#__PURE__*/_jsx(LoadingOutlined, {}) : /*#__PURE__*/_jsx(EditOutlined, {\n                  style: {\n                    fontSize: \"1.2rem\"\n                  }\n                }), \"Ganti Foto\"]\n              })]\n            }), preloading ? null : /*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-3\",\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                initialValues: dataupdate,\n                form: instanceForm,\n                onFinish: handleSubmitEditAccount,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex flex-col mb-5\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"jsx-2118959277\" + \" \" + \"flex mb-2\",\n                    children: [/*#__PURE__*/_jsx(\"span\", {\n                      className: \"jsx-2118959277\" + \" \" + \"asal\"\n                    }), /*#__PURE__*/_jsx(\"p\", {\n                      className: \"jsx-2118959277\" + \" \" + \"mb-0 ml-1\",\n                      children: \"Asal Lokasi\"\n                    }), /*#__PURE__*/_jsx(_JSXStyle, {\n                      id: \"2118959277\",\n                      children: [\".asal.jsx-2118959277::before{content:'*';color:red;}\"]\n                    })]\n                  }), /*#__PURE__*/_jsx(_TreeSelect, {\n                    allowClear: true,\n                    dropdownStyle: {\n                      maxHeight: 400,\n                      overflow: \"auto\"\n                    },\n                    treeData: datacompanylist,\n                    placeholder: \"Pilih Asal Lokasi\",\n                    treeDefaultExpandAll: true,\n                    defaultValue: defaultcompany,\n                    disabled: true\n                  })]\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Nama Lengkap\",\n                  required: true,\n                  name: \"fullname\",\n                  rules: [{\n                    required: true,\n                    message: \"Nama Lengkap wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    defaultValue: dataupdate.fullname,\n                    onChange: onChangeEditAgents,\n                    name: \"fullname\"\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Email\",\n                  required: true,\n                  name: \"email\",\n                  rules: [{\n                    required: true,\n                    message: \"Email wajib diisi\"\n                  }, {\n                    pattern: /(\\-)|(^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$)/,\n                    message: \"Email belum diisi dengan benar\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    disabled: true,\n                    value: dataupdate.email,\n                    name: \"email\",\n                    onChange: onChangeEditAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Posisi\",\n                  required: true,\n                  name: \"position\",\n                  rules: [{\n                    required: true,\n                    message: \"Posisi wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: dataupdate.position,\n                    name: \"position\",\n                    onChange: onChangeEditAgents\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"No. Handphone\",\n                  required: true,\n                  name: \"phone_number\",\n                  rules: [{\n                    required: true,\n                    message: \"No. Handphone wajib diisi\"\n                  }, {\n                    pattern: /(\\-)|(^\\d*$)/,\n                    message: \"No. Handphone harus berisi angka\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    defaultValue: dataupdate.phone_number,\n                    onChange: onChangeEditAgents,\n                    name: \"phone_number\"\n                  })\n                }), /*#__PURE__*/_jsx(\"h1\", {\n                  className: \"text-sm\",\n                  children: \"Role:\"\n                }), /*#__PURE__*/_jsx(_Select, {\n                  mode: \"multiple\",\n                  placeholder: \"Pilih Role\",\n                  onChange: function onChange(value) {\n                    onChangeRole(value);\n                  },\n                  defaultValue: defaultroles,\n                  style: {\n                    width: \"100%\"\n                  },\n                  children: dataroles.data.map(function (doc, idx) {\n                    return /*#__PURE__*/_jsx(Option, {\n                      value: doc.id,\n                      children: doc.name\n                    }, idx);\n                  })\n                })]\n              })\n            })]\n          })]\n        })\n      })]\n    })\n  });\n}\n\nexport var __N_SSP = true;\nexport default AgentUpdate;","map":null,"metadata":{},"sourceType":"module"}