{"ast":null,"code":"import _Table from \"antd/lib/table\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport LoadingOutlined from \"@ant-design/icons/LoadingOutlined\";\nimport PlusOutlined from \"@ant-design/icons/PlusOutlined\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Layout from \"../../../components/layout-dashboard\";\nimport st from \"../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nfunction modifData(dataa) {\n  for (var i = 0; i < dataa.length; i++) {\n    dataa[i][\"key\"] = dataa[i].id;\n    dataa[i][\"value\"] = dataa[i].id;\n    dataa[i][\"title\"] = dataa[i].name;\n    dataa[i][\"children\"] = dataa[i].members;\n    delete dataa[i].members;\n    if (dataa[i].children) [modifData(dataa[i].children)];\n  }\n\n  return dataa;\n}\n\nfunction ClientsIndex({\n  initProps,\n  dataProfile,\n  sidemenu\n}) {\n  const rt = useRouter();\n  const tok = initProps;\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(1, 1);\n  const {\n    0: drawablecreate,\n    1: setDrawablecreate\n  } = useState(false);\n  const {\n    0: loadingupload,\n    1: setLoadingupload\n  } = useState(false);\n  const {\n    0: loadingbtn,\n    1: setloadingbtn\n  } = useState(false); // const [instanceForm] = Form.useForm()\n  // const { Option } = Select\n\n  const {\n    0: newclients,\n    1: setnewclients\n  } = useState({\n    name: \"\",\n    role: 2,\n    address: \"\",\n    phone_number: \"\",\n    image_logo: \"\",\n    parent_id: 0\n  });\n  const {\n    0: datatable,\n    1: setdatatable\n  } = useState([]);\n  const {\n    0: datatable2,\n    1: setdatatable2\n  } = useState([]);\n  const {\n    0: loaddatatable,\n    1: setloaddatatable\n  } = useState(false); // var dataTable = []\n  // if (!dataCompanyList.data) {\n  //     dataTable = []\n  //     notification['error']({\n  //         message: dataCompanyList.message.errorInfo.status_detail,\n  //         duration: 3\n  //     })\n  //     rt.push('/admin/company')\n  // }\n  // else {\n  //     dataTable = dataCompanyList.data.filter(dataa => dataa.company_id != 66).map((doc, idx) => {\n  //         return ({\n  //             image_logo: doc.image_logo,\n  //             company_id: doc.company_id,\n  //             company_name: doc.company_name,\n  //             is_enabled: doc.is_enabled\n  //         })\n  //     })\n  // }\n\n  const columnsTable = [{\n    title: \"Logo\",\n    dataIndex: \"image_logo\",\n    render: (text, record, index) => {\n      return {\n        // props: {\n        //     style: { backgroundColor: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n        // },\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(Link, {\n            href: `/company/clients/${record.id}`,\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: /*#__PURE__*/_jsx(\"img\", {\n                src: record.image_logo === \"-\" || record.image_logo === \"\" ? `/image/Induk.png` : record.image_logo,\n                alt: \"imageProfile\",\n                className: \" object-cover w-10 h-10 rounded-full\"\n              })\n            })\n          })\n        })\n      };\n    }\n  }, // {\n  //     title: 'ID',\n  //     dataIndex: 'company_id',\n  //     render: (text, record, index) => {\n  //         return {\n  //             props: {\n  //                 style: { backgroundColor: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n  //             },\n  //             children:\n  //                 <>\n  //                     <Link href={`/admin/company/${record.company_id}`}>\n  //                         <a><h1>{record.company_id}</h1></a>\n  //                     </Link>\n  //                 </>\n  //         }\n  //     },\n  //     // sorter: (a, b) => a.company_id - b.company_id,\n  //     // sortDirections: ['descend', 'ascend'],\n  // },\n  {\n    title: \"Nama Perusahaan\",\n    dataIndex: \"name\",\n    render: (text, record, index) => {\n      return {\n        // props: {\n        //     style: { backgroundColor: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n        // },\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(Link, {\n            href: `/company/clients/${record.id}`,\n            children: /*#__PURE__*/_jsx(\"a\", {\n              children: /*#__PURE__*/_jsx(\"h1\", {\n                children: record.name\n              })\n            })\n          })\n        })\n      };\n    } // sorter: (a, b) => a.company_name.localeCompare(b.company_name),\n    // sortDirections: ['descend', 'ascend'],\n\n  }, {\n    title: \"Status\",\n    dataIndex: \"is_enabled\",\n    align: `center`,\n    render: (text, record, index) => {\n      return {\n        // props: {\n        //     style: { backgroundColor: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n        // },\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"flex justify-center\",\n          children: /*#__PURE__*/_jsx(Link, {\n            href: `/company/clients/${record.id}`,\n            children: record.is_enabled ? /*#__PURE__*/_jsx(\"a\", {\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \" bg-blue-100 text-blue-600 border-blue-600 border py-1 px-3 rounded-md text-center w-40\",\n                children: \"AKTIF MODULE\"\n              })\n            }) : /*#__PURE__*/_jsx(\"a\", {\n              children: /*#__PURE__*/_jsx(\"div\", {\n                className: \" bg-red-100 text-red-600 border-red-600 border py-1 px-3 rounded-md text-center w-52\",\n                children: \"NON-AKTIF MODULE\"\n              })\n            })\n          })\n        })\n      };\n    } // filters: [\n    //     {\n    //         text: 'Aktif',\n    //         value: true,\n    //     },\n    //     {\n    //         text: 'Non-aktif',\n    //         value: false,\n    //     },\n    // ],\n    // onFilter: (value, record) => record.is_enabled === value,\n\n  } // {\n  //     title: '\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0',\n  //     dataIndex: 'actionss',\n  //     align: `center`,\n  //     render: (text, record, index) => {\n  //         return {\n  //             props: {\n  //                 style: { backgroundColor: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n  //             },\n  //             children:\n  //                 <>\n  //                     {/* {\n  //                         events[index] ?\n  //                             <> */}\n  //                     {\n  //                         [156, 158, 159, 160, 161, 162, 163].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n  //                         <Button onClick={() => { rt.push(`/admin/company/${record.company_id}`) }} style={{ paddingTop: `0`, paddingBottom: `0.3rem`, marginRight: `1rem` }}>\n  //                             <EditOutlined />\n  //                         </Button>\n  //                     }\n  //                     {/* <Link href={`/admin/company/${record.company_id}`}> */}\n  //                     {/* {events[index]} */}\n  //                     {/* <Link href={`/company/${record.company_id}?originPath=Admin`}> */}\n  //                     {/* <a><EditOutlined /></a> */}\n  //                     {/* </Link> */}\n  //                     {/* </Link> */}\n  //                     {/* </>\n  //                             :\n  //                             null\n  //                     } */}\n  //                 </>\n  //         }\n  //     }\n  // }\n  ];\n\n  const closeClientsDrawer = () => {\n    setnewclients({\n      name: \"\",\n      role: 0,\n      address: \"\",\n      phone_number: \"\",\n      image_logo: \"\",\n      parent_id: null\n    });\n  };\n\n  const beforeUploadProfileImage = file => {\n    const isJpgOrPng = file.type === \"image/jpeg\" || file.type === \"image/png\" || file.type === \"image/jpg\";\n\n    if (!isJpgOrPng) {\n      message.error(\"You can only upload JPG/PNG file!\");\n    }\n\n    const isLt2M = file.size / 1024 / 1024 < 2;\n\n    if (!isLt2M) {\n      message.error(\"Image must smaller than 2MB!\");\n    }\n\n    return isJpgOrPng && isLt2M;\n  };\n\n  const onChangeProfileImage = async info => {\n    if (info.file.status === \"uploading\") {\n      setLoadingupload(true);\n      return;\n    }\n\n    if (info.file.status === \"done\") {\n      const formData = new FormData();\n      formData.append(\"file\", info.file.originFileObj);\n      formData.append(\"upload_preset\", \"migsys\");\n      return fetch(`https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload`, {\n        method: \"POST\",\n        body: formData\n      }).then(res => res.json()).then(res2 => {\n        setLoadingupload(false);\n        setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n          image_logo: res2.secure_url\n        }));\n      });\n    }\n  };\n\n  const uploadButton = /*#__PURE__*/_jsxs(\"div\", {\n    children: [loadingupload ? /*#__PURE__*/_jsx(LoadingOutlined, {}) : /*#__PURE__*/_jsx(PlusOutlined, {}), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: \"Unggah\"\n    })]\n  });\n\n  const onChangeCreateClients = e => {\n    var val = e.target.value;\n\n    if (e.target.name === \"role\") {\n      val = parseInt(e.target.value);\n    }\n\n    setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n      [e.target.name]: val\n    }));\n  };\n\n  const onChangeParent = value => {\n    setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n      parent_id: value\n    }));\n  };\n\n  const onChangeSearch = e => {\n    const filtered = datatable2.filter(flt => {\n      return flt.name.toLowerCase().includes(e.target.value.toLowerCase());\n    });\n    setdatatable(filtered);\n  };\n\n  const handleSubmitCreateClients = () => {\n    setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n      role: 2\n    }));\n\n    if (newclients.address === \"\") {\n      setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n        address: \"-\"\n      }));\n    }\n\n    if (newclients.phone_number === \"\") {\n      setnewclients(_objectSpread(_objectSpread({}, newclients), {}, {\n        phone_number: \"-\"\n      }));\n    }\n\n    setloadingbtn(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/addCompanyClient`, {\n      method: \"POST\",\n      headers: {\n        Authorization: JSON.parse(tok),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(newclients)\n    }).then(res => res.json()).then(res2 => {\n      setloadingbtn(false);\n\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setnewclients({\n          name: \"\",\n          role: 0,\n          address: \"\",\n          phone_number: \"\",\n          image_logo: \"\",\n          parent_id: null\n        });\n        setTimeout(() => {\n          setDrawablecreate(false);\n          rt.push(`/admin/clients`);\n        }, 800);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3,\n          style: {\n            zIndex: `1000`\n          }\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    setloaddatatable(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getCompanyClientList`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatatable(res2.data);\n      setdatatable2(res2.data);\n      setloaddatatable(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    pathArr: pathArr,\n    st: st,\n    children: [/*#__PURE__*/_jsx(\"div\", {\n      className: \"flex justify-start md:justify-end p-3 md:border-t-2 md:border-b-2 bg-white mb-4 md:mb-8\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \" w-full flex justify-between items-center px-2\",\n        children: [/*#__PURE__*/_jsx(\"h1\", {\n          className: \"font-bold\",\n          children: \"Clients\"\n        }),\n        /*#__PURE__*/\n        // [157].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n        _jsx(_Button, {\n          type: \"primary\",\n          size: \"large\",\n          onClick: () => {\n            rt.push(`/admin/clients/locations/new?parent=list&frominduk=0`);\n          },\n          children: \"Tambah\"\n        }) // <Button type=\"primary\" size=\"large\" onClick={() => { setDrawablecreate(true); }}>Tambah</Button>\n        ]\n      })\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"p-5 mt-5 flex flex-col space-y-5 rounded-md w-full h-auto bg-white\",\n      children: /*#__PURE__*/_jsx(_Table, {\n        pagination: {\n          pageSize: 6\n        },\n        scroll: {\n          x: 200\n        } // onRow={(record, rowIndex) => {\n        //     return {\n        //         onMouseOver: (event) => {\n        //             var eventscopy = events\n        //             eventscopy[rowIndex] = true\n        //             setEvents(eventscopy)\n        //             setEvent(\"block\")\n        //             setColorhover(\"bg-blue-100\")\n        //         },\n        //         onMouseLeave: (event) => {\n        //             var eventscopy = events\n        //             eventscopy[rowIndex] = false\n        //             setEvents(eventscopy)\n        //             setEvent(\"hidden\")\n        //             setColorhover(\"\")\n        //         }\n        //     }\n        // }}\n        ,\n        columns: columnsTable,\n        dataSource: datatable,\n        loading: loaddatatable\n      })\n    })]\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n  const reqBody = {\n    page: 1,\n    rows: 50,\n    order_by: \"asc\"\n  };\n\n  if (req && req.headers) {\n    const cookies = req.headers.cookie;\n\n    if (!cookies) {\n      res.writeHead(302, {\n        Location: \"/login\"\n      });\n      res.end();\n    }\n\n    if (typeof cookies === \"string\") {\n      const cookiesJSON = httpcookie.parse(cookies);\n      initProps = cookiesJSON.token;\n    }\n  }\n\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps),\n      \"Content-Type\": \"application/json\"\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![155, 156, 157, 158, 159, 160, 161, 162, 163].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n  // const resourcesGCL = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getClientCompanyList`, {\n  //     method: `POST`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps),\n  //         'Content-Type': 'application/json'\n  //     },\n  // })\n  // const resjsonGCL = await resourcesGCL.json()\n  // const dataCompanyList = resjsonGCL\n  // const resourcesGL = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getLocations`, {\n  //     method: `POST`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps),\n  //     },\n  // })\n  // const resjsonGL = await resourcesGL.json()\n  // const dataLocations = resjsonGL\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataCompanyList,\n      // dataLocations,\n      sidemenu: \"52\"\n    }\n  };\n}\nexport default ClientsIndex;","map":null,"metadata":{},"sourceType":"module"}