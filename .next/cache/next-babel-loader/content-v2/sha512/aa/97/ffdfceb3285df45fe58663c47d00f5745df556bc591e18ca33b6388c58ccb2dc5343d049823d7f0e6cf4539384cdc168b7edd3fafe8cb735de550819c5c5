{"ast":null,"code":"import _TreeSelect from \"antd/lib/tree-select\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport _Select from \"antd/lib/select\";\nimport _Input from \"antd/lib/input\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { SearchOutlined } from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useRef, useState } from \"react\";\nimport ButtonSys from \"../../../components/button\";\nimport { SearchIconSvg, UserIconSvg } from \"../../../components/icon\";\nimport { BackIconSvg } from \"../../../components/icon\";\nimport st from \"../../../components/layout-dashboard.module.css\";\nimport Layout from \"../../../components/layout-dashboardNew\";\nimport { TableCustomTicketHistories } from \"../../../components/table/tableCustom\";\nimport { H1, H2, Label, Text } from \"../../../components/typography\";\n\nvar TicketHistories = function TicketHistories(_ref) {\n  var dataProfile = _ref.dataProfile,\n      sidemenu = _ref.sidemenu,\n      initProps = _ref.initProps;\n  //1.Init\n  var rt = useRouter();\n  var pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(1, 2);\n  pathArr.push(\"Riwayat Tiket\"); //2.Use State\n  //TASK HISTORIES\n\n  var _useState = useState({\n    current_page: \"\",\n    data: [],\n    first_page_url: \"\",\n    from: null,\n    last_page: null,\n    last_page_url: \"\",\n    next_page_url: \"\",\n    path: \"\",\n    per_page: null,\n    prev_page_url: null,\n    to: null,\n    total: null\n  }),\n      datarawhistories = _useState[0],\n      setdatarawhistories = _useState[1];\n\n  var _useState2 = useState([]),\n      datahistories = _useState2[0],\n      setdatahistories = _useState2[1];\n\n  var _useState3 = useState({\n    status_ticket: [{\n      id: 0,\n      name: \"\"\n    }],\n    ticket_types: [],\n    incident_type: [],\n    companies: {\n      data: [{\n        id: 0,\n        title: \"\",\n        key: \"\",\n        value: 0\n      }]\n    },\n    ticket_task_types: [],\n    resolved_times: []\n  }),\n      dataticketrelation = _useState3[0],\n      setdatatickrelation = _useState3[1];\n\n  var _useState4 = useState(false),\n      loadinghistories = _useState4[0],\n      setloadinghistories = _useState4[1];\n\n  var _useState5 = useState(false),\n      loadingfilterhistories = _useState5[0],\n      setloadingfilterhistories = _useState5[1];\n\n  var _useState6 = useState(1),\n      pagehistories = _useState6[0],\n      setpagehistories = _useState6[1];\n\n  var _useState7 = useState(10),\n      rowshistories = _useState7[0],\n      setrowshistories = _useState7[1];\n\n  var _useState8 = useState({\n    sort_by: \"\",\n    sort_type: \"\"\n  }),\n      sortinghistories = _useState8[0],\n      setsortinghistories = _useState8[1]; //Filter\n\n\n  var _useState9 = useState([]),\n      datafilterthistories = _useState9[0],\n      setdatafilterthistories = _useState9[1];\n\n  var _useState10 = useState(\"\"),\n      searcingfilterhistories = _useState10[0],\n      setsearcingfilterhistories = _useState10[1];\n\n  var _useState11 = useState(\"\"),\n      tickettypefilterhistories = _useState11[0],\n      settickettypefilterhistories = _useState11[1];\n\n  var _useState12 = useState(\"\"),\n      fromfilterhistories = _useState12[0],\n      setfromfilterhistories = _useState12[1];\n\n  var _useState13 = useState(\"\"),\n      tofilterhistories = _useState13[0],\n      settofilterhistories = _useState13[1];\n\n  var _useState14 = useState(\"\"),\n      locfilterhistories = _useState14[0],\n      setlocfilterhistories = _useState14[1];\n\n  var _useState15 = useState(\"\"),\n      fromresfilterhistories = _useState15[0],\n      setfromresfilterhistories = _useState15[1];\n\n  var _useState16 = useState(\"\"),\n      helperfromresfilterhistories = _useState16[0],\n      sethelperfromresfilterhistories = _useState16[1];\n\n  var _useState17 = useState(\"\"),\n      toresfilterhistories = _useState17[0],\n      settoresfilterhistories = _useState17[1]; //create - ticket histories\n\n\n  var _useState18 = useState(false),\n      drawerhistoriescreate = _useState18[0],\n      setdrawerhistoriescreate = _useState18[1];\n\n  var _useState19 = useState(false),\n      loadinghistoriescreate = _useState19[0],\n      setloadinghistoriescreate = _useState19[1];\n\n  var _useState20 = useState(-1),\n      refreshcreatehistoriescreate = _useState20[0],\n      setrefreshcreatehistoriescreate = _useState20[1]; //delete - ticket histories\n\n\n  var _useState21 = useState({\n    id: null,\n    name: \"\"\n  }),\n      datahistoriesdelete = _useState21[0],\n      setdatahistoriesdelete = _useState21[1];\n\n  var _useState22 = useState(false),\n      modalhistoriesdelete = _useState22[0],\n      setmodalhistoriesdelete = _useState22[1];\n\n  var _useState23 = useState(false),\n      loadinghistoriesdelete = _useState23[0],\n      setloadinghistoriesdelete = _useState23[1];\n\n  var _useState24 = useState(-1),\n      refreshcreatehistoriesdelete = _useState24[0],\n      setrefreshcreatehistoriesdelete = _useState24[1]; //2. Column Table\n\n\n  var columnsTicketHistories = [{\n    title: \"No\",\n    dataIndex: \"num\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: datarawhistories.from + index\n        })\n      };\n    }\n  }, {\n    title: \"No. Tiket\",\n    dataIndex: \"id\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.full_name\n        })\n      };\n    },\n    sorter: function sorter(a, b) {\n      return a.id > b.id;\n    }\n  }, {\n    title: \"Tipe Tiket\",\n    dataIndex: \"type\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.type_name\n        })\n      };\n    },\n    sorter: function sorter(a, b) {\n      return a.type.name.localeCompare(b.type.name);\n    }\n  }, {\n    title: \"Diajukan Oleh\",\n    dataIndex: \"requested_by\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.creator.name\n        })\n      };\n    }\n  }, {\n    title: \"Lokasi Problem\",\n    dataIndex: \"location_id\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.location.full_location\n        })\n      };\n    }\n  }, {\n    title: \"Tanggal Pengajuan\",\n    dataIndex: \"raised_at\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.raised_at\n        })\n      };\n    },\n    sorter: function sorter(a, b) {\n      return a.raised_at.localeCompare(b.raised_at);\n    }\n  }, {\n    title: \"Di-assign Ke\",\n    dataIndex: \"assignable\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.users.length === 0 ? /*#__PURE__*/_jsxs(\"div\", {\n            className: \" flex items-center bg-onhold bg-opacity-10\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \" mr-2\",\n              children: /*#__PURE__*/_jsx(UserIconSvg, {})\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: \"Belum di-assign\"\n            })]\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: record.task.users[0].name\n          })\n        })\n      };\n    }\n  }, {\n    title: \"Durasi Selesai\",\n    dataIndex: \"resolved_times\",\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.resolved_times\n        })\n      };\n    },\n    sorter: function sorter(a, b) {\n      return a.resolved_times.localeCompare(b.resolved_times);\n    }\n  }]; //3. Handler\n\n  var onFilterTicketHistories = function onFilterTicketHistories() {\n    setloadinghistories(true);\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/getClosedTickets?page=\").concat(pagehistories, \"&rows=\").concat(rowshistories, \"&ticket_id=\").concat(searcingfilterhistories, \"&from=\").concat(fromfilterhistories, \"&to=\").concat(tofilterhistories, \"&location_id=\").concat(locfilterhistories, \"&from_res=\").concat(fromresfilterhistories, \"&to_res=\").concat(toresfilterhistories, \"&sort_by=\").concat(sortinghistories.sort_by, \"&sort_type=\").concat(sortinghistories.sort_type), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdatarawhistories(res2.data);\n      setdatahistories(res2.data.data);\n      setdatafilterthistories(res2.data.data);\n      setloadinghistories(false);\n    });\n  }; // const handleDeleteTicketHistories = () => {\n  //     setloadinghistories(true)\n  //     fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/deleteTicketTaskType`, {\n  //         method: 'DELETE',\n  //         headers: {\n  //             'Authorization': JSON.parse(initProps),\n  //             'Content-Type': 'application/json'\n  //         },\n  //         body: JSON.stringify({\n  //             id: datatickettypesdelete.id\n  //         })\n  //     })\n  //         .then((res) => res.json())\n  //         .then(res2 => {\n  //             setloadinghistories(false)\n  //             if (res2.success) {\n  //                 setrefreshcreatetickettypesdelete(prev => prev + 1)\n  //                 setmodaltickettypesdelete(false)\n  //                 notification['success']({\n  //                     message: res2.message,\n  //                     duration: 3\n  //                 })\n  //             }\n  //             else {\n  //                 notification['error']({\n  //                     message: res2.message,\n  //                     duration: 3\n  //                 })\n  //             }\n  //         })\n  // }\n  //4.Use Effect\n\n\n  useEffect(function () {\n    setloadinghistories(true);\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/getClosedTickets?page=\").concat(pagehistories, \"&rows=\").concat(rowshistories, \"&ticket_id=\").concat(searcingfilterhistories, \"&from=\").concat(fromfilterhistories, \"&to=\").concat(tofilterhistories, \"&location_id=\").concat(locfilterhistories, \"&from_res=\").concat(fromresfilterhistories, \"&to_res=\").concat(toresfilterhistories, \"&sort_by=\").concat(sortinghistories.sort_by, \"&sort_type=\").concat(sortinghistories.sort_type), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdatarawhistories(res2.data);\n      setdatahistories(res2.data.data);\n      setdatafilterthistories(res2.data.data);\n      setloadinghistories(false);\n    });\n  }, []);\n  useEffect(function () {\n    fetch(\"\".concat(process.env.NEXT_PUBLIC_BACKEND_URL, \"/\").concat(dataProfile.data.role === 1 ? \"getTicketRelation\" : \"getClientTicketRelation\"), {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setdatatickrelation(res2.data);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \" flex flex-col px-5\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col shadow-md rounded-lg bg-white p-5 mb-6 mx-3\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mr-2 cursor-pointer flex items-center\",\n            onClick: function onClick() {\n              rt.push(\"/tickets\");\n            },\n            children: /*#__PURE__*/_jsx(BackIconSvg, {\n              size: 15,\n              color: \"#000000\"\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mr-2 flex items-center\",\n            children: /*#__PURE__*/_jsx(H1, {\n              children: \"Riwayat Tiket\"\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \" flex items-center mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Input, {\n              value: searcingfilterhistories === \"\" ? null : searcingfilterhistories,\n              style: {\n                width: \"100%\"\n              },\n              placeholder: \"Kata Kunci..\",\n              allowClear: true,\n              onChange: function onChange(e) {\n                if (e.target.value === \"\") {\n                  setsearcingfilterhistories(\"\");\n                } else {\n                  setsearcingfilterhistories(e.target.value);\n                }\n              }\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Select, {\n              value: tickettypefilterhistories === \"\" ? null : tickettypefilterhistories,\n              placeholder: \"Semua Tipe Tiket\",\n              style: {\n                width: \"100%\"\n              },\n              allowClear: true,\n              name: \"task_type\",\n              onChange: function onChange(value) {\n                typeof value === \"undefined\" ? settickettypefilterhistories(\"\") : settickettypefilterhistories(value);\n              },\n              children: dataticketrelation.ticket_types.map(function (doc, idx) {\n                return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: doc.id,\n                  children: doc.name\n                }, idx);\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" w-3/12 mx-1\",\n            children: /*#__PURE__*/_jsx(_DatePicker.RangePicker, {\n              style: {\n                width: \"100%\"\n              },\n              allowEmpty: true,\n              className: \"datepickerStatus\",\n              value: fromfilterhistories === \"\" ? [null, null] : [moment(fromfilterhistories), moment(tofilterhistories)],\n              onChange: function onChange(dates, datestrings) {\n                setfromfilterhistories(datestrings[0]);\n                settofilterhistories(datestrings[1]);\n              }\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mx-1 w-5/12\",\n            children: /*#__PURE__*/_jsx(_TreeSelect, {\n              style: {\n                width: \"100%\"\n              },\n              allowClear: true,\n              placeholder: \"Semua Lokasi\",\n              showSearch: true,\n              suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n              showArrow: true,\n              name: \"locations_id\",\n              onChange: function onChange(value) {\n                typeof value === \"undefined\" ? setlocfilterhistories(\"\") : setlocfilterhistories(value);\n              },\n              treeData: [dataticketrelation.companies],\n              treeDefaultExpandAll: true,\n              value: locfilterhistories === \"\" ? null : locfilterhistories\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Select, {\n              value: helperfromresfilterhistories === \"\" ? null : helperfromresfilterhistories,\n              placeholder: \"Durasi Selesai\",\n              style: {\n                width: \"100%\"\n              },\n              allowClear: true,\n              name: \"resolved_times\",\n              onChange: function onChange(value, option) {\n                typeof value === \"undefined\" ? (setfromresfilterhistories(\"\"), settoresfilterhistories(\"\"), sethelperfromresfilterhistories(\"\")) : (setfromresfilterhistories(option.from), settoresfilterhistories(option.to), sethelperfromresfilterhistories(value));\n              },\n              children: dataticketrelation.resolved_times.map(function (doc, idx) {\n                if (doc.from === null) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 1,\n                  from: \"\",\n                  to: doc.to,\n                  children: \"Kurang dari 3 jam\"\n                }, idx);else if (doc.from === 10800) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 2,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"3 - 12 jam\"\n                }, idx);else if (doc.from === 43200) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 3,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"12 - 30 jam\"\n                }, idx);else if (doc.from === 108000) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 4,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"30 jam - 3 hari\"\n                }, idx);else if (doc.from === 259200) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 5,\n                  from: doc.from,\n                  to: \"\",\n                  children: \"Lebih dari 3 hari\"\n                }, idx);\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-1/12\",\n            children: /*#__PURE__*/_jsx(ButtonSys, {\n              type: \"primary\",\n              onClick: onFilterTicketHistories,\n              children: \"Cari\"\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsx(TableCustomTicketHistories, {\n            dataSource: datahistories,\n            setDataSource: setdatahistories,\n            columns: columnsTicketHistories,\n            loading: loadinghistories,\n            setpraloading: setloadinghistories,\n            pageSize: rowshistories,\n            total: datarawhistories.total,\n            initProps: initProps,\n            setpage: setpagehistories,\n            pagefromsearch: pagehistories,\n            setdataraw: setdatarawhistories,\n            setsorting: setsortinghistories,\n            sorting: sortinghistories,\n            searching: searcingfilterhistories,\n            tickettype: tickettypefilterhistories,\n            fromdate: fromfilterhistories,\n            todate: tofilterhistories,\n            location: locfilterhistories,\n            fromres: fromresfilterhistories,\n            tores: toresfilterhistories\n          })\n        })]\n      })\n    })\n  });\n};\n\nexport var __N_SSP = true;\nexport default TicketHistories;","map":null,"metadata":{},"sourceType":"module"}