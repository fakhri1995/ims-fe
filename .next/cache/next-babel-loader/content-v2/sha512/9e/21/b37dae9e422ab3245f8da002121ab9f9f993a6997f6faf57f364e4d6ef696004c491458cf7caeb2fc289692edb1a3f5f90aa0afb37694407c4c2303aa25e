{"ast":null,"code":"import _Table from \"antd/lib/table\";\nimport _Input from \"antd/lib/input\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport httpcookie from 'cookie';\nimport Link from 'next/link';\nimport { SearchOutlined } from '@ant-design/icons';\nimport Layout from '../../../components/layout-dashboard2';\nimport moment from 'moment';\nimport st from '../../../components/layout-dashboard.module.css';\n\nconst TicketHistories = ({\n  initProps,\n  dataProfile,\n  sidemenu\n}) => {\n  // 1.Init\n  const rt = useRouter();\n  const pathArr = rt.pathname.split(\"/\").slice(1); //useState\n  //2.useState\n\n  const {\n    0: displaydata,\n    1: setdisplaydata\n  } = useState([]);\n  const {\n    0: ticketrelations,\n    1: setticketrelations\n  } = useState({\n    status_ticket: [{\n      id: 0,\n      name: \"\"\n    }],\n    incident_type: [],\n    requesters: [{\n      user_id: 0,\n      fullname: \"\",\n      company_id: 0\n    }],\n    requester_companies: [],\n    companies: [{\n      company_id: 0,\n      company_name: \"\",\n      parent_id: null\n    }]\n  });\n  const {\n    0: displaydata1,\n    1: setdisplaydata1\n  } = useState([]);\n  const {\n    0: displaydata2,\n    1: setdisplaydata2\n  } = useState([]);\n  const {\n    0: displayentiredata,\n    1: setdisplayentiredata\n  } = useState({\n    current_page: 0,\n    data: [],\n    first_page_url: \"\",\n    from: 0,\n    last_page: 0,\n    last_page_url: \"\",\n    next_page_url: null,\n    path: \"\",\n    per_page: \"\",\n    prev_page_url: \"\",\n    to: 0,\n    total: 0\n  });\n  const {\n    0: namasearchact,\n    1: setnamasearchact\n  } = useState(false);\n  const {\n    0: namavalue,\n    1: setnamavalue\n  } = useState(\"\");\n  const {\n    0: rowstate,\n    1: setrowstate\n  } = useState(0);\n  const {\n    0: praloading,\n    1: setpraloading\n  } = useState(true);\n  const {\n    0: inputnumberfalse,\n    1: setinputnumberfalse\n  } = useState(false); //declaration\n\n  const datatableDummies = [{\n    id: 100,\n    ticket_type: 1,\n    raised_by: 1,\n    location_problem: 1,\n    date_raised: \"2021-10-19T08:00:46.384Z\",\n    assign_to: 2,\n    status: 1\n  }, {\n    id: 200,\n    ticket_type: 1,\n    raised_by: 1,\n    location_problem: 1,\n    date_raised: \"2021-02-19T16:00:46.384Z\",\n    assign_to: 3,\n    status: 2\n  }, {\n    id: 300,\n    ticket_type: 1,\n    raised_by: 1,\n    location_problem: 1,\n    date_raised: \"2019-11-19T23:00:50.384Z\",\n    assign_to: 4,\n    status: 3\n  }];\n  const column = [{\n    title: 'No Ticket',\n    dataIndex: 'ticket_type',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsxs(_Fragment, {\n          children: [record.type.id === 1 && `#${record.type.code} - `, record.ticketable.id]\n        })\n      };\n    }\n  }, {\n    title: 'Raised By',\n    dataIndex: 'raised_by',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.requester.name\n        })\n      };\n    }\n  }, {\n    title: 'Lokasi Problem',\n    dataIndex: 'location_problem',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.ticketable.location.name\n        })\n      };\n    }\n  }, {\n    title: 'Date Raised',\n    dataIndex: 'date_raised',\n    render: (text, record, index) => {\n      // var jumlahHari = Math.floor((new Date().getTime() - new Date(record.date_raised).getTime()) / (1000 * 3600 * 24))\n      // var jumlahJam = \"\"\n      // if (jumlahHari < 1) {\n      //     jumlahJam = Math.floor((new Date().getTime() - new Date(record.date_raised).getTime()) / (1000 * 3600))\n      // }\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.raised_at\n        })\n      };\n    }\n  }, {\n    title: 'Assign To',\n    dataIndex: 'assign_to',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.assignable.name\n        })\n      };\n    }\n  }]; //handler\n  //search nama\n\n  const onChangeSearch = e => {\n    if (e.target.value === \"\") {\n      setdisplaydata(displaydata2);\n      setnamasearchact(false);\n    } else {\n      if (/(^\\d*$)/.test(e.target.value)) {\n        setinputnumberfalse(false);\n        setnamasearchact(true);\n        setnamavalue(e.target.value);\n      } else {\n        setinputnumberfalse(true);\n      }\n    }\n  };\n\n  const onFinalClick = () => {\n    // var datatemp = displaydata1\n    // if (namasearchact) {\n    //     datatemp = datatemp.filter(flt => {\n    //         return flt.id === namavalue\n    //     })\n    // }\n    // setdisplaydata(datatemp)\n    if (inputnumberfalse === false) {\n      setpraloading(true);\n      fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getClosedTickets\" : \"getClientClosedTickets\"}?ticket_id=${namasearchact ? namavalue : \"\"}`, {\n        method: `GET`,\n        headers: {\n          'Authorization': JSON.parse(initProps)\n        }\n      }).then(res => res.json()).then(res2 => {\n        res2.data.tickets.data.length === 0 ? setdisplaydata([]) : setdisplaydata(res2.data.tickets.data);\n        setpraloading(false);\n      });\n    }\n  }; //5.useEffect\n\n\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getClosedTickets\" : \"getClientClosedTickets\"}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdisplayentiredata(res2.data.tickets);\n      setdisplaydata(res2.data.tickets.data);\n      setdisplaydata1(res2.data.tickets.data);\n      setdisplaydata2(res2.data.tickets.data);\n      setpraloading(false);\n    }).then(() => {\n      fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getTicketRelation\" : \"getClientTicketRelation\"}`, {\n        method: `GET`,\n        headers: {\n          'Authorization': JSON.parse(initProps)\n        }\n      }).then(res => res.json()).then(res2 => {\n        setticketrelations(res2.data);\n        setpraloading(false);\n      });\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \" w-full grid grid-cols-1 md:grid-cols-4 border-t border-b bg-white mb-5 px-4 py-5\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-3 flex items-center mb-2 md:mb-0\",\n        children: /*#__PURE__*/_jsx(\"div\", {\n          className: \"font-bold text-2xl w-auto mr-14\",\n          children: \"History Tickets Closed\"\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-1 flex md:justify-end items-center\",\n        children: /*#__PURE__*/_jsx(Link, {\n          href: '/tickets/exporting?closed=1',\n          children: /*#__PURE__*/_jsx(_Button, {\n            size: \"large\",\n            type: \"primary\",\n            style: {\n              marginRight: `1rem`\n            },\n            children: \"Export\"\n          })\n        })\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"h-auto w-full grid grid-cols-1 md:grid-cols-5 mb-5 bg-white rounded-md\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:col-span-5 col-span-1 flex flex-col py-3\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-8\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" w-full mr-1 grid grid-cols-12\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \"col-span-4 mr-1\",\n              children: [/*#__PURE__*/_jsx(_Input, {\n                style: {\n                  width: `100%`,\n                  marginRight: `0.5rem`\n                },\n                placeholder: \"Cari Ticket Number\",\n                onChange: onChangeSearch,\n                allowClear: true\n              }), inputnumberfalse && /*#__PURE__*/_jsx(\"p\", {\n                className: \"mb-0 text-xs text-red-400\",\n                children: \"Ticket number harus angka\"\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \" col-span-1\",\n              children: /*#__PURE__*/_jsx(_Button, {\n                type: \"primary\",\n                style: {\n                  width: `100%`\n                },\n                onClick: onFinalClick,\n                children: /*#__PURE__*/_jsx(SearchOutlined, {})\n              })\n            })]\n          })\n        }), /*#__PURE__*/_jsx(\"div\", {\n          className: \"px-10\",\n          children: /*#__PURE__*/_jsx(_Table, {\n            pagination: {\n              pageSize: 10,\n              total: displayentiredata.total,\n              onChange: (page, pageSize) => {\n                setpraloading(true);\n                fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getClosedTickets\" : \"getClientClosedTickets\"}?page=${page}&rows=10`, {\n                  method: `GET`,\n                  headers: {\n                    'Authorization': JSON.parse(initProps)\n                  }\n                }).then(res => res.json()).then(res2 => {\n                  setdisplayentiredata(res2.data.tickets);\n                  setdisplaydata(res2.data.tickets.data);\n                  setdisplaydata1(res2.data.tickets.data);\n                  setdisplaydata2(res2.data.tickets.data);\n                  setpraloading(false);\n                });\n              }\n            },\n            scroll: {\n              x: 200\n            },\n            dataSource: displaydata,\n            columns: column,\n            loading: praloading,\n            onRow: (record, rowIndex) => {\n              return {\n                onMouseOver: event => {\n                  setrowstate(record.id);\n                },\n                onClick: event => {\n                  // {\n                  //     [107, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n                  rt.push(`/tickets/detail/${record.id}`); //         :\n                  //         null\n                  // }\n                }\n              };\n            },\n            rowClassName: (record, idx) => {\n              return record.id === rowstate ? `cursor-pointer` : ``;\n            }\n          })\n        })]\n      })\n    })]\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![107, 108, 109, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"2\"\n    }\n  };\n}\nexport default TicketHistories;","map":null,"metadata":{},"sourceType":"module"}