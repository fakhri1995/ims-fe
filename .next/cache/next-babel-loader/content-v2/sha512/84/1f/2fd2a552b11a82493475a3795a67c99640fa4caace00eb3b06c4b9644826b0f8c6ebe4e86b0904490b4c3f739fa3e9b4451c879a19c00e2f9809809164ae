{"ast":null,"code":"import _Input from \"antd/lib/input\";\nimport _Button from \"antd/lib/button\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../../../components/layout-dashboard\";\nimport st from \"../../../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nconst ModuleUpdate = ({\n  initProps,\n  sidemenu,\n  dataProfile,\n  idmodule\n}) => {\n  //1. Init\n  const rt = useRouter();\n  const {\n    module\n  } = rt.query;\n\n  const [instanceForm] = _Form.useForm(); //useState\n  //1. Basic\n\n\n  const {\n    0: patharr,\n    1: setpatharr\n  } = useState([]);\n  const {\n    0: datadisplay,\n    1: setdatadisplay\n  } = useState({\n    id: \"\",\n    key: \"\",\n    name: \"\",\n    status: \"\",\n    company_id: \"\",\n    description: \"\",\n    feature: []\n  }); //2. Create\n\n  const {\n    0: updatedata,\n    1: setupdatedata\n  } = useState({\n    id: Number(idmodule),\n    name: \"\",\n    description: \"\"\n  });\n  const {\n    0: loadingupdate,\n    1: setloadingupdate\n  } = useState(false);\n  const {\n    0: praloading,\n    1: setpraloading\n  } = useState(true); //handleCreate\n\n  const handleUpdateModule = () => {\n    setloadingupdate(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/updateModule`, {\n      method: \"PUT\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(updatedata)\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: \"Modul berhasil diubah\",\n          duration: 3\n        });\n\n        setTimeout(() => {\n          setloadingupdate(false);\n          rt.push(`/admin/modules?module=${module}&featuredisplay=1`);\n        }, 500);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setloadingupdate(false);\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getModules`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      const detaildata = res2.data.filter(flt => {\n        return flt.id === Number(idmodule);\n      })[0];\n      const temp = {\n        id: detaildata.id,\n        key: detaildata.key,\n        name: detaildata.name,\n        status: detaildata.status,\n        company_id: detaildata.company_id,\n        description: detaildata.description,\n        feature: detaildata.feature\n      };\n      setupdatedata(_objectSpread(_objectSpread({}, updatedata), {}, {\n        name: detaildata.name,\n        description: detaildata.description\n      }));\n      setdatadisplay(temp);\n      setpraloading(false);\n      var pathArr = rt.pathname.split(\"/\").slice(1);\n      pathArr.splice(2, 2);\n      pathArr[pathArr.length - 1] = `Ubah Module - ${detaildata.name}`;\n      setpatharr(pathArr);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: initProps,\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    pathArr: patharr,\n    st: st,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      id: \"createAgentsWrapper\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-4\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#createAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" col-span-4 flex justify-between p-2 pt-4 border-t-2 border-b-2 bg-white mb-8\",\n            children: [/*#__PURE__*/_jsxs(\"h1\", {\n              className: \"font-semibold py-2\",\n              children: [\"Ubah Module - \", datadisplay.name]\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [/*#__PURE__*/_jsx(Link, {\n                href: \"/admin/modules\",\n                children: /*#__PURE__*/_jsx(_Button, {\n                  type: \"default\",\n                  onClick: () => {\n                    window.location.href = `/admin/modules?module=${module}&featuredisplay=1`;\n                  },\n                  children: \"Batal\"\n                })\n              }), /*#__PURE__*/_jsx(_Button, {\n                type: \"primary\",\n                loading: loadingupdate,\n                onClick: instanceForm.submit,\n                children: \"Simpan\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-3 flex flex-col\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"shadow-lg flex flex-col rounded-md w-full h-auto p-4 mb-14\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"border-b border-black p-4 font-semibold mb-5\",\n            children: \"Ubah Module\"\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"grid grid-cols-1 md:grid-cols-4\",\n            children: praloading ? null : /*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-3\",\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                form: instanceForm,\n                initialValues: datadisplay,\n                className: \"createAgentsForm\",\n                onFinish: handleUpdateModule,\n                children: [/*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Nama Modul\",\n                  required: true,\n                  name: \"name\",\n                  rules: [{\n                    required: true,\n                    message: \"Nama Modul wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    defaultValue: datadisplay.name,\n                    name: `name`,\n                    onChange: e => {\n                      setupdatedata(_objectSpread(_objectSpread({}, updatedata), {}, {\n                        name: e.target.value\n                      }));\n                    }\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Deskripsi\",\n                  required: true,\n                  name: \"description\",\n                  rules: [{\n                    required: true,\n                    message: \"Deskripsi wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input.TextArea, {\n                    rows: 4,\n                    defaultValue: datadisplay.description,\n                    name: `description`,\n                    onChange: e => {\n                      setupdatedata(_objectSpread(_objectSpread({}, updatedata), {}, {\n                        description: e.target.value\n                      }));\n                    }\n                  })\n                })]\n              })\n            })\n          })]\n        })\n      })]\n    })\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res,\n  params\n}) {\n  const idmodule = params.moduleId;\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resources = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjson = await resources.json();\n  const dataProfile = resjson; // if (![179, 180, 181, 182].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"72\",\n      idmodule\n    }\n  };\n}\nexport default ModuleUpdate;","map":null,"metadata":{},"sourceType":"module"}