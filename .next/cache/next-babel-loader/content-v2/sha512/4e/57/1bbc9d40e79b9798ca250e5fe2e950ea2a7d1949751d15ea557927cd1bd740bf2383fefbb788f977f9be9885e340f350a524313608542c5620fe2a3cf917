{"ast":null,"code":"import _Select from \"antd/lib/select\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Input from \"antd/lib/input\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Upload from \"antd/lib/upload\";\nimport _Button from \"antd/lib/button\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _Form from \"antd/lib/form\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport LoadingOutlined from \"@ant-design/icons/LoadingOutlined\";\nimport PlusOutlined from \"@ant-design/icons/PlusOutlined\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../../components/layout-dashboard\";\nimport st from \"../../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nfunction modifData(dataa) {\n  for (var i = 0; i < dataa.length; i++) {\n    dataa[i][\"key\"] = dataa[i].id;\n    dataa[i][\"value\"] = dataa[i].id;\n    dataa[i][\"title\"] = dataa[i].name;\n    dataa[i][\"children\"] = dataa[i].members;\n    delete dataa[i].members;\n    if (dataa[i].children) [modifData(dataa[i].children)];\n  }\n\n  return dataa;\n}\n\nfunction RequestersCreate({\n  initProps,\n  dataProfile,\n  sidemenu,\n  dataCompanyList\n}) {\n  const rt = useRouter();\n  const tok = initProps;\n  var pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr[pathArr.length - 1] = \"Create\"; // dataCompanyList = dataCompanyList.data.members.filter(data => data.company_id !== 66)\n\n  const [instanceForm] = _Form.useForm(); //useState\n\n\n  const {\n    0: newuserrequesters,\n    1: setNewuserrequesters\n  } = useState({\n    fullname: \"\",\n    email: \"\",\n    role_ids: [],\n    phone_number: \"\",\n    profile_image: \"\",\n    company_id: 0,\n    password: \"\",\n    confirm_password: \"\",\n    position: \"\"\n  });\n  const {\n    0: loadingupload,\n    1: setLoadingupload\n  } = useState(false);\n  const {\n    0: loadingcreate,\n    1: setLoadingcreate\n  } = useState(false);\n  const {\n    0: datacompanylist,\n    1: setdatacompanylist\n  } = useState([]);\n  const {\n    0: dataraw1,\n    1: setdataraw1\n  } = useState([]);\n  const {\n    0: praloading,\n    1: setpraloading\n  } = useState(true); //handleCreateButton\n\n  const handleCreateAgents = () => {\n    setLoadingcreate(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/addRequesterMember`, {\n      method: \"POST\",\n      headers: {\n        Authorization: JSON.parse(tok),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(newuserrequesters)\n    }).then(res => res.json()).then(res2 => {\n      setLoadingcreate(false);\n\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/requesters/detail/${res2.id}`);\n        }, 1000);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n    console.log(\"isi new user: \" + newuserrequesters.profile_image);\n  };\n\n  const onChangeCreateRequesters = e => {\n    setNewuserrequesters(_objectSpread(_objectSpread({}, newuserrequesters), {}, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  const beforeUploadProfileImage = file => {\n    const isJpgOrPng = file.type === \"image/jpeg\" || file.type === \"image/png\" || file.type === \"image/jpg\";\n\n    if (!isJpgOrPng) {\n      message.error(\"You can only upload JPG/PNG file!\");\n    }\n\n    const isLt2M = file.size / 1024 / 1024 < 2;\n\n    if (!isLt2M) {\n      message.error(\"Image must smaller than 2MB!\");\n    }\n\n    return isJpgOrPng && isLt2M;\n  };\n\n  const onChangeProfileImage = async info => {\n    if (info.file.status === \"uploading\") {\n      setLoadingupload(true);\n      return;\n    }\n\n    if (info.file.status === \"done\") {\n      console.log(\"isi upload: \" + info.file.originFileObj.name);\n      const formData = new FormData();\n      formData.append(\"file\", info.file.originFileObj);\n      formData.append(\"upload_preset\", \"migsys\");\n      return fetch(`https://api.Cloudinary.com/v1_1/aqlpeduli/image/upload`, {\n        method: \"POST\",\n        body: formData\n      }).then(res => res.json()).then(res2 => {\n        setNewuserrequesters(_objectSpread(_objectSpread({}, newuserrequesters), {}, {\n          profile_image: res2.secure_url\n        }));\n      });\n    }\n  };\n\n  const uploadButton = /*#__PURE__*/_jsxs(\"div\", {\n    children: [loadingupload ? /*#__PURE__*/_jsx(LoadingOutlined, {}) : /*#__PURE__*/_jsx(PlusOutlined, {}), /*#__PURE__*/_jsx(\"div\", {\n      style: {\n        marginTop: 8\n      },\n      children: \"Upload\"\n    })]\n  }); //useEffect\n\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getClientCompanyList`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatacompanylist(res2.data.children);\n      setpraloading(false);\n    });\n  }, []);\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoles`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdataraw1(res2.data);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    st: st,\n    children: /*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      id: \"createAgentsWrapper\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-4\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#createAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex justify-between p-2 pt-4 border-t-2 border-b-2 bg-white mb-8\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold py-2\",\n              children: \"Buat Akun Requester\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [/*#__PURE__*/_jsx(_Button, {\n                disabled: praloading,\n                onClick: () => {\n                  rt.push(`/admin/requesters`);\n                },\n                type: \"default\",\n                children: \"Batal\"\n              }), /*#__PURE__*/_jsx(_Button, {\n                disabled: praloading,\n                loading: loadingcreate,\n                onClick: instanceForm.submit,\n                type: \"primary\",\n                children: \"Simpan\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-3 flex flex-col\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"shadow-lg flex flex-col rounded-md w-full h-auto p-4 mb-14\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"border-b border-black p-4 font-semibold mb-5\",\n            children: [\"Akun Requester - \", newuserrequesters.fullname]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"grid grid-cols-1 md:grid-cols-4\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-1\",\n              children: /*#__PURE__*/_jsx(_Upload, {\n                name: \"profile_image\",\n                listType: \"picture-card\",\n                className: \"profileImage\",\n                showUploadList: false,\n                beforeUpload: beforeUploadProfileImage,\n                onChange: onChangeProfileImage,\n                children: newuserrequesters.profile_image ? /*#__PURE__*/_jsx(\"img\", {\n                  src: newuserrequesters.profile_image,\n                  alt: \"avatar\",\n                  style: {\n                    width: \"100%\"\n                  }\n                }) : uploadButton\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"p-3 col-span-1 md:col-span-3\",\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                className: \"createAgentsForm\",\n                onFinish: handleCreateAgents,\n                form: instanceForm,\n                children: [/*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Asal Lokasi\",\n                  name: \"company_id\",\n                  rules: [{\n                    required: true,\n                    message: \"Asal Lokasi wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_TreeSelect, {\n                    allowClear: true,\n                    dropdownStyle: {\n                      maxHeight: 400,\n                      overflow: \"auto\"\n                    },\n                    treeData: datacompanylist,\n                    placeholder: \"Pilih Asal Lokasi\",\n                    treeDefaultExpandAll: true,\n                    onChange: value => {\n                      setNewuserrequesters(_objectSpread(_objectSpread({}, newuserrequesters), {}, {\n                        company_id: value\n                      }));\n                    }\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Nama Lengkap\",\n                  required: true,\n                  name: \"fullname\",\n                  rules: [{\n                    required: true,\n                    message: \"Nama Lengkap wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuserrequesters.fullname,\n                    name: `fullname`,\n                    onChange: onChangeCreateRequesters\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Email\",\n                  required: true,\n                  name: \"email\",\n                  rules: [{\n                    required: true,\n                    message: \"Email wajib diisi\"\n                  }, {\n                    pattern: /(\\-)|(^(([^<>()[\\]\\\\.,;:\\s@\\\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\\\"]+)*)|(\\\".+\\\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$)/,\n                    message: \"Email belum diisi dengan benar\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuserrequesters.email,\n                    name: `email`,\n                    onChange: onChangeCreateRequesters\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Posisi\",\n                  required: true,\n                  name: \"position\",\n                  rules: [{\n                    required: true,\n                    message: \"Posisi wajib diisi\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuserrequesters.position,\n                    name: `position`,\n                    onChange: onChangeCreateRequesters\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"No. Handphone\",\n                  name: \"phone_number\",\n                  rules: [{\n                    required: true,\n                    message: \"No. Handphone wajib diisi\"\n                  }, {\n                    pattern: /(\\-)|(^\\d*$)/,\n                    message: \"No. Handphone harus berisi angka\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input, {\n                    value: newuserrequesters.phone_number,\n                    name: `phone_number`,\n                    onChange: onChangeCreateRequesters\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Password\",\n                  name: \"password\",\n                  rules: [{\n                    required: true,\n                    message: \"Password wajib diisi\"\n                  }, {\n                    pattern: /([A-z0-9]{8})/,\n                    message: \"Password minimal 8 karakter\"\n                  }],\n                  children: /*#__PURE__*/_jsx(_Input.Password, {\n                    value: newuserrequesters.password,\n                    name: `password`,\n                    onChange: onChangeCreateRequesters\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Konfirmasi Password\",\n                  name: \"password\",\n                  rules: [{\n                    required: true,\n                    message: \"Confirm Password wajib diisi\"\n                  }, {\n                    pattern: /([A-z0-9]{8})/,\n                    message: \"Confirm Password minimal 8 karakter\"\n                  }],\n                  children: /*#__PURE__*/_jsxs(_Fragment, {\n                    children: [/*#__PURE__*/_jsx(_Input.Password, {\n                      value: newuserrequesters.confirm_password,\n                      name: `confirm_password`,\n                      onChange: onChangeCreateRequesters\n                    }), newuserrequesters.password !== newuserrequesters.confirm_password && /*#__PURE__*/_jsx(\"p\", {\n                      className: \" text-red-500 mb-0\",\n                      children: \"Confirm Password harus sesuai dengan password\"\n                    })]\n                  })\n                }), /*#__PURE__*/_jsx(_Form.Item, {\n                  label: \"Role\",\n                  name: \"role\",\n                  children: /*#__PURE__*/_jsx(_Select, {\n                    mode: \"multiple\",\n                    onChange: value => {\n                      setNewuserrequesters(_objectSpread(_objectSpread({}, newuserrequesters), {}, {\n                        role_ids: value\n                      }));\n                    }\n                    /*defaultValue={idrole}*/\n                    ,\n                    style: {\n                      width: `100%`\n                    },\n                    children: dataraw1.map((doc, idx) => {\n                      return /*#__PURE__*/_jsx(_Select.Option, {\n                        value: doc.id,\n                        children: doc.name\n                      }, doc.id);\n                    })\n                  })\n                })]\n              })\n            })]\n          })]\n        })\n      })]\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  const reqBody = {\n    page: 1,\n    rows: 50,\n    order_by: \"asc\"\n  };\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resources = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjson = await resources.json();\n  const dataProfile = resjson; // if (![117].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n  // const resourcesGCL = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getClientCompanyList`, {\n  //     method: `POST`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps),\n  //         'Content-Type': 'application/json'\n  //     },\n  //     body: JSON.stringify(reqBody)\n  // })\n  // const resjsonGCL = await resourcesGCL.json()\n  // const dataCompanyList = resjsonGCL\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataCompanyList,\n      sidemenu: \"62\"\n    }\n  };\n}\nexport default RequestersCreate;","map":null,"metadata":{},"sourceType":"module"}