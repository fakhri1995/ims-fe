{"ast":null,"code":"import _Tree from \"antd/lib/tree\";\nimport _Empty from \"antd/lib/empty\";\nimport _Spin from \"antd/lib/spin\";\nimport _Modal from \"antd/lib/modal\";\nimport _Form from \"antd/lib/form\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Input from \"antd/lib/input\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport httpcookie from 'cookie';\nimport Layout from '../../../components/layout-dashboard';\nimport st from '../../../components/layout-dashboard.module.css';\n\nfunction AssetsIndex({\n  initProps,\n  dataProfile,\n  sidemenu,\n  dataAssetsList\n}) {\n  const rt = useRouter();\n  const tok = initProps;\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  const {\n    0: loadingbtn,\n    1: setloadingbtn\n  } = useState(false);\n  const {\n    0: loadingbtnfromparent,\n    1: setloadingbtnparent\n  } = useState(false);\n  const {\n    0: loadingdelete,\n    1: setlaodingdelete\n  } = useState(false);\n  const {\n    0: searchValue,\n    1: setSearchValue\n  } = useState(\"\"); //useState\n\n  const {\n    0: maindata,\n    1: setmaindata\n  } = useState([]);\n  const {\n    0: praloading,\n    1: setpraloading\n  } = useState(true);\n  const {\n    0: newmodal,\n    1: setNewmodal\n  } = useState(false);\n  const {\n    0: newmodalparent,\n    1: setNewmodalparent\n  } = useState(false);\n  const {\n    0: modaldelete,\n    1: setmodaldelete\n  } = useState(false);\n  const {\n    0: parentadd,\n    1: setParentadd\n  } = useState(\"\");\n  const {\n    0: parenttitle,\n    1: setParenttitle\n  } = useState(\"\");\n  const {\n    0: datanew,\n    1: setDatanew\n  } = useState({\n    name: '',\n    parent: ''\n  });\n  const {\n    0: datadelete,\n    1: setDatadelete\n  } = useState({\n    id: 0\n  });\n\n  const onChangeAddAssets = e => {\n    setDatanew(_objectSpread(_objectSpread({}, datanew), {}, {\n      [e.target.name]: e.target.value\n    }));\n  };\n\n  const {\n    0: autoExpandParent,\n    1: setAutoExpandParent\n  } = useState(true);\n  const {\n    0: expandedKeys,\n    1: setExpandedKeys\n  } = useState([]); //onChange\n\n  const onChangeParent = value => {\n    setDatanew(_objectSpread(_objectSpread({}, datanew), {}, {\n      [\"parent\"]: value\n    }));\n  };\n\n  const onExpand = expandedKeys => {\n    setExpandedKeys(expandedKeys);\n    setAutoExpandParent(false);\n  }; //filterAsset\n\n\n  const dataList = [];\n\n  const generateList = data => {\n    for (let i = 0; i < data.length; i++) {\n      const node = data[i];\n      const {\n        id,\n        key,\n        value,\n        id_parent,\n        title\n      } = node;\n      dataList.push({\n        id,\n        key,\n        value,\n        id_parent,\n        title\n      });\n\n      if (node.children) {\n        generateList(node.children);\n      }\n    }\n  };\n\n  generateList(maindata);\n\n  const getParentKey = (key, tree) => {\n    let parentKey;\n\n    for (let i = 0; i < tree.length; i++) {\n      const node = tree[i];\n\n      if (node.children) {\n        if (node.children.some(item => item.key === key)) {\n          parentKey = node.key;\n        } else if (getParentKey(key, node.children)) {\n          parentKey = getParentKey(key, node.children);\n        }\n      }\n    }\n\n    return parentKey;\n  };\n\n  const onChangeFilterAsset = e => {\n    const {\n      value\n    } = e.target;\n    const expandedKeys = dataList.map(item => {\n      if (item.title.indexOf(value) > -1) {\n        return getParentKey(item.key, maindata);\n      }\n\n      return null;\n    }).filter((item, i, self) => item && self.indexOf(item) === i);\n\n    if (value) {\n      setExpandedKeys(expandedKeys);\n      setSearchValue(value);\n      setAutoExpandParent(true);\n    } else {\n      setExpandedKeys(maindata.map(doc => doc.key));\n      setSearchValue(\"\");\n      setAutoExpandParent(false);\n    }\n  };\n\n  const filterTreeNode = node => {\n    const title = node.title.props.children[0].props ? node.title.props.children[0].props.children[2] : node.title.props.children[2];\n    const result = title ? title.indexOf(searchValue) !== -1 ? true : false : false;\n    return result;\n  };\n\n  const loop = data => data.map(item => {\n    const index = item.title.indexOf(searchValue);\n    const beforeStr = item.title.substr(0, index);\n    const afterStr = item.title.substr(index + searchValue.length); // const prt = item.value.substring(0, item.value.length - 4)\n\n    const title = index > -1 ? /*#__PURE__*/_jsxs(\"div\", {\n      className: `flex justify-between md:h-7 hover:bg-blue-100 text-black`,\n      onMouseOver: () => {\n        var d = document.getElementById(`node${item.key}`);\n        d.classList.add(\"flex\");\n        d.classList.remove(\"hidden\");\n      },\n      onMouseLeave: () => {\n        var e = document.getElementById(`node${item.key}`);\n        e.classList.add(\"hidden\");\n        e.classList.remove(\"flex\");\n      },\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"w-full\",\n        onClick: () => {\n          rt.push(`/admin/assets/detail/${item.id}`);\n        },\n        children: [beforeStr, /*#__PURE__*/_jsx(\"span\", {\n          className: \" text-blue-500\",\n          children: searchValue\n        }), afterStr]\n      }), /*#__PURE__*/_jsx(\"div\", {\n        className: `hidden mx-2`,\n        id: `node${item.key}`,\n        children: /*#__PURE__*/_jsx(\"a\", {\n          className: \"mx-2 py-2 flex items-center\",\n          alt: \"add\",\n          onClick: () => {\n            rt.push(`/admin/assets/create?idparent=${item.id}&codeparent=${item.value}`);\n            /*setNewmodalparent(true); fungsiSetParent(item.value); setParenttitle(item.title)*/\n          },\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"rounded-full bg-black text-white h-5 w-5 flex items-center text-xs justify-center hover:bg-gray-700\",\n            children: \"+\"\n          })\n        })\n      })]\n    }) : /*#__PURE__*/_jsx(\"span\", {\n      children: item.title\n    });\n\n    if (item.children) {\n      return {\n        title,\n        key: item.key,\n        children: loop(item.children)\n      };\n    }\n\n    return {\n      title,\n      key: item.key\n    };\n  });\n\n  const handleAddAssets = () => {\n    // rt.push(`/assets/update/${datanew.name}?originPath=Admin&title=${datanew.name}&parent=${datanew.parent}&create=true`)\n    setloadingbtn(true);\n    setloadingbtnparent(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/addAsset`, {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(datanew)\n    }).then(res => res.json()).then(res2 => {\n      setloadingbtn(false);\n      setloadingbtnparent(false); // return\n\n      if (res2.success) {\n        setNewmodal(false);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/assets/${datanew.name}?parent=${datanew.parent}&create=true`);\n        }, 500);\n      } else if (!res2.success) {\n        setNewmodal(false);\n\n        _notification['error']({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n      }\n    });\n  };\n\n  const handleDeleteAssets = () => {\n    setlaodingdelete(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/deleteAsset`, {\n      method: 'DELETE',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(datadelete)\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        setlaodingdelete(false);\n        setmodaldelete(false);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/assets`);\n        }, 500);\n      } else if (!res2.success) {\n        setlaodingdelete(false);\n        setmodaldelete(false);\n\n        _notification['error']({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getAssets`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      if (typeof res2.data === 'undefined') {\n        res2.data = [];\n        setmaindata(res2.data);\n        setpraloading(false);\n      } else {\n        setmaindata(res2.data);\n        const defaultexpand = res2.data.map(doc => doc.key);\n        setExpandedKeys(defaultexpand);\n        setpraloading(false);\n      }\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    dataProfile: dataProfile,\n    st: st,\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \"w-full h-auto border-t border-opacity-30 border-gray-500 bg-white\",\n      children: /*#__PURE__*/_jsx(\"div\", {\n        className: \"grid grid-cols-1 md:grid-cols-4\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"col-span-1 md:col-span-4 flex flex-col\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"p-2 md:p-5 mb-5 border-b flex justify-between\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"text-xs md:text-sm font-semibold\",\n              children: /*#__PURE__*/_jsx(\"h1\", {\n                className: \"mt-2 font-semibold text-xl\",\n                children: \"Assets Types\"\n              })\n            }), /*#__PURE__*/_jsx(_Button, {\n              disabled: praloading,\n              type: \"primary\",\n              size: \"large\",\n              onClick: () => {\n                /*setNewmodal(true)*/\n                rt.push(`/admin/assets/create?idparent=&codeparent=`);\n              },\n              children: \"Tambah\"\n            }), praloading ? null : /*#__PURE__*/_jsx(_Modal, {\n              title: \"Tambah Assets Type & Field\",\n              visible: newmodal,\n              onCancel: () => setNewmodal(false),\n              maskClosable: false,\n              footer: null,\n              style: {\n                top: `3rem`\n              },\n              width: 800,\n              destroyOnClose: true,\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                onFinish: handleAddAssets,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"grid grid-cols-1 md:grid-cols-3 mb-5\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Nama:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      onChange: onChangeAddAssets,\n                      name: \"name\",\n                      value: datanew.name,\n                      allowClear: true,\n                      required: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Deskripsi:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      name: \"description\",\n                      allowClear: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Parent:\"\n                    }), /*#__PURE__*/_jsx(_TreeSelect, {\n                      style: {\n                        width: '100%'\n                      },\n                      dropdownStyle: {\n                        maxHeight: 400,\n                        overflow: 'auto'\n                      },\n                      treeData: maindata,\n                      placeholder: \"Pilih parent\",\n                      treeDefaultExpandAll: true,\n                      onChange: value => {\n                        onChangeParent(value);\n                      },\n                      allowClear: true,\n                      required: true\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \"flex justify-end\",\n                  children: [/*#__PURE__*/_jsx(_Button, {\n                    type: \"default\",\n                    onClick: () => {\n                      setNewmodal(false);\n                    },\n                    style: {\n                      marginRight: `1rem`\n                    },\n                    children: \"Cancel\"\n                  }), /*#__PURE__*/_jsx(_Button, {\n                    htmlType: \"submit\",\n                    loading: loadingbtn,\n                    type: \"primary\",\n                    size: \"middle\",\n                    children: \"Save\"\n                  })]\n                })]\n              })\n            }), praloading ? null : /*#__PURE__*/_jsx(_Modal, {\n              title: `Tambah Assets Type & Field dari parent ${parenttitle}`,\n              visible: newmodalparent,\n              onCancel: () => {\n                setNewmodalparent(false);\n                setParentadd(\"\");\n              },\n              maskClosable: false,\n              footer: null,\n              style: {\n                top: `3rem`\n              },\n              width: 800,\n              destroyOnClose: true,\n              children: /*#__PURE__*/_jsxs(_Form, {\n                layout: \"vertical\",\n                onFinish: handleAddAssets,\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  className: \"grid grid-cols-1 md:grid-cols-3 mb-5\",\n                  children: [/*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Nama:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      onChange: onChangeAddAssets,\n                      name: \"name\",\n                      value: datanew.name,\n                      allowClear: true,\n                      required: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Deskripsi:\"\n                    }), /*#__PURE__*/_jsx(_Input, {\n                      name: \"description\",\n                      allowClear: true\n                    })]\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: \"flex flex-col mx-3\",\n                    children: [/*#__PURE__*/_jsx(\"h1\", {\n                      className: \"text-sm\",\n                      children: \"Parent:\"\n                    }), /*#__PURE__*/_jsx(_TreeSelect, {\n                      style: {\n                        width: '100%'\n                      },\n                      dropdownStyle: {\n                        maxHeight: 400,\n                        overflow: 'auto'\n                      },\n                      defaultValue: parentadd // value={parentadd}\n                      ,\n                      treeData: maindata,\n                      placeholder: \"Pilih parent\",\n                      treeDefaultExpandAll: true // onChange={(value) => { onChangeParent(value) }}\n                      ,\n                      disabled: true,\n                      allowClear: true\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsx(_Button, {\n                  htmlType: \"submit\",\n                  loading: loadingbtnfromparent,\n                  type: \"primary\",\n                  size: \"middle\",\n                  children: \"Submit\"\n                })]\n              })\n            }), /*#__PURE__*/_jsx(_Modal, {\n              title: `Konfirmasi hapus asset`,\n              visible: modaldelete,\n              okButtonProps: {\n                disabled: loadingdelete\n              },\n              onCancel: () => {\n                setmodaldelete(false);\n              },\n              onOk: handleDeleteAssets,\n              maskClosable: false,\n              style: {\n                top: `3rem`\n              },\n              width: 500,\n              destroyOnClose: true,\n              children: \"Yakin ingin hapus asset ini?\"\n            })]\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex mb-2 md:mb-5\",\n            children: /*#__PURE__*/_jsx(_Input, {\n              placeholder: \"Masukkan Nama Asset Type\",\n              style: {\n                width: `75%`\n              },\n              onChange: onChangeFilterAsset,\n              allowClear: true\n            })\n          }), praloading ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"flex\",\n            children: /*#__PURE__*/_jsx(_Spin, {})\n          }) : /*#__PURE__*/_jsx(\"div\", {\n            className: \"p-2 md:p-5 w-full md:w-9/12 border rounded-md shadow-md\",\n            children: maindata.length === 0 ? /*#__PURE__*/_jsx(_Empty, {\n              image: _Empty.PRESENTED_IMAGE_SIMPLE\n            }) : /*#__PURE__*/_jsx(_Tree, {\n              onExpand: onExpand,\n              expandedKeys: expandedKeys,\n              autoExpandParent: autoExpandParent,\n              treeData: loop(maindata),\n              filterTreeNode: filterTreeNode,\n              showLine: {\n                showLeafIcon: false\n              },\n              blockNode: true\n            })\n          })]\n        })\n      })\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resources = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjson = await resources.json();\n  const dataProfile = resjson;\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"81\"\n    }\n  };\n}\nexport default AssetsIndex;","map":null,"metadata":{},"sourceType":"module"}