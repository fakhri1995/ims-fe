{"ast":null,"code":"import _TreeSelect from \"antd/lib/tree-select\";\nimport _Select from \"antd/lib/select\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Spin from \"antd/lib/spin\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { SearchOutlined } from \"@ant-design/icons\";\nimport moment from \"moment\";\nimport React, { useEffect, useState } from \"react\";\nimport ButtonSys from \"../../button\";\nimport { AssetIconSvg, CalendartimeIconSvg, CircleXIconSvg, TrashIconSvg, UserIconSvg } from \"../../icon\";\nimport { InputRequired, SelectRequired, TextAreaNotRequired } from \"../../input\";\nimport { H1, H2, Label } from \"../../typography\";\nimport DrawerCore from \"../drawerCore\";\n\nfunction modifData1(dataa) {\n  for (var i = 0; i < dataa.length; i++) {\n    dataa[i][\"key\"] = dataa[i].id;\n    dataa[i][\"value\"] = dataa[i].id;\n    dataa[i][\"title\"] = dataa[i].mig_id;\n\n    if (dataa[i].inventory_parts) {\n      dataa[i][\"children\"] = dataa[i].inventory_parts;\n      delete dataa[i].inventory_parts;\n      modifData1(dataa[i].children);\n    }\n  }\n\n  return dataa;\n}\n\nfunction modifData2(dataa) {\n  for (var i = 0; i < dataa.length; i++) {\n    var _dataa$i$model_invent, _dataa$i$model_invent2, _dataa$i$model_invent3;\n\n    dataa[i][\"key\"] = dataa[i].id;\n    dataa[i][\"value\"] = dataa[i].id;\n    dataa[i][\"title\"] = `${dataa[i].mig_id} - ${(_dataa$i$model_invent = dataa[i].model_inventory) === null || _dataa$i$model_invent === void 0 ? void 0 : _dataa$i$model_invent.name} - ${(_dataa$i$model_invent2 = dataa[i].model_inventory) === null || _dataa$i$model_invent2 === void 0 ? void 0 : (_dataa$i$model_invent3 = _dataa$i$model_invent2.asset) === null || _dataa$i$model_invent3 === void 0 ? void 0 : _dataa$i$model_invent3.name}`;\n\n    if (dataa[i].inventory_parts) {\n      dataa[i][\"children\"] = dataa[i].inventory_parts;\n      delete dataa[i].inventory_parts;\n      modifData2(dataa[i].children);\n    }\n  }\n\n  return dataa;\n}\n\nconst DrawerTaskSpareParts = ({\n  title,\n  visible,\n  onvisible,\n  onClose,\n  buttonOkText,\n  disabled,\n  initProps,\n  idtask,\n  selectedforin,\n  setselectedforin,\n  selectedforout,\n  setselectedforout,\n  prevpath\n}) => {\n  //useState\n  const {\n    0: datapayload,\n    1: setdatapayload\n  } = useState({\n    id: Number(idtask),\n    add_in_inventories: [],\n    remove_in_inventory_ids: [],\n    add_out_inventory_ids: [],\n    remove_out_inventory_ids: []\n  });\n  const {\n    0: loadingspart,\n    1: setloadingspart\n  } = useState(false); //DATA IN\n\n  const {\n    0: praloadingin,\n    1: setpraloadingin\n  } = useState(true);\n  const {\n    0: dataselectforin,\n    1: setdataselectforin\n  } = useState([]);\n  const {\n    0: datainduk,\n    1: setdatainduk\n  } = useState([]); //DATA OUT\n\n  const {\n    0: praloadingout,\n    1: setpraloadingout\n  } = useState(true);\n  const {\n    0: dataselectforout,\n    1: setdataselectforout\n  } = useState([]);\n  const {\n    0: fetchingstate,\n    1: setfetchingstate\n  } = useState(false); //handler\n\n  const handleSendSpareParts = () => {\n    setloadingspart(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/sendInventoriesTask`, {\n      method: \"POST\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(datapayload)\n    }).then(res => res.json()).then(res2 => {\n      setloadingspart(false);\n\n      if (res2.success) {\n        onvisible(false);\n\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        window.location.href = `/tasks/detail/${idtask}`;\n      } else {\n        _notification[\"error\"]({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    setpraloadingin(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getTaskSparePartList?type=masuk&id=${idtask}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdataselectforin(res2.data.inventory_list);\n      setpraloadingin(false);\n    });\n  }, []);\n  useEffect(() => {\n    setpraloadingout(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getTaskSparePartList?type=keluar&id=${idtask}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      var modif1 = modifData1(res2.data);\n      setdatainduk(modif1);\n      var modif2 = modifData2(res2.data);\n      setdataselectforout(modif2);\n      setpraloadingout(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(DrawerCore, {\n    title: title,\n    visible: visible,\n    onClose: onClose,\n    buttonOkText: buttonOkText,\n    onClick: () => {\n      console.log(datapayload, selectedforin);\n      handleSendSpareParts();\n    } // disabled={disabledcreate}\n    ,\n    children: loadingspart ? /*#__PURE__*/_jsx(\"div\", {\n      className: \" flex w-full items-center justify-center\",\n      children: /*#__PURE__*/_jsx(_Spin, {})\n    }) : /*#__PURE__*/_jsxs(\"div\", {\n      className: \"flex flex-col\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"mb-6\",\n        children: /*#__PURE__*/_jsx(\"p\", {\n          className: \"mb-0 text-red-500 text-xs italic\",\n          children: \"*Informasi ini harus diisi\"\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-88943343\" + \" \" + \"flex mb-2\",\n          children: [/*#__PURE__*/_jsx(Label, {\n            children: \"Suku Cadang Masuk\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"jsx-88943343\" + \" \" + \"spartsin\"\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"88943343\",\n            children: [\".spartsin.jsx-88943343::before{content:'*';color:red;}\"]\n          })]\n        }), praloadingin ? /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(_Spin, {})\n        }) : /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \" mb-2 flex\",\n            children: /*#__PURE__*/_jsx(_Select, {\n              style: {\n                width: `100%`\n              },\n              className: \"dontShow\",\n              suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n              showArrow: true,\n              placeholder: \"MIG ID, Model\",\n              name: `part_in`,\n              onChange: (value, option) => {\n                setdatapayload(_objectSpread(_objectSpread({}, datapayload), {}, {\n                  add_in_inventories: [...datapayload.add_in_inventories, {\n                    inventory_id: value,\n                    connect_id: 0\n                  }]\n                }));\n                setselectedforin([...selectedforin, option]);\n                console.log(option);\n              },\n              showSearch: true,\n              optionFilterProp: \"children\",\n              notFoundContent: fetchingstate ? /*#__PURE__*/_jsx(_Spin, {\n                size: \"small\"\n              }) : null,\n              onSearch: value => {\n                setfetchingstate(true);\n                fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getTaskSparePartList?type=masuk&keyword=${value}`, {\n                  method: `GET`,\n                  headers: {\n                    Authorization: JSON.parse(initProps)\n                  }\n                }).then(res => res.json()).then(res2 => {\n                  setdataselectforin(res2.data);\n                  setfetchingstate(false);\n                });\n              },\n              filterOption: (input, opt) => opt.children.toLowerCase().indexOf(input.toLowerCase()) >= 0,\n              children: dataselectforin.map((doc, idx) => /*#__PURE__*/_jsxs(_Select.Option, {\n                value: doc.id,\n                migid: doc.mig_id,\n                modelname: doc.model_name,\n                assetname: doc.asset_name,\n                children: [doc.mig_id, \" - \", doc.model_name, \" - \", doc.asset_name]\n              }, idx))\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mb-2 flex flex-col\",\n            children: selectedforin.map((doc, idx) => /*#__PURE__*/_jsxs(\"div\", {\n              className: \" mb-2 flex items-center justify-between\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \" flex items-center\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \" mr-2\",\n                  children: /*#__PURE__*/_jsx(AssetIconSvg, {\n                    size: 50\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \" flex flex-col\",\n                  children: [/*#__PURE__*/_jsx(H2, {\n                    children: doc.modelname\n                  }), /*#__PURE__*/_jsxs(Label, {\n                    children: [doc.migid, \"/\", doc.assetname]\n                  })]\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \" flex items-center\",\n                children: [/*#__PURE__*/_jsx(_TreeSelect, {\n                  allowClear: true,\n                  placeholder: \"Pilih Induk\",\n                  style: {\n                    width: `10rem`,\n                    marginRight: `0.5rem`\n                  },\n                  showSearch: true,\n                  suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n                  showArrow: true,\n                  defaultValue: doc.connect_id === 0 ? null : doc.connect_id,\n                  name: `parent`,\n                  onChange: value => {\n                    if (typeof value === \"undefined\") {\n                      var temp = [...datapayload.add_in_inventories];\n                      temp[idx].connect_id = 0;\n                      setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                        add_in_inventories: temp\n                      }));\n                    } else {\n                      var temp = [...datapayload.add_in_inventories];\n                      temp[idx].connect_id = value;\n                      setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                        add_in_inventories: temp\n                      }));\n                    }\n                  },\n                  treeData: datainduk,\n                  treeDefaultExpandAll: true\n                }), /*#__PURE__*/_jsx(\"div\", {\n                  className: \" cursor-pointer flex justify-center items-center\",\n                  onClick: () => {\n                    var temp = [...selectedforin];\n                    temp.splice(idx, 1);\n                    setselectedforin(temp);\n                    doc.id ? setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                      remove_in_inventory_ids: [...prev.remove_in_inventory_ids, doc.id]\n                    })) : setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                      add_in_inventories: prev.add_in_inventories.filter(fil => fil.inventory_id !== doc.value)\n                    }));\n                  },\n                  children: /*#__PURE__*/_jsx(TrashIconSvg, {\n                    size: 20,\n                    color: `#BF4A40`\n                  })\n                })]\n              })]\n            }))\n          })]\n        })]\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col mb-6\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-1737872768\" + \" \" + \"flex mb-2\",\n          children: [/*#__PURE__*/_jsx(Label, {\n            children: \"Suku Cadang Keluar\"\n          }), /*#__PURE__*/_jsx(\"span\", {\n            className: \"jsx-1737872768\" + \" \" + \"spartsout\"\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"1737872768\",\n            children: [\".spartsout.jsx-1737872768::before{content:'*';color:red;}\"]\n          })]\n        }), praloadingout ? /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(_Spin, {})\n        }) : /*#__PURE__*/_jsxs(_Fragment, {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \" mb-2 flex\",\n            children: /*#__PURE__*/_jsx(_TreeSelect, {\n              placeholder: \"MIG ID, Model\",\n              style: {\n                width: `100%`\n              },\n              showSearch: true,\n              className: \"dontShow\",\n              suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n              showArrow: true,\n              name: `part_out`,\n              onChange: (value, label, extra) => {\n                var _extra$allCheckedNode, _extra$allCheckedNode2, _extra$allCheckedNode3;\n\n                setselectedforout([...selectedforout, {\n                  value: extra.allCheckedNodes[0].node.props.value,\n                  migid: extra.allCheckedNodes[0].node.props.mig_id,\n                  modelname: (_extra$allCheckedNode = extra.allCheckedNodes[0].node.props.model_inventory) === null || _extra$allCheckedNode === void 0 ? void 0 : _extra$allCheckedNode.name,\n                  assetname: (_extra$allCheckedNode2 = extra.allCheckedNodes[0].node.props.model_inventory) === null || _extra$allCheckedNode2 === void 0 ? void 0 : (_extra$allCheckedNode3 = _extra$allCheckedNode2.asset) === null || _extra$allCheckedNode3 === void 0 ? void 0 : _extra$allCheckedNode3.name\n                }]);\n                setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                  add_out_inventory_ids: [...prev.add_out_inventory_ids, value]\n                }));\n              },\n              treeData: dataselectforout,\n              treeDefaultExpandAll: true\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mb-2 flex flex-col\",\n            children: selectedforout.map((doc, idx) => /*#__PURE__*/_jsxs(\"div\", {\n              className: \" mb-2 flex items-center justify-between\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: \" flex items-center\",\n                children: [/*#__PURE__*/_jsx(\"div\", {\n                  className: \" mr-2\",\n                  children: /*#__PURE__*/_jsx(AssetIconSvg, {\n                    size: 50\n                  })\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  className: \" flex flex-col\",\n                  children: [/*#__PURE__*/_jsx(H2, {\n                    children: doc.modelname\n                  }), /*#__PURE__*/_jsxs(Label, {\n                    children: [doc.migid, \"/\", doc.assetname]\n                  })]\n                })]\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \" flex items-center\",\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: \" cursor-pointer flex justify-center items-center\",\n                  onClick: () => {\n                    var temp = [...selectedforout];\n                    temp.splice(idx, 1);\n                    setselectedforout(temp);\n                    doc.id ? setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                      remove_out_inventory_ids: [...prev.remove_out_inventory_ids, doc.id]\n                    })) : setdatapayload(prev => _objectSpread(_objectSpread({}, prev), {}, {\n                      add_out_inventory_ids: prev.add_out_inventory_ids.filter(fil => fil !== doc.value)\n                    }));\n                  },\n                  children: /*#__PURE__*/_jsx(TrashIconSvg, {\n                    size: 20,\n                    color: `#BF4A40`\n                  })\n                })\n              })]\n            }))\n          })]\n        })]\n      })]\n    })\n  });\n};\n\nexport default DrawerTaskSpareParts;","map":null,"metadata":{},"sourceType":"module"}