{"ast":null,"code":"import _Table from \"antd/lib/table\";\nimport _Select from \"antd/lib/select\";\nimport _TreeSelect from \"antd/lib/tree-select\";\nimport _Input from \"antd/lib/input\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { SearchOutlined } from \"@ant-design/icons\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Layout from \"../../../components/layout-dashboard\";\nimport st from \"../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nfunction Agents({\n  initProps,\n  dataProfile,\n  dataListAgent,\n  sidemenu\n}) {\n  const rt = useRouter();\n  var location_id1 = \"\",\n      name1 = \"\",\n      is_enabled1 = \"\";\n  const {\n    location_id,\n    name,\n    is_enabled\n  } = rt.query;\n\n  if (location_id) {\n    location_id1 = location_id;\n  }\n\n  if (name) {\n    name1 = name;\n  }\n\n  if (is_enabled) {\n    is_enabled1 = is_enabled;\n  } //data payload\n\n\n  const {\n    0: rawdata,\n    1: setrawdata\n  } = useState({\n    current_page: \"\",\n    data: [],\n    first_page_url: \"\",\n    from: null,\n    last_page: null,\n    last_page_url: \"\",\n    next_page_url: \"\",\n    path: \"\",\n    per_page: null,\n    prev_page_url: null,\n    to: null,\n    total: null\n  }); //data lokasi\n\n  const {\n    0: datalokasi,\n    1: setdatalokasi\n  } = useState([]); //loading pre render\n\n  const {\n    0: datarawloading,\n    1: setdatarawloading\n  } = useState(false); //loading pre render\n\n  const {\n    0: praloading,\n    1: setpraloading\n  } = useState(true); //data agents\n\n  const {\n    0: dataagents,\n    1: setdataagents\n  } = useState([]); //state row table\n\n  const {\n    0: rowstate,\n    1: setrowstate\n  } = useState(0); //FILTER\n\n  const {\n    0: namasearchact,\n    1: setnamasearchact\n  } = useState(name1 === \"\" ? false : true);\n  const {\n    0: asallokasifilteract,\n    1: setasallokasifilteract\n  } = useState(location_id1 === \"\" ? false : true);\n  const {\n    0: statusfilteract,\n    1: setstatusfilteract\n  } = useState(is_enabled1 === \"\" ? false : true);\n  const {\n    0: namavalue,\n    1: setnamavalue\n  } = useState(null);\n  const {\n    0: asallokasivalue,\n    1: setasallokasivalue\n  } = useState(null);\n  const {\n    0: statusvalue,\n    1: setstatusvalue\n  } = useState(null);\n  const {\n    0: namaasset,\n    1: setnamaasset\n  } = useState(location_id1);\n  const {\n    0: defasset,\n    1: setdefasset\n  } = useState(null);\n  const tok = initProps;\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  const {\n    originPath\n  } = rt.query;\n  const columnsDD = [{\n    dataIndex: \"profil_image\",\n    key: `profil_image`,\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: /*#__PURE__*/_jsx(\"img\", {\n            src: record.profile_image,\n            alt: \"imageProfile\",\n            className: \" object-cover w-10 h-10 rounded-full\"\n          })\n        })\n      };\n    }\n  }, {\n    title: \"Nama\",\n    dataIndex: \"name\"\n  }, {\n    title: \"Email\",\n    dataIndex: \"email\"\n  }, {\n    title: \"Posisi\",\n    dataIndex: \"position\"\n  }, {\n    title: \"No. Handphone\",\n    dataIndex: \"phone_number\"\n  }, {\n    title: \"Asal Lokasi\",\n    dataIndex: \"company_name\"\n  }, {\n    title: \"Status\",\n    dataIndex: \"is_enabled\",\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.is_enabled ? /*#__PURE__*/_jsx(\"div\", {\n            className: \"rounded-md w-auto h-auto px-1 text-center py-1 bg-blue-100 border border-blue-200 text-blue-600\",\n            children: \"Aktif\"\n          }) : /*#__PURE__*/_jsx(\"div\", {\n            className: \"rounded-md w-auto h-auto px-1 text-center py-1 bg-red-100 border border-red-200 text-red-600\",\n            children: \"Non-aktif\"\n          })\n        })\n      };\n    }\n  }]; //filtering\n\n  const onChangeSearch = e => {\n    if (e.target.value === \"\") {\n      window.location.href = `/admin/agents?name=&location_id=${asallokasifilteract ? location_id1 : \"\"}&is_enabled=${statusfilteract ? is_enabled1 : \"\"}`;\n      setnamasearchact(false);\n    } else {\n      setnamasearchact(true);\n      setnamavalue(e.target.value);\n    }\n  };\n\n  const onChangeAsalLokasi = value => {\n    if (typeof value === \"undefined\") {\n      window.location.href = `/admin/agents?name=${namasearchact ? name1 : \"\"}&location_id=&is_enabled=${statusfilteract ? is_enabled1 : \"\"}`;\n      setasallokasifilteract(false);\n    } else {\n      setasallokasifilteract(true);\n      setasallokasivalue(value);\n    }\n  };\n\n  const onChangeStatus = value => {\n    if (typeof value === \"undefined\") {\n      window.location.href = `/admin/agents?name=${namasearchact ? name1 : \"\"}&location_id=${asallokasifilteract ? location_id1 : \"\"}&is_enabled=`;\n      setstatusfilteract(false);\n    } else {\n      setstatusfilteract(true);\n      setstatusvalue(value);\n    }\n  };\n\n  const onFinalClick = () => {\n    window.location.href = `/admin/agents?name=${namasearchact ? namavalue === null ? name1 : namavalue : \"\"}&location_id=${asallokasifilteract ? asallokasivalue === null ? location_id1 : asallokasivalue : \"\"}&is_enabled=${statusfilteract ? statusvalue === \"\" ? is_enabled1 : statusvalue : \"\"}`;\n  }; //useEffect\n\n\n  useEffect(() => {\n    setpraloading(true);\n    setdatarawloading(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getAgentList?name=${name1}&company_id=${location_id1}${is_enabled1 === \"\" ? \"\" : `&is_enabled=${is_enabled1}`}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      }\n    }).then(res => res.json()).then(res2 => {\n      setrawdata(res2.data);\n      var dataDD = [];\n\n      if (!res2) {\n        dataDD = [];\n\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n\n        rt.push(\"/dashboard/admin\");\n      } else {\n        dataDD = res2.data.data.map((doc, idx) => {\n          return {\n            nomor: idx + 1,\n            id: doc.id,\n            profile_image: doc.profile_image === \"-\" || doc.profile_image === \"\" ? `/default-users.jpeg` : doc.profile_image,\n            name: doc.name,\n            email: doc.email,\n            phone_number: doc.phone_number,\n            company_name: doc.company_name,\n            is_enabled: doc.is_enabled,\n            company_id: doc.company_id,\n            position: doc.position\n          };\n        });\n      }\n\n      setdataagents(dataDD);\n      setpraloading(false);\n    });\n  }, []);\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getBranchCompanyList`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      var selectedBranchCompany = {};\n\n      const recursiveSearchBranchCompany = (doc, key) => {\n        for (var i = 0; i < doc.length; i++) {\n          if (doc[i].id === key) {\n            selectedBranchCompany = doc[i];\n          } else {\n            if (doc[i].children) {\n              recursiveSearchBranchCompany(doc[i].children, key);\n            }\n          }\n        }\n      };\n\n      recursiveSearchBranchCompany([res2.data], Number(namaasset));\n      setdefasset(selectedBranchCompany.key);\n      setdatalokasi([res2.data]);\n      setdatarawloading(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    originPath: originPath,\n    st: st,\n    children: /*#__PURE__*/_jsxs(_Fragment, {\n      children: [/*#__PURE__*/_jsxs(\"div\", {\n        className: \"h-20 w-full grid grid-cols-1 md:grid-cols-3 border-gray-400 md:border-t md:border-b bg-white mb-5 p-4\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \" col-span-1 md:col-span-2 flex items-center mb-2 md:mb-0\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"font-semibold text-base w-auto\",\n            children: \"Agents\"\n          })\n        }),\n        /*#__PURE__*/\n        // [109].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n        _jsx(\"div\", {\n          className: \" col-span-1 md:col-span-1 flex md:justify-end items-center\",\n          children: /*#__PURE__*/_jsx(Link, {\n            href: {\n              pathname: \"/admin/agents/create/\"\n            },\n            children: /*#__PURE__*/_jsx(_Button, {\n              size: \"large\",\n              type: \"primary\",\n              children: \"Tambah\"\n            })\n          })\n        })]\n      }),\n      /*#__PURE__*/\n      // [108].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n      _jsx(\"div\", {\n        className: \"h-auto w-full grid grid-cols-1 md:grid-cols-5 mb-5 bg-white rounded-md\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"md:col-span-5 col-span-1 flex flex-col py-3\",\n          children: [datarawloading ? null : /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex mb-8\",\n            children: [/*#__PURE__*/_jsxs(\"div\", {\n              className: \" w-10/12 mr-1 grid grid-cols-6\",\n              children: [/*#__PURE__*/_jsx(\"div\", {\n                className: \"col-span-3 mr-1\",\n                children: /*#__PURE__*/_jsx(_Input, {\n                  defaultValue: name1,\n                  style: {\n                    width: `100%`,\n                    marginRight: `0.5rem`\n                  },\n                  placeholder: \"Cari nama agent\",\n                  onChange: onChangeSearch,\n                  allowClear: true\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-span-2 mr-1\",\n                children: /*#__PURE__*/_jsx(_TreeSelect, {\n                  defaultValue: location_id1 === \"\" ? null : Number(defasset),\n                  allowClear: true,\n                  dropdownStyle: {\n                    maxHeight: 400,\n                    overflow: \"auto\"\n                  },\n                  treeData: datalokasi,\n                  placeholder: \"Cari asal lokasi agent\",\n                  treeDefaultExpandAll: true,\n                  style: {\n                    width: `100%`,\n                    marginRight: `0.5rem`\n                  },\n                  onChange: onChangeAsalLokasi\n                })\n              }), /*#__PURE__*/_jsx(\"div\", {\n                className: \"col-span-1 mr-1\",\n                children: /*#__PURE__*/_jsxs(_Select, {\n                  defaultValue: is_enabled1 === \"\" ? null : is_enabled1 === \"true\" ? true : false,\n                  placeholder: \"Pilih status agent\",\n                  style: {\n                    width: `100%`,\n                    marginRight: `0.5rem`\n                  },\n                  onChange: onChangeStatus,\n                  allowClear: true,\n                  children: [/*#__PURE__*/_jsx(_Select.Option, {\n                    value: true,\n                    children: \"Aktif\"\n                  }), /*#__PURE__*/_jsx(_Select.Option, {\n                    value: false,\n                    children: \"Non Aktif\"\n                  })]\n                })\n              })]\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \"w-2/12\",\n              children: /*#__PURE__*/_jsx(_Button, {\n                type: \"primary\",\n                style: {\n                  width: `100%`\n                },\n                onClick: onFinalClick,\n                children: /*#__PURE__*/_jsx(SearchOutlined, {})\n              })\n            })]\n          }), /*#__PURE__*/_jsx(_Table, {\n            pagination: {\n              pageSize: 10,\n              total: rawdata.total,\n              onChange: (page, pageSize) => {\n                setpraloading(true);\n                fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getAgentList?page=${page}&rows=10&name=${name1}&company_id=${location_id1}${is_enabled1 === \"\" ? \"\" : `&is_enabled=${is_enabled1}`}`, {\n                  method: `GET`,\n                  headers: {\n                    Authorization: JSON.parse(initProps)\n                  }\n                }).then(res => res.json()).then(res2 => {\n                  setrawdata(res2.data);\n                  var temppagination = res2.data.data.map((doc, idx) => _objectSpread(_objectSpread({}, doc), {}, {\n                    profile_image: doc.profile_image === \"-\" || doc.profile_image === \"\" ? `/default-users.jpeg` : doc.profile_image\n                  }));\n                  setdataagents(temppagination);\n                  setpraloading(false);\n                });\n              }\n            },\n            scroll: {\n              x: 200\n            },\n            dataSource: dataagents,\n            columns: columnsDD,\n            loading: praloading,\n            onRow: (record, rowIndex) => {\n              return {\n                onMouseOver: event => {\n                  setrowstate(record.id);\n                },\n                onClick: event => {\n                  {\n                    // [107, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n                    rt.push(`/admin/agents/detail/${record.id}`); // :\n                    // null\n                  }\n                }\n              };\n            },\n            rowClassName: (record, idx) => {\n              return record.id === rowstate ? `cursor-pointer` : ``;\n            }\n          })]\n        })\n      })]\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  const reqBodyAccountList = {\n    page: 1,\n    rows: 50,\n    order_by: \"asc\"\n  };\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![107, 108, 109, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataListAgent,\n      sidemenu: \"61\"\n    }\n  };\n}\nexport default Agents;","map":null,"metadata":{},"sourceType":"module"}