{"ast":null,"code":"import _TreeSelect from \"antd/lib/tree-select\";\nimport _DatePicker from \"antd/lib/date-picker\";\nimport _Select from \"antd/lib/select\";\nimport _Input from \"antd/lib/input\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { useRouter } from 'next/router';\nimport { useEffect, useState, useRef } from 'react';\nimport httpcookie from 'cookie';\nimport Link from 'next/link';\nimport { SearchOutlined } from '@ant-design/icons';\nimport moment from 'moment';\nimport Layout from '../../../components/layout-dashboardNew';\nimport st from '../../../components/layout-dashboard.module.css';\nimport { SearchIconSvg, UserIconSvg } from '../../../components/icon';\nimport { H1, H2, Label, Text } from '../../../components/typography';\nimport ButtonSys from '../../../components/button';\nimport { BackIconSvg } from '../../../components/icon';\nimport { TableCustomTicketHistories } from '../../../components/table/tableCustom';\n\nconst TicketHistories = ({\n  dataProfile,\n  sidemenu,\n  initProps\n}) => {\n  //1.Init\n  const rt = useRouter();\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(1, 2);\n  pathArr.push(`Riwayat Tiket`); //2.Use State\n  //TASK HISTORIES\n\n  const {\n    0: datarawhistories,\n    1: setdatarawhistories\n  } = useState({\n    current_page: \"\",\n    data: [],\n    first_page_url: \"\",\n    from: null,\n    last_page: null,\n    last_page_url: \"\",\n    next_page_url: \"\",\n    path: \"\",\n    per_page: null,\n    prev_page_url: null,\n    to: null,\n    total: null\n  });\n  const {\n    0: datahistories,\n    1: setdatahistories\n  } = useState([]);\n  const {\n    0: dataticketrelation,\n    1: setdatatickrelation\n  } = useState({\n    status_ticket: [{\n      id: 0,\n      name: \"\"\n    }],\n    ticket_types: [],\n    incident_type: [],\n    companies: {\n      data: [{\n        id: 0,\n        title: '',\n        key: '',\n        value: 0\n      }]\n    },\n    ticket_task_types: [],\n    resolved_times: []\n  });\n  const {\n    0: loadinghistories,\n    1: setloadinghistories\n  } = useState(false);\n  const {\n    0: loadingfilterhistories,\n    1: setloadingfilterhistories\n  } = useState(false);\n  const {\n    0: pagehistories,\n    1: setpagehistories\n  } = useState(1);\n  const {\n    0: rowshistories,\n    1: setrowshistories\n  } = useState(10);\n  const {\n    0: sortinghistories,\n    1: setsortinghistories\n  } = useState({\n    sort_by: \"\",\n    sort_type: \"\"\n  }); //Filter\n\n  const {\n    0: datafilterthistories,\n    1: setdatafilterthistories\n  } = useState([]);\n  const {\n    0: searcingfilterhistories,\n    1: setsearcingfilterhistories\n  } = useState(\"\");\n  const {\n    0: tickettypefilterhistories,\n    1: settickettypefilterhistories\n  } = useState(\"\");\n  const {\n    0: fromfilterhistories,\n    1: setfromfilterhistories\n  } = useState(\"\");\n  const {\n    0: tofilterhistories,\n    1: settofilterhistories\n  } = useState(\"\");\n  const {\n    0: locfilterhistories,\n    1: setlocfilterhistories\n  } = useState(\"\");\n  const {\n    0: fromresfilterhistories,\n    1: setfromresfilterhistories\n  } = useState(\"\");\n  const {\n    0: helperfromresfilterhistories,\n    1: sethelperfromresfilterhistories\n  } = useState(\"\");\n  const {\n    0: toresfilterhistories,\n    1: settoresfilterhistories\n  } = useState(\"\"); //create - ticket histories\n\n  const {\n    0: drawerhistoriescreate,\n    1: setdrawerhistoriescreate\n  } = useState(false);\n  const {\n    0: loadinghistoriescreate,\n    1: setloadinghistoriescreate\n  } = useState(false);\n  const {\n    0: refreshcreatehistoriescreate,\n    1: setrefreshcreatehistoriescreate\n  } = useState(-1); //delete - ticket histories\n\n  const {\n    0: datahistoriesdelete,\n    1: setdatahistoriesdelete\n  } = useState({\n    id: null,\n    name: \"\"\n  });\n  const {\n    0: modalhistoriesdelete,\n    1: setmodalhistoriesdelete\n  } = useState(false);\n  const {\n    0: loadinghistoriesdelete,\n    1: setloadinghistoriesdelete\n  } = useState(false);\n  const {\n    0: refreshcreatehistoriesdelete,\n    1: setrefreshcreatehistoriesdelete\n  } = useState(-1); //2. Column Table\n\n  const columnsTicketHistories = [{\n    title: 'No',\n    dataIndex: 'num',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: datarawhistories.from + index\n        })\n      };\n    }\n  }, {\n    title: 'No. Tiket',\n    dataIndex: 'id',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.full_name\n        })\n      };\n    },\n    sorter: (a, b) => a.id > b.id\n  }, {\n    title: 'Tipe Tiket',\n    dataIndex: 'type',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.type_name\n        })\n      };\n    },\n    sorter: (a, b) => a.type.name.localeCompare(b.type.name)\n  }, {\n    title: 'Diajukan Oleh',\n    dataIndex: 'requested_by',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.creator.name\n        })\n      };\n    }\n  }, {\n    title: 'Lokasi Problem',\n    dataIndex: 'location_id',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.location.full_location\n        })\n      };\n    }\n  }, {\n    title: 'Tanggal Pengajuan',\n    dataIndex: 'raised_at',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.raised_at\n        })\n      };\n    },\n    sorter: (a, b) => a.raised_at.localeCompare(b.raised_at)\n  }, {\n    title: 'Di-assign Ke',\n    dataIndex: 'assignable',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.task.users.length === 0 ? /*#__PURE__*/_jsxs(\"div\", {\n            className: \" flex items-center bg-onhold bg-opacity-10\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \" mr-2\",\n              children: /*#__PURE__*/_jsx(UserIconSvg, {})\n            }), /*#__PURE__*/_jsx(\"div\", {\n              children: \"Belum di-assign\"\n            })]\n          }) : /*#__PURE__*/_jsx(_Fragment, {\n            children: record.task.users[0].name\n          })\n        })\n      };\n    }\n  }, {\n    title: 'Durasi Selesai',\n    dataIndex: 'resolved_times',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.resolved_times\n        })\n      };\n    },\n    sorter: (a, b) => a.resolved_times.localeCompare(b.resolved_times)\n  }]; //3. Handler\n\n  const onFilterTicketHistories = () => {\n    setloadinghistories(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getClosedTickets?page=${pagehistories}&rows=${rowshistories}&ticket_id=${searcingfilterhistories}&from=${fromfilterhistories}&to=${tofilterhistories}&location_id=${locfilterhistories}&from_res=${fromresfilterhistories}&to_res=${toresfilterhistories}&sort_by=${sortinghistories.sort_by}&sort_type=${sortinghistories.sort_type}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatarawhistories(res2.data);\n      setdatahistories(res2.data.data);\n      setdatafilterthistories(res2.data.data);\n      setloadinghistories(false);\n    });\n  }; // const handleDeleteTicketHistories = () => {\n  //     setloadinghistories(true)\n  //     fetch(`https://boiling-thicket-46501.herokuapp.com/deleteTicketTaskType`, {\n  //         method: 'DELETE',\n  //         headers: {\n  //             'Authorization': JSON.parse(initProps),\n  //             'Content-Type': 'application/json'\n  //         },\n  //         body: JSON.stringify({\n  //             id: datatickettypesdelete.id\n  //         })\n  //     })\n  //         .then((res) => res.json())\n  //         .then(res2 => {\n  //             setloadinghistories(false)\n  //             if (res2.success) {\n  //                 setrefreshcreatetickettypesdelete(prev => prev + 1)\n  //                 setmodaltickettypesdelete(false)\n  //                 notification['success']({\n  //                     message: res2.message,\n  //                     duration: 3\n  //                 })\n  //             }\n  //             else {\n  //                 notification['error']({\n  //                     message: res2.message,\n  //                     duration: 3\n  //                 })\n  //             }\n  //         })\n  // }\n  //4.Use Effect\n\n\n  useEffect(() => {\n    setloadinghistories(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getClosedTickets?page=${pagehistories}&rows=${rowshistories}&ticket_id=${searcingfilterhistories}&from=${fromfilterhistories}&to=${tofilterhistories}&location_id=${locfilterhistories}&from_res=${fromresfilterhistories}&to_res=${toresfilterhistories}&sort_by=${sortinghistories.sort_by}&sort_type=${sortinghistories.sort_type}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatarawhistories(res2.data);\n      setdatahistories(res2.data.data);\n      setdatafilterthistories(res2.data.data);\n      setloadinghistories(false);\n    });\n  }, []);\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/${dataProfile.data.role === 1 ? \"getTicketRelation\" : \"getClientTicketRelation\"}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdatatickrelation(res2.data);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: /*#__PURE__*/_jsx(\"div\", {\n      className: \" flex flex-col px-5\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col shadow-md rounded-lg bg-white p-5 mb-6 mx-3\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex items-center mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mr-2 cursor-pointer flex items-center\",\n            onClick: () => {\n              rt.push(`/tickets`);\n            },\n            children: /*#__PURE__*/_jsx(BackIconSvg, {\n              size: 15,\n              color: `#000000`\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mr-2 flex items-center\",\n            children: /*#__PURE__*/_jsx(H1, {\n              children: \"Riwayat Tiket\"\n            })\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \" flex items-center mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Input, {\n              value: searcingfilterhistories === \"\" ? null : searcingfilterhistories,\n              style: {\n                width: `100%`\n              },\n              placeholder: \"Kata Kunci..\",\n              allowClear: true,\n              onChange: e => {\n                if (e.target.value === \"\") {\n                  setsearcingfilterhistories(\"\");\n                } else {\n                  setsearcingfilterhistories(e.target.value);\n                }\n              }\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Select, {\n              value: tickettypefilterhistories === \"\" ? null : tickettypefilterhistories,\n              placeholder: \"Semua Tipe Tiket\",\n              style: {\n                width: `100%`\n              },\n              allowClear: true,\n              name: `task_type`,\n              onChange: value => {\n                typeof value === 'undefined' ? settickettypefilterhistories(\"\") : settickettypefilterhistories(value);\n              },\n              children: dataticketrelation.ticket_types.map((doc, idx) => /*#__PURE__*/_jsx(_Select.Option, {\n                value: doc.id,\n                children: doc.name\n              }, idx))\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" w-3/12 mx-1\",\n            children: /*#__PURE__*/_jsx(_DatePicker.RangePicker, {\n              style: {\n                width: `100%`\n              },\n              allowEmpty: true,\n              className: \"datepickerStatus\",\n              value: fromfilterhistories === \"\" ? [null, null] : [moment(fromfilterhistories), moment(tofilterhistories)],\n              onChange: (dates, datestrings) => {\n                setfromfilterhistories(datestrings[0]);\n                settofilterhistories(datestrings[1]);\n              }\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" mx-1 w-5/12\",\n            children: /*#__PURE__*/_jsx(_TreeSelect, {\n              style: {\n                width: `100%`\n              },\n              allowClear: true,\n              placeholder: \"Semua Lokasi\",\n              showSearch: true,\n              suffixIcon: /*#__PURE__*/_jsx(SearchOutlined, {}),\n              showArrow: true,\n              name: `locations_id`,\n              onChange: value => {\n                typeof value === 'undefined' ? setlocfilterhistories(\"\") : setlocfilterhistories(value);\n              },\n              treeData: [dataticketrelation.companies],\n              treeDefaultExpandAll: true,\n              value: locfilterhistories === \"\" ? null : locfilterhistories\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-2/12\",\n            children: /*#__PURE__*/_jsx(_Select, {\n              value: helperfromresfilterhistories === \"\" ? null : helperfromresfilterhistories,\n              placeholder: \"Durasi Selesai\",\n              style: {\n                width: `100%`\n              },\n              allowClear: true,\n              name: `resolved_times`,\n              onChange: (value, option) => {\n                typeof value === 'undefined' ? (setfromresfilterhistories(''), settoresfilterhistories(''), sethelperfromresfilterhistories(\"\")) : (setfromresfilterhistories(option.from), settoresfilterhistories(option.to), sethelperfromresfilterhistories(value));\n              },\n              children: dataticketrelation.resolved_times.map((doc, idx) => {\n                if (doc.from === null) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 1,\n                  from: \"\",\n                  to: doc.to,\n                  children: \"Kurang dari 3 jam\"\n                }, idx);else if (doc.from === 10800) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 2,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"3 - 12 jam\"\n                }, idx);else if (doc.from === 43200) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 3,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"12 - 30 jam\"\n                }, idx);else if (doc.from === 108000) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 4,\n                  from: doc.from,\n                  to: doc.to,\n                  children: \"30 jam - 3 hari\"\n                }, idx);else if (doc.from === 259200) return /*#__PURE__*/_jsx(_Select.Option, {\n                  value: 5,\n                  from: doc.from,\n                  to: \"\",\n                  children: \"Lebih dari 3 hari\"\n                }, idx);\n              })\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \"mx-1 w-1/12\",\n            children: /*#__PURE__*/_jsx(ButtonSys, {\n              type: `primary`,\n              onClick: onFilterTicketHistories,\n              children: \"Cari\"\n            })\n          })]\n        }), /*#__PURE__*/_jsx(\"div\", {\n          children: /*#__PURE__*/_jsx(TableCustomTicketHistories, {\n            dataSource: datahistories,\n            setDataSource: setdatahistories,\n            columns: columnsTicketHistories,\n            loading: loadinghistories,\n            setpraloading: setloadinghistories,\n            pageSize: rowshistories,\n            total: datarawhistories.total,\n            initProps: initProps,\n            setpage: setpagehistories,\n            pagefromsearch: pagehistories,\n            setdataraw: setdatarawhistories,\n            setsorting: setsortinghistories,\n            sorting: sortinghistories,\n            searching: searcingfilterhistories,\n            tickettype: tickettypefilterhistories,\n            fromdate: fromfilterhistories,\n            todate: tofilterhistories,\n            location: locfilterhistories,\n            fromres: fromresfilterhistories,\n            tores: toresfilterhistories\n          })\n        })]\n      })\n    })\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![107, 108, 109, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"2\"\n    }\n  };\n}\nexport default TicketHistories;","map":null,"metadata":{},"sourceType":"module"}