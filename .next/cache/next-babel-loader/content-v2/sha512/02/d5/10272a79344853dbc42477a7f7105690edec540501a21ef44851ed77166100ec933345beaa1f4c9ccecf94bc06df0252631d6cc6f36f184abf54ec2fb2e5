{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _Table from \"antd/lib/table\";\nimport _Input from \"antd/lib/input\";\nimport _Select from \"antd/lib/select\";\nimport _defineProperty from \"/Users/makarim/Documents/code/Next/mighty-fe/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _Button from \"antd/lib/button\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport Link from 'next/link';\nimport { ExclamationCircleOutlined, SearchOutlined, CloseCircleOutlined } from '@ant-design/icons';\nimport Layout from '../../../components/layout-dashboard2';\nimport moment from 'moment';\nimport st from '../../../components/layout-dashboard.module.css';\nimport Sticky from 'wil-react-sticky';\n\nvar CreateRelationshipItem = function CreateRelationshipItem(_ref) {\n  var initProps = _ref.initProps,\n      dataProfile = _ref.dataProfile,\n      sidemenu = _ref.sidemenu,\n      itemid = _ref.itemid;\n  // 1.Init\n  var rt = useRouter();\n  var pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(2, 1);\n  pathArr[pathArr.length - 1] = \"Tambah Relationship Item\";\n  var _rt$query = rt.query,\n      name = _rt$query.name,\n      asset_id = _rt$query.asset_id,\n      nama = _rt$query.nama; //useState\n\n  var _useState = useState({\n    subject_id: Number(itemid),\n    relationship_asset_id: null,\n    connected_ids: [],\n    is_inverse: null\n  }),\n      newdata = _useState[0],\n      setnewdata = _useState[1];\n\n  var _useState2 = useState([]),\n      relitemdata = _useState2[0],\n      setrelitemdata = _useState2[1];\n\n  var _useState3 = useState([]),\n      relitemdata2 = _useState3[0],\n      setrelitemdata2 = _useState3[1];\n\n  var _useState4 = useState(-10),\n      reltipeitemdata = _useState4[0],\n      setreltipeitemdata = _useState4[1];\n\n  var _useState5 = useState(\"\"),\n      reldetailitemdata = _useState5[0],\n      setreldetailitemdata = _useState5[1];\n\n  var _useState6 = useState(-1),\n      relitemdatatrigger = _useState6[0],\n      setrelitemdatatrigger = _useState6[1];\n\n  var _useState7 = useState(false),\n      relitemloading = _useState7[0],\n      setrelitemloading = _useState7[1];\n\n  var _useState8 = useState([]),\n      selectedrelitemdata = _useState8[0],\n      setselectedrelitemdata = _useState8[1];\n\n  var _useState9 = useState([]),\n      displaydatarelations = _useState9[0],\n      setdisplaydatarelations = _useState9[1];\n\n  var _useState10 = useState(true),\n      disabledrel = _useState10[0],\n      setdisabledrel = _useState10[1];\n\n  var _useState11 = useState(false),\n      modaladd = _useState11[0],\n      setmodaladd = _useState11[1];\n\n  var _useState12 = useState(false),\n      loadingadd = _useState12[0],\n      setloadingadd = _useState12[1];\n\n  var _useState13 = useState(false),\n      namasearchact = _useState13[0],\n      setnamasearchact = _useState13[1];\n\n  var _useState14 = useState(\"\"),\n      namavalue = _useState14[0],\n      setnamavalue = _useState14[1]; //declaration\n\n\n  var columns12 = [{\n    title: 'Nama',\n    dataIndex: 'name',\n    key: 'name'\n  }, {\n    title: 'Role',\n    dataIndex: 'roles',\n    key: 'roles',\n    render: function render(text, record, index) {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.roles.map(function (a) {\n            return a.name;\n          }).join(\", \")\n        })\n      };\n    }\n  }];\n  var columns4 = [{\n    title: 'Nama',\n    dataIndex: 'inventory_name',\n    key: 'inventory_name'\n  }, {\n    title: 'Serial Number',\n    dataIndex: 'serial_number',\n    key: 'serial_number'\n  }, {\n    title: 'MIG ID',\n    dataIndex: 'mig_id',\n    key: 'mig_id'\n  }];\n  var columns3 = [{\n    title: 'Nama Perusahaan',\n    dataIndex: 'title',\n    key: 'title'\n  }]; //handler\n  //search nama\n\n  var onChangeSearch = function onChangeSearch(e) {\n    if (e.target.value === \"\") {\n      setrelitemdata(relitemdata2);\n      setnamasearchact(false);\n    } else {\n      setnamasearchact(true);\n      setnamavalue(e.target.value);\n    }\n  }; //finalClick\n\n\n  var onFinalClick = function onFinalClick() {\n    var datatemp = relitemdata2;\n\n    if (namasearchact) {\n      datatemp = datatemp.filter(function (flt) {\n        return flt.name.toLowerCase().includes(namavalue.toLowerCase());\n      });\n    }\n\n    setrelitemdata(datatemp);\n  }; //handler\n\n\n  var handleAddRelationshipItem = function handleAddRelationshipItem() {\n    setloadingadd(true);\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/addRelationshipInventories\", {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(initProps),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(newdata)\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      setloadingadd(false);\n      setmodaladd(false);\n\n      if (res2.success) {\n        _notification['success']({\n          message: \"Relationship Item berhasil ditambahkan\",\n          duration: 3\n        });\n\n        rt.push(\"/items/detail/\".concat(itemid, \"?active=relationship\"));\n      } else if (!res2.success) {\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(function () {\n    fetch(\"https://boiling-thicket-46501.herokuapp.com/getRelationshipInventoryRelation?asset_id=\".concat(asset_id), {\n      method: \"GET\",\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(function (res) {\n      return res.json();\n    }).then(function (res2) {\n      !res2.success ? setdisplaydatarelations([]) : setdisplaydatarelations(res2.data);\n    });\n  }, []);\n  useEffect(function () {\n    if (relitemdatatrigger !== -1) {\n      setrelitemloading(true);\n      fetch(\"https://boiling-thicket-46501.herokuapp.com/getRelationshipInventoryDetailList?relationship_asset_id=\".concat(relitemdatatrigger), {\n        method: \"GET\",\n        headers: {\n          'Authorization': JSON.parse(initProps)\n        }\n      }).then(function (res) {\n        return res.json();\n      }).then(function (res2) {\n        reltipeitemdata === -3 ? setrelitemdata([res2.data]) : reltipeitemdata === -4 ? setrelitemdata(res2.data.data) : null;\n        reltipeitemdata === -1 || reltipeitemdata === -2 ? (setrelitemdata(res2.data), setrelitemdata2(res2.data)) : null;\n        setrelitemloading(false);\n      });\n    }\n  }, [relitemdatatrigger]);\n  return /*#__PURE__*/_jsxs(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"h-20 w-full grid grid-cols-1 md:grid-cols-3 bg-white mb-5 px-8 py-4\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-2 flex items-center mb-2 md:mb-0\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"font-semibold text-xl w-auto\",\n          children: [\"Form Tambah Relationship - \", nama]\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" col-span-1 md:col-span-1 flex md:justify-end items-center\",\n        children: [/*#__PURE__*/_jsx(_Button, {\n          onClick: function onClick() {\n            rt.push(\"/items/detail/\".concat(itemid, \"?active=relationship\"));\n            console.log(relitemdatatrigger, reltipeitemdata, relitemdata);\n          },\n          style: {\n            marginRight: \"1rem\"\n          },\n          size: \"middle\",\n          type: \"danger\",\n          children: \"Batal\"\n        }), /*#__PURE__*/_jsx(_Button, {\n          disabled: disabledrel,\n          onClick: function onClick() {\n            setmodaladd(true);\n          },\n          size: \"middle\",\n          type: \"primary\",\n          children: \"Simpan\"\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"h-auto w-full grid grid-cols-1 md:grid-cols-5 mb-5 px-8 py-4 bg-white rounded-md\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:col-span-5 col-span-1 flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-3560212516\" + \" \" + \"flex flex-col w-full mb-8\",\n          children: [/*#__PURE__*/_jsxs(\"p\", {\n            className: \"jsx-3560212516\" + \" \" + \"mb-1 font-semibold\",\n            children: [\"Relationship Type \", /*#__PURE__*/_jsx(\"span\", {\n              className: \"jsx-3560212516\" + \" \" + \"relitemtambah\"\n            })]\n          }), /*#__PURE__*/_jsx(_Select, {\n            placeholder: \"Pilih Relationship Type\",\n            style: {\n              width: \"100%\"\n            },\n            allowClear: true,\n            onChange: function onChange(value, option) {\n              setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                relationship_asset_id: typeof value === 'undefined' ? null : value,\n                is_inverse: typeof option === 'undefined' ? null : option.is_inverse\n              }));\n              setreltipeitemdata(typeof option === 'undefined' ? -10 : option.type_id);\n              setreldetailitemdata(typeof option === 'undefined' ? \"\" : option.detail);\n              typeof value === 'undefined' ? setrelitemdata([]) : setrelitemdatatrigger(value);\n            },\n            children: displaydatarelations.map(function (docmodels, idxmodels) {\n              return /*#__PURE__*/_jsx(_Select.Option, {\n                value: docmodels.id,\n                type_id: docmodels.type_id,\n                is_inverse: docmodels.is_inverse,\n                detail: docmodels.detail,\n                children: docmodels.detail\n              });\n            })\n          }), displaydatarelations.length < 1 && /*#__PURE__*/_jsxs(\"p\", {\n            className: \"jsx-3560212516\" + \" \" + \"text-red-500 text-sm\",\n            children: [\"Data Relationship Type kosong, silahkan tambah data melalui \", /*#__PURE__*/_jsx(Link, {\n              href: \"/admin/assets/detail/\".concat(asset_id, \"?active=relationship\"),\n              children: \"Asset Ini\"\n            })]\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"3560212516\",\n            children: [\".relitemtambah.jsx-3560212516::before{content:'*';color:red;}\"]\n          })]\n        }), reltipeitemdata === -1 || reltipeitemdata === -2 ? /*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-5\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" w-full mr-1 grid grid-cols-12\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"col-span-11 mr-1\",\n              children: /*#__PURE__*/_jsx(_Input, {\n                style: {\n                  width: \"100%\",\n                  marginRight: \"0.5rem\"\n                },\n                placeholder: \"Cari Nama Item\",\n                onChange: function onChange(e) {\n                  return onChangeSearch(e);\n                },\n                allowClear: true\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \" col-span-1\",\n              children: /*#__PURE__*/_jsx(_Button, {\n                type: \"primary\",\n                style: {\n                  width: \"100%\"\n                },\n                onClick: onFinalClick,\n                children: /*#__PURE__*/_jsx(SearchOutlined, {})\n              })\n            })]\n          })\n        }) : null, /*#__PURE__*/_jsx(_Table, {\n          rowSelection: {\n            onChange: function onChange(selectedRowKeys, selectedRows) {\n              if (selectedRows.length > 0) {\n                setdisabledrel(false);\n              } else {\n                setdisabledrel(true);\n              }\n\n              setselectedrelitemdata(selectedRows);\n              setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                connected_ids: reltipeitemdata === -1 || reltipeitemdata === -2 ? selectedRows.map(function (doc) {\n                  return doc.id;\n                }) : selectedRows.map(function (doc) {\n                  return doc.id;\n                })\n              }));\n            },\n            checkStrictly: true\n          },\n          defaultExpandedRowKeys: [1],\n          pagination: {\n            pageSize: 9\n          },\n          rowKey: reltipeitemdata === -1 || reltipeitemdata === -2 ? \"id\" : \"id\",\n          scroll: {\n            x: 200\n          },\n          dataSource: relitemdata,\n          columns: reltipeitemdata === -1 || reltipeitemdata === -2 ? columns12 : reltipeitemdata === -3 ? columns3 : columns4,\n          loading: relitemloading\n        })]\n      })\n    }), /*#__PURE__*/_jsx(_Modal, {\n      title: /*#__PURE__*/_jsx(_Fragment, {\n        children: \"Apakah Anda yakin ingin menambahkan Relationship ke Item berikut ini?\"\n      }),\n      visible: modaladd,\n      onCancel: function onCancel() {\n        setmodaladd(false);\n      },\n      okText: \"Ya\",\n      cancelText: \"Tidak\",\n      onOk: handleAddRelationshipItem,\n      okButtonProps: {\n        loading: loadingadd\n      },\n      width: 700,\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col border-b mb-5\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex flex-col mb-3\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold mb-0\",\n              children: \"Relationship Type:\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: \"mb-0\",\n              children: reldetailitemdata\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex flex-col mb-3\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold mb-0\",\n              children: \"Item:\"\n            }), selectedrelitemdata.map(function (doc, idx) {\n              return /*#__PURE__*/_jsxs(\"p\", {\n                className: \"mb-0\",\n                children: [\"- \", reltipeitemdata === -1 || reltipeitemdata === -2 ? doc.name : reltipeitemdata === -3 ? doc.title : reltipeitemdata === -4 ? doc.inventory_name : null]\n              });\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col\",\n          children: [/*#__PURE__*/_jsx(\"p\", {\n            className: \"mb-0\",\n            children: \"Notes\"\n          }), /*#__PURE__*/_jsx(_Input, {\n            placeholder: \"Masukkan Notes\",\n            onChange: function onChange(e) {// setdataApiremoved({ ...dataApiremoved, notes: e.target.value })\n            }\n          })]\n        })]\n      })\n    })]\n  });\n};\n\nexport var __N_SSP = true;\nexport default CreateRelationshipItem;","map":null,"metadata":{},"sourceType":"module"}