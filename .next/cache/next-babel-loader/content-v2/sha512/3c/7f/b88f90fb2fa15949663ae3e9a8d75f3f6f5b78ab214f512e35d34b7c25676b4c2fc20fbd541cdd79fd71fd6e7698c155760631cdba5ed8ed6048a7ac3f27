{"ast":null,"code":"import { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _Table from \"antd/lib/table\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useState } from \"react\";\nimport { useEffect } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../components/layout-dashboard\";\nimport st from \"../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nfunction Roles({\n  initProps,\n  dataProfile,\n  dataRoles,\n  sidemenu\n}) {\n  const rt = useRouter();\n  const tok = initProps;\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  const {\n    originPath\n  } = rt.query; // const [maindata, setmaindata] = useState(dataRoles.data)\n\n  const {\n    0: maindata,\n    1: setmaindata\n  } = useState([]);\n  const columnsDD = [{\n    title: \"Nama Role\",\n    dataIndex: \"name\",\n    key: \"name\",\n\n    render(t, r, i) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: \"font-semibold\",\n        children: r.name\n      });\n    } // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n\n  }, {\n    title: \"Deskripsi\",\n    dataIndex: \"description\",\n    key: \"description\",\n\n    render(t, r, i) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: \"text-xs\",\n        children: r.description\n      });\n    } // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n\n  }, {\n    title: \"Jumlah Anggota\",\n    dataIndex: \"users_count\",\n    key: \"users_count\",\n    align: `center` // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <>\n    //                 {\n    //                     loadingselectedrole[index] ?\n    //                         <>\n    //                             <Spin />\n    //                         </>\n    //                         :\n    //                         <>\n    //                             {\n    //                                 [175].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n    //                                 <div className=\"text-center\" /*onClick={() => { setselectedrolename(record.name); getRoleUsers(record.id, index) }}*/>\n    //                                     {record.member} anggota\n    //                                 </div>\n    //                             }\n    //                         </>\n    //                 }\n    //             </>\n    //     };\n    // },\n    // render: agent => (\n    //   ),\n    // sorter: (a, b) => a.fullname.localeCompare(b.fullname),\n    // sortDirections: ['descend', 'ascend'],\n    // responsive: ['lg'],\n\n  } // {\n  //     title: '\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0\\xa0',\n  //     dataIndex: 'actionss',\n  //     key: 'action',\n  //     render: (text, record, index) => {\n  //         return {\n  //             props: {\n  //                 style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n  //             },\n  //             children:\n  //                 <div className=\" flex\">\n  //                     {\n  //                         [174, 177].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n  //                         <Button onClick={() => { rt.push(`/admin/roles/${record.id}`) }} style={{ paddingTop: `0`, paddingBottom: `0.3rem`, marginRight: `1rem` }}>\n  //                             <EditOutlined />\n  //                         </Button>\n  //                     }\n  //                     {\n  //                         [178].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n  //                         <Button danger onClick={() => { setmodaldelete(true); setdatadelete({ ...datadelete, id: record.id }); setcurrentdelete(record.name) }} loading={loadingdelete} style={{ paddingTop: `0`, paddingBottom: `0.3rem` }}>\n  //                             <DeleteOutlined />\n  //                         </Button>\n  //                     }\n  //                 </div>\n  //         }\n  //     }\n  // }\n  ];\n  const {\n    0: modalviewagents,\n    1: setmodalviewagents\n  } = useState(false);\n  const {\n    0: selectedrole,\n    1: setselectedrole\n  } = useState([]);\n  const {\n    0: selectedrolename,\n    1: setselectedrolename\n  } = useState();\n  var ln = [];\n\n  for (var i = 0; i < maindata.length; i++) {\n    ln.push(false);\n  }\n\n  const {\n    0: loadingselectedrole,\n    1: setloadingselectedrole\n  } = useState(ln);\n  const {\n    0: loadingtable,\n    1: setloadingtable\n  } = useState(true);\n  const {\n    0: rowstate,\n    1: setrowstate\n  } = useState(0);\n  const {\n    0: datadelete,\n    1: setdatadelete\n  } = useState({\n    id: 0\n  });\n  const {\n    0: currentdelete,\n    1: setcurrentdelete\n  } = useState(\"\");\n  const {\n    0: modaldelete,\n    1: setmodaldelete\n  } = useState(false);\n  const {\n    0: loadingdelete,\n    1: setloadingdelete\n  } = useState(false);\n\n  const getRoleUsers = (id, index) => {\n    var temp = loadingselectedrole;\n    temp[index] = true;\n    setloadingselectedrole(temp);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoleUsers?id=${id}`, {\n      method: \"GET\",\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setselectedrole(res2.data);\n      return res2;\n    }).then(res3 => {\n      var temp = loadingselectedrole;\n      temp[index] = false;\n      setloadingselectedrole(temp);\n      setmodalviewagents(true);\n    });\n  };\n\n  const handleDeleteRoles = () => {\n    setloadingdelete(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/deleteRole`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify(datadelete)\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          setloadingdelete(false);\n          rt.push(`/admin/roles`);\n        }, 300);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n\n        setloadingdelete(false);\n      }\n    });\n  };\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoles`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setmaindata(res2.data);\n      setloadingtable(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    originPath: originPath,\n    st: st,\n    children: /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n        id: \"formAgentsWrapper\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \" col-span-1 md:col-span-4\",\n          children: /*#__PURE__*/_jsx(Sticky, {\n            containerSelectorFocus: \"#formAgentsWrapper\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex justify-between p-4 border-gray-400 border-t border-b bg-white mb-8\",\n              children: [/*#__PURE__*/_jsx(\"h1\", {\n                className: \"font-semibold text-base w-auto pt-2\",\n                children: \"Roles\"\n              }),\n              /*#__PURE__*/\n              // [176].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n              _jsx(\"div\", {\n                className: \"flex space-x-2\",\n                children: /*#__PURE__*/_jsx(Link, {\n                  href: \"/admin/roles/create\",\n                  children: /*#__PURE__*/_jsx(_Button, {\n                    type: \"primary\",\n                    size: \"large\",\n                    children: \"Tambah\"\n                  })\n                })\n              })]\n            })\n          })\n        }),\n        /*#__PURE__*/\n        // [173].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n        _jsx(\"div\", {\n          className: \" col-span-1 md:col-span-4 flex flex-col\",\n          children: /*#__PURE__*/_jsx(\"div\", {\n            className: \"col-span-3 flex flex-col space-y-3\",\n            children: /*#__PURE__*/_jsx(_Table, {\n              loading: loadingtable,\n              scroll: {\n                x: 400\n              },\n              pagination: {\n                pageSize: 5\n              },\n              dataSource: maindata,\n              columns: columnsDD,\n              onRow: (record, rowIndex) => {\n                return {\n                  onMouseOver: event => {\n                    setrowstate(record.id);\n                  },\n                  onClick: event => {\n                    {\n                      // [174, 177].every((curr) => dataProfile.data.registered_feature.includes(curr)) ?\n                      rt.push(`/admin/roles/detail/${record.id}`); // :\n                      // null\n                    }\n                  }\n                };\n              },\n              rowClassName: (record, idx) => {\n                return record.id === rowstate ? `cursor-pointer` : ``;\n              } // onRow={(record, rowIndex) => {\n              // return {\n              //     onMouseOver: (event) => {\n              //         var actionsCopy = actions\n              //         actionsCopy[rowIndex] = true\n              //         setActions(actionsCopy)\n              //         setAction(\"block\")\n              //         // console.log(\"row: \" + actions[rowIndex] + \" \" + rowIndex)\n              //     },\n              //     onMouseLeave: (event) => {\n              //         var actionsCopy = actions\n              //         actionsCopy[rowIndex] = false\n              //         setActions(actionsCopy)\n              //         setAction(\"hidden\")\n              //         // console.log(\"row leave: \" + actions[rowIndex] + \" \" + rowIndex)\n              //     }\n              // }\n              // }}\n\n            })\n          })\n        })]\n      })\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res\n}) {\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![173, 174, 175, 176, 177, 178].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n  // const resourcesGR = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoles`, {\n  //     method: `GET`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGR = await resourcesGR.json()\n  // const dataRoles = resjsonGR\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataRoles,\n      sidemenu: \"71\"\n    }\n  };\n}\nexport default Roles;","map":null,"metadata":{},"sourceType":"module"}