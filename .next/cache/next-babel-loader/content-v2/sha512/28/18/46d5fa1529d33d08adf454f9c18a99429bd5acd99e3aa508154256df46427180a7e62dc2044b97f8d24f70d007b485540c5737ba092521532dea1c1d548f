{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _Button from \"antd/lib/button\";\nimport _notification from \"antd/lib/notification\";\nimport _Tabs from \"antd/lib/tabs\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _Table from \"antd/lib/table\";\nimport _Input from \"antd/lib/input\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _JSXStyle from \"styled-jsx/style\";\nimport Link from \"next/link\";\nimport { useRouter } from \"next/router\";\nimport { useEffect, useState } from \"react\";\nimport Sticky from \"wil-react-sticky\";\nimport Layout from \"../../../../../components/layout-dashboard\";\nimport st from \"../../../../../components/layout-dashboard.module.css\";\nimport httpcookie from \"cookie\";\n\nconst AnggotaSide = ({\n  initProps,\n  rolesid\n}) => {\n  const {\n    0: roleanggota,\n    1: setroleanggota\n  } = useState([]);\n  const {\n    0: roleanggota2,\n    1: setroleanggota2\n  } = useState([]);\n  const {\n    0: loadingdata,\n    1: setloadingdata\n  } = useState(true);\n  const col = [{\n    title: \"Nama Anggota\",\n    dataIndex: \"name\",\n    key: \"name\" // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n  }, {\n    title: \"Status\",\n    dataIndex: \"status\",\n    key: \"status\",\n    align: `center`,\n\n    render(t, r, i) {\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: r.status ? /*#__PURE__*/_jsx(\"div\", {\n          className: \"rounded-md w-2/5 mx-auto h-auto px-1 text-center justify-center py-1 bg-blue-100 border border-blue-200 text-blue-600\",\n          children: \"Aktif\"\n        }) : /*#__PURE__*/_jsx(\"div\", {\n          className: \"rounded-md w-2/5 mx-auto h-auto px-1 text-center justify-center py-1 bg-red-100 border border-red-200 text-red-600\",\n          children: \"Non-aktif\"\n        })\n      });\n    } // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n\n  }];\n\n  const onChangeSearch = e => {\n    const filtered = roleanggota2.filter(flt => {\n      return flt.name.toLowerCase().includes(e.target.value.toLowerCase());\n    });\n    setroleanggota(filtered);\n  };\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoleUserFeatures?id=${rolesid}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setroleanggota(res2.data.users);\n      setroleanggota2(res2.data.users);\n      setloadingdata(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"flex flex-col space-y-4\",\n    children: [/*#__PURE__*/_jsx(_Input, {\n      style: {\n        width: `50%`\n      },\n      onChange: e => {\n        onChangeSearch(e);\n      },\n      placeholder: \"Cari Nama Anggota\"\n    }), /*#__PURE__*/_jsx(_Table, {\n      loading: loadingdata,\n      dataSource: roleanggota,\n      columns: col,\n      scroll: {\n        x: 500\n      },\n      pagination: {\n        pageSize: 5\n      },\n      size: \"medium\"\n    })]\n  });\n};\n\nconst FiturSide = ({\n  initProps,\n  rolesid\n}) => {\n  const {\n    0: rolefitur,\n    1: setrolefitur\n  } = useState([]);\n  const {\n    0: rolefitur2,\n    1: setrolefitur2\n  } = useState([]);\n  const {\n    0: loadingdata,\n    1: setloadingdata\n  } = useState(true);\n\n  const onChangeSearch = e => {\n    const filtered = rolefitur2.filter(flt => {\n      return flt.name.toLowerCase().includes(e.target.value.toLowerCase());\n    });\n    setrolefitur(filtered);\n  };\n\n  const col = [{\n    title: \"Nama Fitur\",\n    dataIndex: \"name\",\n    key: \"name\" // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n  }, {\n    title: \"Nama Modul\",\n    dataIndex: \"list_module\",\n    key: \"list_module\",\n\n    render(t, r, i) {\n      var strmodule = r.list_module.length > 0 ? r.list_module.join(\",\") : \"-\";\n      return /*#__PURE__*/_jsx(_Fragment, {\n        children: strmodule\n      });\n    } // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n\n  }, {\n    title: \"Deskripsi\",\n    dataIndex: \"description\",\n    key: \"description\",\n\n    render(t, r, i) {\n      return /*#__PURE__*/_jsx(\"div\", {\n        className: \"text-xs\",\n        children: r.description\n      });\n    } // render(text, record, index) {\n    //     return {\n    //         props: {\n    //             style: { background: index % 2 == 1 ? '#f2f2f2' : '#fff' },\n    //         },\n    //         children:\n    //             <div>\n    //                 <Link href={{\n    //                     pathname: `/admin/roles/${record.id}`,\n    //                     query: {\n    //                         originPath: 'Admin'\n    //                     }\n    //                 }}>\n    //                     <a>\n    //                         {record.name}\n    //                     </a>\n    //                 </Link>\n    //                 <p style={{ fontSize: '13px' }}>\n    //                     {record.description}\n    //                 </p>\n    //             </div>,\n    //     };\n    // },\n    // sorter: (a, b) => a.user_id - b.user_id,\n    // sortDirections: ['descend', 'ascend'],\n\n\n  }];\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoleUserFeatures?id=${rolesid}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setrolefitur(res2.data.features);\n      setrolefitur2(res2.data.features);\n      setloadingdata(false);\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(\"div\", {\n    className: \"jsx-478214154\" + \" \" + \"flex flex-col space-y-4\",\n    children: [/*#__PURE__*/_jsx(_Input, {\n      style: {\n        width: `50%`\n      },\n      className: \"yowes\",\n      onChange: e => {\n        onChangeSearch(e);\n      },\n      placeholder: \"Cari Nama Fitur\"\n    }), /*#__PURE__*/_jsx(_Table, {\n      loading: loadingdata,\n      dataSource: rolefitur,\n      columns: col,\n      scroll: {\n        x: 400\n      },\n      pagination: {\n        pageSize: 5\n      },\n      size: \"medium\"\n    }), /*#__PURE__*/_jsx(_JSXStyle, {\n      id: \"478214154\",\n      children: [\".ant-pagination-options{visibility:hidden;display:none;}\"]\n    })]\n  });\n};\n\nconst RolesDetail = ({\n  initProps,\n  dataProfile,\n  sidemenu,\n  rolesid\n}) => {\n  const rt = useRouter();\n  const {\n    TabPane\n  } = _Tabs; //data\n\n  const {\n    0: patharr,\n    1: setpatharr\n  } = useState([]);\n  const {\n    0: detaildata,\n    1: setdetaildata\n  } = useState({\n    id: 0,\n    name: \"\",\n    desc: \"\"\n  });\n  const {\n    0: roleanggota,\n    1: setroleanggota\n  } = useState([]);\n  const {\n    0: loadingdata,\n    1: setloadingdata\n  } = useState(true); //delete\n\n  const {\n    0: modaldelete,\n    1: setmodaldelete\n  } = useState(false);\n  const {\n    0: loadingdelete,\n    1: setloadingdelete\n  } = useState(false); //handle\n\n  const handleDeleteRole = () => {\n    setloadingdelete(true);\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/deleteRole`, {\n      method: \"DELETE\",\n      headers: {\n        Authorization: JSON.parse(initProps),\n        \"Content-Type\": \"application/json\"\n      },\n      body: JSON.stringify({\n        id: detaildata.id\n      })\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        _notification[\"success\"]({\n          message: \"Role berhasil dihapus\",\n          duration: 3\n        });\n\n        setTimeout(() => {\n          setloadingdelete(false);\n          rt.push(`/admin/roles`);\n        }, 300);\n      } else if (!res2.success) {\n        _notification[\"error\"]({\n          message: res2.message.errorInfo.status_detail,\n          duration: 3\n        });\n\n        setloadingdelete(false);\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRole?id=${rolesid}`, {\n      method: `GET`,\n      headers: {\n        Authorization: JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      setdetaildata({\n        id: res2.data.id,\n        name: res2.data.name,\n        desc: res2.data.description\n      });\n      var pathArr = rt.pathname.split(\"/\").slice(1);\n      pathArr.splice(2, 1);\n      pathArr[pathArr.length - 1] = `Detail Role - ` + res2.data.name;\n      setpatharr(pathArr);\n      setloadingdata(false);\n    }).then(() => {\n      fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoleUserFeatures?id=${rolesid}`, {\n        method: `GET`,\n        headers: {\n          Authorization: JSON.parse(initProps)\n        }\n      }).then(res => res.json()).then(res2 => {\n        setroleanggota(res2.data.users);\n      });\n    });\n  }, []);\n  return /*#__PURE__*/_jsxs(Layout, {\n    st: st,\n    pathArr: patharr,\n    sidemenu: sidemenu,\n    dataProfile: dataProfile,\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n      id: \"formAgentsWrapper\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \"col-span-1 md:col-span-4\",\n        children: /*#__PURE__*/_jsx(Sticky, {\n          containerSelectorFocus: \"#formAgentsWrapper\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex justify-between px-1 md:px-4 py-4 md:py-6 border-gray-400 border-t border-b bg-white mb-8\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold text-base w-auto \",\n              children: \"Detail Role\"\n            }), /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex space-x-2\",\n              children: [\n              /*#__PURE__*/\n              // [174, 177].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n              _jsx(_Button, {\n                type: \"primary\",\n                size: \"middle\",\n                onClick: () => {\n                  rt.push(`/admin/roles/update/${rolesid}`);\n                },\n                children: \"Ubah\"\n              }),\n              /*#__PURE__*/\n              // [178].every((curr) => dataProfile.data.registered_feature.includes(curr)) &&\n              _jsx(_Button, {\n                type: \"default\",\n                size: \"middle\",\n                onClick: () => {\n                  setmodaldelete(true);\n                },\n                danger: true,\n                children: \"Hapus\"\n              })]\n            })]\n          })\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \"col-span-1 md:col-span-4\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col border-b mb-2 md:mb-5\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \" px-1 md:px-4 mb-1 md:mb-4\",\n            children: /*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold text-2xl mb-0\",\n              children: detaildata.name\n            })\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \" px-1 md:px-4 mb-3 md:mb-5\",\n            children: [/*#__PURE__*/_jsx(\"p\", {\n              className: \"mb-0\",\n              children: \"Deskripsi:\"\n            }), /*#__PURE__*/_jsx(\"span\", {\n              className: \"text-xs\",\n              children: detaildata.desc\n            })]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \" bg-white hidden md:block\",\n            children: /*#__PURE__*/_jsxs(_Tabs, {\n              tabPosition: `left`,\n              children: [/*#__PURE__*/_jsx(TabPane, {\n                tab: \"Anggota\",\n                children: /*#__PURE__*/_jsx(AnggotaSide, {\n                  rolesid: rolesid,\n                  initProps: initProps\n                })\n              }, `anggota`), /*#__PURE__*/_jsx(TabPane, {\n                tab: \"Fitur\",\n                children: /*#__PURE__*/_jsx(FiturSide, {\n                  rolesid: rolesid,\n                  initProps: initProps\n                })\n              }, `fitur`)]\n            })\n          }), /*#__PURE__*/_jsx(\"div\", {\n            className: \" bg-white block md:hidden\",\n            children: /*#__PURE__*/_jsxs(_Tabs, {\n              tabPosition: `top`,\n              children: [/*#__PURE__*/_jsx(TabPane, {\n                tab: \"Anggota\",\n                children: /*#__PURE__*/_jsx(AnggotaSide, {\n                  rolesid: rolesid,\n                  initProps: initProps\n                })\n              }, `anggota`), /*#__PURE__*/_jsx(TabPane, {\n                tab: \"Fitur\",\n                children: /*#__PURE__*/_jsx(FiturSide, {\n                  rolesid: rolesid,\n                  initProps: initProps\n                })\n              }, `fitur`)]\n            })\n          })]\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(_Modal, {\n      title: \"Konfirmasi untuk menghapus role\",\n      visible: modaldelete,\n      onOk: handleDeleteRole,\n      okText: \"Ya\",\n      cancelText: \"Tidak\",\n      onCancel: () => setmodaldelete(false),\n      okButtonProps: {\n        disabled: loadingdelete\n      },\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"p\", {\n          children: [\"Apakah Anda yakin untuk menghapus role\", \" \", /*#__PURE__*/_jsx(\"strong\", {\n            children: detaildata.name\n          }), \" yang berkaitan dengan anggota berikut ini?\"]\n        }), roleanggota.length < 1 ? /*#__PURE__*/_jsx(\"p\", {\n          className: \"font-semibold\",\n          children: \"-\"\n        }) : /*#__PURE__*/_jsx(\"ol\", {\n          children: roleanggota.map((doc, idx) => {\n            return /*#__PURE__*/_jsxs(\"li\", {\n              className: \"font-semibold\",\n              children: [idx + 1, \". \", doc.name]\n            }, idx);\n          })\n        })]\n      })\n    })]\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res,\n  params\n}) {\n  const rolesid = params.rolesId;\n  var initProps = {};\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: \"/login\"\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/detailProfile`, {\n    method: `GET`,\n    headers: {\n      Authorization: JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![173, 174, 175, 176, 177, 178].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n  // const resourcesGR = await fetch(`${process.env.NEXT_PUBLIC_BACKEND_URL}/getRoles`, {\n  //     method: `GET`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGR = await resourcesGR.json()\n  // const dataRoles = resjsonGR\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      // dataRoles,\n      rolesid,\n      sidemenu: \"71\"\n    }\n  };\n}\nexport default RolesDetail;","map":null,"metadata":{},"sourceType":"module"}