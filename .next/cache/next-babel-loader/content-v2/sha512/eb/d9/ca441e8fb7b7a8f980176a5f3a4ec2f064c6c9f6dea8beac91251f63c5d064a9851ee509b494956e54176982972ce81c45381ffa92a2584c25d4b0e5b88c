{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _InputNumber from \"antd/lib/input-number\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport _Tabs from \"antd/lib/tabs\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport Layout from '../../../components/layout-dashboard';\nimport httpcookie from 'cookie';\nimport { useRouter } from 'next/router';\nimport { useState } from 'react';\nimport Link from 'next/link';\nimport Sticky from 'wil-react-sticky';\nimport st from '../../../components/layout-dashboard.module.css';\nimport moment from 'moment';\n\nfunction ViewContract({\n  initProps,\n  dataProfile,\n  dataContract,\n  dataContractTypes,\n  sidemenu\n}) {\n  const rt = useRouter();\n  const tok = initProps; // const pathArr = rt.pathname.split(\"/\").slice(1)\n\n  const pathArr = ['admin', 'contracts', dataContract.data.contract.nomor_kontrak];\n  const {\n    originPath\n  } = rt.query;\n  const {\n    TabPane\n  } = _Tabs;\n  const contractTypes = dataContractTypes.data.filter((item, idx) => {\n    return dataContract.data.contract.id_tipe_kontrak == item.id;\n  })[0]; // console.log(contractTypes)\n\n  const contract = dataContract.data.contract; // console.log(contract)\n\n  const serviceItems = dataContract.data.service_item_kontraks; // console.log(dataContract)\n  //--------hook modal delete dan terminate contract-------------\n\n  const {\n    0: warningDelete,\n    1: setWarningDelete\n  } = useState({\n    istrue: false,\n    key: null,\n    nomor_kontrak: \"\",\n    loadingBtn: false\n  });\n  const {\n    0: warningTerminate,\n    1: setWarningTerminate\n  } = useState({\n    istrue: false,\n    key: null,\n    nomor_kontrak: \"\",\n    loadingBtn: false\n  });\n  const {\n    0: warningActivate,\n    1: setWarningActivate\n  } = useState({\n    istrue: false,\n    key: null,\n    nomor_kontrak: \"\",\n    loadingBtn: false\n  });\n\n  const onClickModalDeleteContract = (istrue, record) => {\n    setWarningDelete(_objectSpread(_objectSpread({}, warningDelete), {}, {\n      [\"istrue\"]: istrue,\n      [\"key\"]: record.id,\n      [\"nomor_kontrak\"]: record.nomor_kontrak\n    }));\n  };\n\n  const onClickModalTerminateContract = (istrue, record) => {\n    setWarningTerminate(_objectSpread(_objectSpread({}, warningTerminate), {}, {\n      [\"istrue\"]: istrue,\n      [\"key\"]: record.id,\n      [\"nomor_kontrak\"]: record.nomor_kontrak\n    }));\n  };\n\n  const onClickModalTerminateActivate = (istrue, record) => {\n    setWarningActivate(_objectSpread(_objectSpread({}, warningActivate), {}, {\n      [\"istrue\"]: istrue,\n      [\"key\"]: record.id,\n      [\"nomor_kontrak\"]: record.nomor_kontrak\n    }));\n  }; //-------------------terminate contract------------------------\n\n\n  const handleTerminateContract = id => {\n    setWarningTerminate(_objectSpread(_objectSpread({}, warningTerminate), {}, {\n      loadingBtn: true\n    }));\n    fetch(`https://boiling-thicket-46501.herokuapp.com/deactivatingContract?id=${id}`, {\n      method: 'PUT',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      }\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        setWarningTerminate(false, null);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/contracts`);\n        }, 500);\n      } else if (!res2.success) {\n        setWarningTerminate(false, null);\n\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //-------------------activate contract------------------------\n\n\n  const handleActivateContract = id => {\n    setWarningActivate(_objectSpread(_objectSpread({}, warningActivate), {}, {\n      loadingBtn: true\n    }));\n    fetch(`https://boiling-thicket-46501.herokuapp.com/activatingContract?id=${id}`, {\n      method: 'PUT',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      }\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        setWarningActivate(false, null);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/contracts`);\n        }, 500);\n      } else if (!res2.success) {\n        setWarningActivate(false, null);\n\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //------------------handle delete contract-------------------\n\n\n  const handleDeleteContract = key => {\n    setWarningDelete(_objectSpread(_objectSpread({}, warningDelete), {}, {\n      loadingBtn: true\n    }));\n    fetch(`https://boiling-thicket-46501.herokuapp.com/deleteContract?id=${key}`, {\n      method: 'DELETE',\n      headers: {\n        'Authorization': JSON.parse(tok),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        id: key\n      })\n    }).then(res => res.json()).then(res2 => {\n      if (res2.success) {\n        setWarningDelete(false, null);\n\n        _notification['success']({\n          message: res2.message,\n          duration: 3\n        });\n\n        setTimeout(() => {\n          rt.push(`/admin/contracts`);\n        }, 500);\n      } else if (!res2.success) {\n        setWarningDelete(false, null);\n\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //--------------------------------------------------------\n\n\n  const currentDate = moment(); // const future = moment('2022-03-02 10:03:02');\n\n  const future = moment(contract.tanggal_selesai); // const timeLeft = moment(future.diff(currentDate)).format(\"YYYY-MM-DD HH:mm:ss\");\n\n  var timeLeft = moment(future).diff(currentDate, 'months') > 2 ? moment(future).diff(currentDate, 'months') + \" Bulan\" : moment(future).diff(currentDate, 'days') + \" Hari\";\n  var numtimeleft = Number(timeLeft.split(\" \")[0]);\n  numtimeleft <= 0 ? timeLeft = \"Habis\" : timeLeft;\n\n  var timeConverter = UNIX_timestamp => {\n    var a = new Date(UNIX_timestamp);\n    var months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];\n    var year = a.getFullYear();\n    var month = months[a.getMonth()];\n    var date = a.getDate();\n    var hour = a.getHours();\n    var min = a.getMinutes();\n    var sec = a.getSeconds();\n    var time = date + ' ' + month + ' ' + year + ' ' + hour + ':' + min + ':' + sec;\n    return time;\n  };\n\n  return /*#__PURE__*/_jsx(Layout, {\n    tok: tok,\n    dataProfile: dataProfile,\n    pathArr: pathArr,\n    sidemenu: sidemenu,\n    originPath: originPath,\n    st: st,\n    children: /*#__PURE__*/_jsx(_Fragment, {\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"w-full h-auto grid grid-cols-1 md:grid-cols-4\",\n        children: [/*#__PURE__*/_jsx(\"div\", {\n          className: \"col-span-1 md:col-span-4\",\n          id: \"formAgentsWrapper\",\n          children: /*#__PURE__*/_jsx(Sticky, {\n            containerSelectorFocus: \"#formAgentsWrapper\",\n            children: /*#__PURE__*/_jsxs(\"div\", {\n              className: \"flex justify-between p-4 border-gray-400 border-t border-b bg-white mb-8\",\n              children: [/*#__PURE__*/_jsxs(\"div\", {\n                className: 'flex',\n                children: [/*#__PURE__*/_jsx(\"h1\", {\n                  className: \"font-semibold text-base w-auto py-2 pr-4\",\n                  children: contract.nomor_kontrak\n                }), contract.is_active ? /*#__PURE__*/_jsx(\"div\", {\n                  className: \" relative top-1 h-9 bg-blue-100 text-blue-600 border-blue-600 border py-1 px-3 rounded-md w-auto md:mr-5\",\n                  children: \"AKTIF\"\n                }) : /*#__PURE__*/_jsx(\"div\", {\n                  className: \" relative top-1 h-9 bg-gray-100 text-gray-600 border-gray-600 border py-1 px-3 rounded-md w-auto md:mr-5\",\n                  children: \"NON-AKTIF\"\n                })]\n              }), /*#__PURE__*/_jsxs(\"div\", {\n                className: \"flex space-x-2 pt-1\",\n                children: [[199].every(curr => dataProfile.data.registered_feature.includes(curr)) && /*#__PURE__*/_jsx(_Fragment, {\n                  children: !contract.is_active && /*#__PURE__*/_jsx(\"button\", {\n                    onClick: () => {\n                      onClickModalTerminateActivate(true, contract);\n                    },\n                    className: \" text-white text-sm bg-green-600 border-gray-900  hover:bg-green-700 cursor-pointer h-10 py-2.5 w-20 text-center\",\n                    children: /*#__PURE__*/_jsx(\"p\", {\n                      children: \"Activate\"\n                    })\n                  })\n                }), [200].every(curr => dataProfile.data.registered_feature.includes(curr)) && /*#__PURE__*/_jsx(_Fragment, {\n                  children: contract.is_active && /*#__PURE__*/_jsx(\"button\", {\n                    onClick: () => {\n                      onClickModalTerminateContract(true, contract);\n                    },\n                    className: \" text-white text-sm bg-red-600 border-gray-900  hover:bg-red-700 cursor-pointer h-10 py-2.5 w-20 text-center\",\n                    children: /*#__PURE__*/_jsx(\"p\", {\n                      children: \"Terminate\"\n                    })\n                  })\n                }), [197].every(curr => dataProfile.data.registered_feature.includes(curr)) && /*#__PURE__*/_jsx(Link, {\n                  href: `/admin/contracts/update/${contract.id}`,\n                  children: /*#__PURE__*/_jsx(\"div\", {\n                    className: \" text-white text-sm bg-blue-500 hover:bg-blue-600 border-gray-900 cursor-pointer h-10 py-2.5 w-20 text-center\",\n                    children: /*#__PURE__*/_jsx(\"p\", {\n                      children: \"Edit\"\n                    })\n                  })\n                }), [198].every(curr => dataProfile.data.registered_feature.includes(curr)) && /*#__PURE__*/_jsx(\"button\", {\n                  onClick: () => {\n                    onClickModalDeleteContract(true, contract);\n                  },\n                  className: \" text-black text-sm bg-white border-gray-300 border hover:bg-gray-200 cursor-pointer h-10 py-2 w-20 text-center\",\n                  children: /*#__PURE__*/_jsx(\"p\", {\n                    children: \"Delete\"\n                  })\n                })]\n              })]\n            })\n          })\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \" col-span-1 md:col-span-3 flex flex-col\",\n          children: [/*#__PURE__*/_jsx(\"div\", {\n            className: \"col-span-3 flex flex-col space-y-3\",\n            children: /*#__PURE__*/_jsxs(_Tabs, {\n              defaultActiveKey: \"1\",\n              tabPosition: \"left\",\n              children: [/*#__PURE__*/_jsxs(TabPane, {\n                tab: 'Overview',\n                children: [/*#__PURE__*/_jsxs(\"div\", {\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: 'py-2',\n                    children: \"General Details\"\n                  }), /*#__PURE__*/_jsxs(\"div\", {\n                    className: 'text-black text-sm overflow-auto flex flex-col bg-white border-gray-300 border cursor-pointer p-1',\n                    children: [/*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-1',\n                        children: \"Nomor Kontrak\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contract.nomor_kontrak\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Perusahaan\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contract.company_name\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Tipe Kontrak\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contractTypes.nama\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Deskripsi\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contract.deskripsi\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Tanggal Mulai\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contract.tanggal_mulai\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Tanggal Selesai\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: contract.tanggal_selesai\n                      })]\n                    }), /*#__PURE__*/_jsxs(\"div\", {\n                      className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                      children: [/*#__PURE__*/_jsx(\"div\", {\n                        className: ' mr-20 w-32',\n                        children: \"Sisa Waktu Kontrak\"\n                      }), /*#__PURE__*/_jsx(\"div\", {\n                        className: 'col-span-2',\n                        children: timeLeft\n                      })]\n                    })]\n                  })]\n                }), /*#__PURE__*/_jsxs(\"div\", {\n                  children: [/*#__PURE__*/_jsx(\"div\", {\n                    className: 'py-2',\n                    children: \"Service Items Detail\"\n                  }), serviceItems.map((item, idx) => {\n                    return /*#__PURE__*/_jsxs(_Fragment, {\n                      children: [/*#__PURE__*/_jsxs(\"div\", {\n                        className: 'text-black text-sm overflow-auto flex flex-col bg-white border-gray-300 border cursor-pointer p-1',\n                        children: [/*#__PURE__*/_jsxs(\"div\", {\n                          className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                          children: [/*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-1',\n                            children: \"Nama Service Item\"\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-2',\n                            children: item.nama\n                          })]\n                        }), /*#__PURE__*/_jsxs(\"div\", {\n                          className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                          children: [/*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-1 mt-1',\n                            children: \"Harga\"\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-2',\n                            children: /*#__PURE__*/_jsx(_InputNumber, {\n                              defaultValue: item.harga,\n                              formatter: value => `IDR ${value}`.replace(/\\B(?=(\\d{3})+(?!\\d))/g, ',') + ' Rupiah',\n                              parser: value => value.replace(/\\$\\s?|(,*)/g, ''),\n                              readOnly: true,\n                              bordered: false,\n                              style: {\n                                width: '220px',\n                                marginLeft: '-12px'\n                              }\n                            })\n                          })]\n                        }), /*#__PURE__*/_jsxs(\"div\", {\n                          className: 'grid grid-cols-1 md:grid-cols-3 p-2',\n                          children: [/*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-1',\n                            children: \"Metode Pembayaran\"\n                          }), /*#__PURE__*/_jsx(\"div\", {\n                            className: 'col-span-2',\n                            children: item.nama_metode_pembayaran\n                          })]\n                        })]\n                      }), /*#__PURE__*/_jsx(\"br\", {})]\n                    });\n                  })]\n                })]\n              }, 1), /*#__PURE__*/_jsx(TabPane, {\n                tab: 'Activity',\n                children: /*#__PURE__*/_jsx(\"div\", {\n                  className: 'text-black text-sm flex flex-col bg-white border-gray-300 border cursor-pointer p-3 w-full'\n                })\n              }, 2)]\n            })\n          }), /*#__PURE__*/_jsxs(_Modal, {\n            title: \"Konfirmasi untuk menghapus kontrak\",\n            visible: warningDelete.istrue,\n            onOk: () => {\n              handleDeleteContract(warningDelete.key);\n            },\n            okButtonProps: {\n              disabled: warningDelete.loadingBtn\n            },\n            onCancel: () => setWarningDelete(false, null),\n            children: [\"Apakah anda yakin ingin menghapus kontrak \", /*#__PURE__*/_jsx(\"strong\", {\n              children: warningDelete.nomor_kontrak\n            }), \"?\"]\n          }), /*#__PURE__*/_jsxs(_Modal, {\n            title: \"Konfirmasi untuk terminate kontrak\",\n            visible: warningTerminate.istrue,\n            onOk: () => {\n              handleTerminateContract(warningTerminate.key);\n            },\n            okButtonProps: {\n              disabled: warningTerminate.loadingBtn\n            },\n            onCancel: () => setWarningTerminate(false, null),\n            children: [\"Apakah anda yakin ingin mengakhiri kontrak \", /*#__PURE__*/_jsx(\"strong\", {\n              children: warningTerminate.nomor_kontrak\n            }), \"?\"]\n          }), /*#__PURE__*/_jsxs(_Modal, {\n            title: \"Konfirmasi untuk mengaktifkan kontrak\",\n            visible: warningActivate.istrue,\n            onOk: () => {\n              handleActivateContract(warningActivate.key);\n            },\n            okButtonProps: {\n              disabled: warningActivate.loadingBtn\n            },\n            onCancel: () => setWarningActivate(false, null),\n            children: [\"Apakah anda yakin ingin mengaktifkan kontrak \", /*#__PURE__*/_jsx(\"strong\", {\n              children: warningActivate.nomor_kontrak\n            }), \"?\"]\n          })]\n        })]\n      })\n    })\n  });\n}\n\nexport async function getServerSideProps({\n  req,\n  res,\n  params\n}) {\n  var initProps = {};\n  const contractid = params.contractId;\n\n  if (req && req.headers) {\n    const cookies = req.headers.cookie;\n\n    if (!cookies) {\n      res.writeHead(302, {\n        Location: '/login'\n      });\n      res.end();\n    }\n\n    if (typeof cookies === 'string') {\n      const cookiesJSON = httpcookie.parse(cookies);\n      initProps = cookiesJSON.token;\n    }\n  }\n\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `POST`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP;\n\n  if (![195, 197, 198, 199, 200, 201, 202, 203, 204, 205, 206].every(curr => dataProfile.data.registered_feature.includes(curr))) {\n    res.writeHead(302, {\n      Location: '/dashboard/admin'\n    });\n    res.end();\n  }\n\n  const resourcesGetContract = await fetch(`https://boiling-thicket-46501.herokuapp.com/getContract?id=${contractid}`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGetContract = await resourcesGetContract.json();\n  const dataContract = resjsonGetContract;\n  const resourcesGetContractTypes = await fetch(`https://boiling-thicket-46501.herokuapp.com/getContractTypes`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGetContractTypes = await resourcesGetContractTypes.json();\n  const dataContractTypes = resjsonGetContractTypes; // const assetId = dataContract.data.contract.asset_id\n  // const resourcesGetInventoryColumnAndVendor = await fetch(`https://boiling-thicket-46501.herokuapp.com/getInventoryColumns?id=${assetId}`, {\n  //     method: `GET`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGetInventoryColumnAndVendor = await resourcesGetInventoryColumnAndVendor.json()\n  // const dataInventoryColumnAndVendor = resjsonGetInventoryColumnAndVendor\n  // const resourcesGetInventoryActivityLog = await fetch(`https://boiling-thicket-46501.herokuapp.com/getActivityInventoryLogs?id=${inventoryid}`, {\n  //     method: `GET`,\n  //     headers: {\n  //         'Authorization': JSON.parse(initProps)\n  //     }\n  // })\n  // const resjsonGetInventoryActivityLog = await resourcesGetInventoryActivityLog.json()\n  // const dataInventoryActivityLog = resjsonGetInventoryActivityLog\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      dataContract,\n      dataContractTypes,\n      sidemenu: \"4\"\n    }\n  };\n}\nexport default ViewContract;","map":null,"metadata":{},"sourceType":"module"}