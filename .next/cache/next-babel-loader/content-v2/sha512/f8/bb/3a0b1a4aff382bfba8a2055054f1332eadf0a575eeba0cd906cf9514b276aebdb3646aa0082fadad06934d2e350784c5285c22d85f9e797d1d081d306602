{"ast":null,"code":"import _Modal from \"antd/lib/modal\";\nimport _Table from \"antd/lib/table\";\nimport _Input from \"antd/lib/input\";\nimport _Select from \"antd/lib/select\";\nimport _Button from \"antd/lib/button\";\nimport { jsxs as _jsxs } from \"react/jsx-runtime\";\nimport _notification from \"antd/lib/notification\";\nimport { jsx as _jsx } from \"react/jsx-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-runtime\";\nimport _JSXStyle from \"styled-jsx/style\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { useRouter } from 'next/router';\nimport { useEffect, useState } from 'react';\nimport httpcookie from 'cookie';\nimport Link from 'next/link';\nimport { ExclamationCircleOutlined, SearchOutlined, CloseCircleOutlined } from '@ant-design/icons';\nimport Layout from '../../../components/layout-dashboard2';\nimport moment from 'moment';\nimport st from '../../../components/layout-dashboard.module.css';\nimport Sticky from 'wil-react-sticky';\n\nconst CreateRelationshipItem = ({\n  initProps,\n  dataProfile,\n  sidemenu,\n  itemid\n}) => {\n  // 1.Init\n  const rt = useRouter();\n  const pathArr = rt.pathname.split(\"/\").slice(1);\n  pathArr.splice(2, 1);\n  pathArr[pathArr.length - 1] = \"Tambah Relationship Item\";\n  const {\n    name,\n    asset_id,\n    nama\n  } = rt.query; //useState\n\n  const {\n    0: newdata,\n    1: setnewdata\n  } = useState({\n    subject_id: Number(itemid),\n    relationship_asset_id: null,\n    connected_ids: [],\n    is_inverse: null\n  });\n  const {\n    0: relitemdata,\n    1: setrelitemdata\n  } = useState([]);\n  const {\n    0: relitemdata2,\n    1: setrelitemdata2\n  } = useState([]);\n  const {\n    0: reltipeitemdata,\n    1: setreltipeitemdata\n  } = useState(-10);\n  const {\n    0: reldetailitemdata,\n    1: setreldetailitemdata\n  } = useState(\"\");\n  const {\n    0: relitemdatatrigger,\n    1: setrelitemdatatrigger\n  } = useState(-1);\n  const {\n    0: relitemloading,\n    1: setrelitemloading\n  } = useState(false);\n  const {\n    0: selectedrelitemdata,\n    1: setselectedrelitemdata\n  } = useState([]);\n  const {\n    0: displaydatarelations,\n    1: setdisplaydatarelations\n  } = useState([]);\n  const {\n    0: disabledrel,\n    1: setdisabledrel\n  } = useState(true);\n  const {\n    0: modaladd,\n    1: setmodaladd\n  } = useState(false);\n  const {\n    0: loadingadd,\n    1: setloadingadd\n  } = useState(false);\n  const {\n    0: namasearchact,\n    1: setnamasearchact\n  } = useState(false);\n  const {\n    0: namavalue,\n    1: setnamavalue\n  } = useState(\"\"); //declaration\n\n  const columns12 = [{\n    title: 'Nama',\n    dataIndex: 'name',\n    key: 'name'\n  }, {\n    title: 'Role',\n    dataIndex: 'roles',\n    key: 'roles',\n    render: (text, record, index) => {\n      return {\n        children: /*#__PURE__*/_jsx(_Fragment, {\n          children: record.roles.map(a => a.name).join(\", \")\n        })\n      };\n    }\n  }];\n  const columns4 = [{\n    title: 'Nama',\n    dataIndex: 'inventory_name',\n    key: 'inventory_name'\n  }, {\n    title: 'Serial Number',\n    dataIndex: 'serial_number',\n    key: 'serial_number'\n  }, {\n    title: 'MIG ID',\n    dataIndex: 'mig_id',\n    key: 'mig_id'\n  }];\n  const columns3 = [{\n    title: 'Nama Perusahaan',\n    dataIndex: 'title',\n    key: 'title'\n  }]; //handler\n  //search nama\n\n  const onChangeSearch = e => {\n    if (e.target.value === \"\") {\n      setrelitemdata(relitemdata2);\n      setnamasearchact(false);\n    } else {\n      setnamasearchact(true);\n      setnamavalue(e.target.value);\n    }\n  }; //finalClick\n\n\n  const onFinalClick = () => {\n    var datatemp = relitemdata2;\n\n    if (namasearchact) {\n      datatemp = datatemp.filter(flt => {\n        return flt.name.toLowerCase().includes(namavalue.toLowerCase());\n      });\n    }\n\n    setrelitemdata(datatemp);\n  }; //handler\n\n\n  const handleAddRelationshipItem = () => {\n    setloadingadd(true);\n    fetch(`https://boiling-thicket-46501.herokuapp.com/addRelationshipInventories`, {\n      method: 'POST',\n      headers: {\n        'Authorization': JSON.parse(initProps),\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(newdata)\n    }).then(res => res.json()).then(res2 => {\n      setloadingadd(false);\n      setmodaladd(false);\n\n      if (res2.success) {\n        _notification['success']({\n          message: \"Relationship Item berhasil ditambahkan\",\n          duration: 3\n        });\n\n        rt.push(`/items/detail/${itemid}?active=relationship`);\n      } else if (!res2.success) {\n        _notification['error']({\n          message: res2.message,\n          duration: 3\n        });\n      }\n    });\n  }; //useEffect\n\n\n  useEffect(() => {\n    fetch(`https://boiling-thicket-46501.herokuapp.com/getRelationshipInventoryRelation?asset_id=${asset_id}`, {\n      method: `GET`,\n      headers: {\n        'Authorization': JSON.parse(initProps)\n      }\n    }).then(res => res.json()).then(res2 => {\n      !res2.success ? setdisplaydatarelations([]) : setdisplaydatarelations(res2.data);\n    });\n  }, []);\n  useEffect(() => {\n    if (relitemdatatrigger !== -1) {\n      setrelitemloading(true);\n      fetch(`https://boiling-thicket-46501.herokuapp.com/getRelationshipInventoryDetailList?relationship_asset_id=${relitemdatatrigger}`, {\n        method: `GET`,\n        headers: {\n          'Authorization': JSON.parse(initProps)\n        }\n      }).then(res => res.json()).then(res2 => {\n        reltipeitemdata === -3 ? setrelitemdata([res2.data]) : reltipeitemdata === -4 ? setrelitemdata(res2.data.data) : null;\n        reltipeitemdata === -1 || reltipeitemdata === -2 ? (setrelitemdata(res2.data), setrelitemdata2(res2.data)) : null;\n        setrelitemloading(false);\n      });\n    }\n  }, [relitemdatatrigger]);\n  return /*#__PURE__*/_jsxs(Layout, {\n    dataProfile: dataProfile,\n    sidemenu: sidemenu,\n    tok: initProps,\n    st: st,\n    pathArr: pathArr,\n    children: [/*#__PURE__*/_jsxs(\"div\", {\n      className: \"h-20 w-full grid grid-cols-1 md:grid-cols-3 bg-white mb-5 px-8 py-4\",\n      children: [/*#__PURE__*/_jsx(\"div\", {\n        className: \" col-span-1 md:col-span-2 flex items-center mb-2 md:mb-0\",\n        children: /*#__PURE__*/_jsxs(\"div\", {\n          className: \"font-semibold text-xl w-auto\",\n          children: [\"Form Tambah Relationship - \", nama]\n        })\n      }), /*#__PURE__*/_jsxs(\"div\", {\n        className: \" col-span-1 md:col-span-1 flex md:justify-end items-center\",\n        children: [/*#__PURE__*/_jsx(_Button, {\n          onClick: () => {\n            rt.push(`/items/detail/${itemid}?active=relationship`);\n            console.log(relitemdatatrigger, reltipeitemdata, relitemdata);\n          },\n          style: {\n            marginRight: `1rem`\n          },\n          size: \"middle\",\n          type: \"danger\",\n          children: \"Batal\"\n        }), /*#__PURE__*/_jsx(_Button, {\n          disabled: disabledrel,\n          onClick: () => {\n            setmodaladd(true);\n          },\n          size: \"middle\",\n          type: \"primary\",\n          children: \"Simpan\"\n        })]\n      })]\n    }), /*#__PURE__*/_jsx(\"div\", {\n      className: \"h-auto w-full grid grid-cols-1 md:grid-cols-5 mb-5 px-8 py-4 bg-white rounded-md\",\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"md:col-span-5 col-span-1 flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"jsx-3560212516\" + \" \" + \"flex flex-col w-full mb-8\",\n          children: [/*#__PURE__*/_jsxs(\"p\", {\n            className: \"jsx-3560212516\" + \" \" + \"mb-1 font-semibold\",\n            children: [\"Relationship Type \", /*#__PURE__*/_jsx(\"span\", {\n              className: \"jsx-3560212516\" + \" \" + \"relitemtambah\"\n            })]\n          }), /*#__PURE__*/_jsx(_Select, {\n            placeholder: \"Pilih Relationship Type\",\n            style: {\n              width: `100%`\n            },\n            allowClear: true,\n            onChange: (value, option) => {\n              setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                relationship_asset_id: typeof value === 'undefined' ? null : value,\n                is_inverse: typeof option === 'undefined' ? null : option.is_inverse\n              }));\n              setreltipeitemdata(typeof option === 'undefined' ? -10 : option.type_id);\n              setreldetailitemdata(typeof option === 'undefined' ? \"\" : option.detail);\n              typeof value === 'undefined' ? setrelitemdata([]) : setrelitemdatatrigger(value);\n            },\n            children: displaydatarelations.map((docmodels, idxmodels) => {\n              return /*#__PURE__*/_jsx(_Select.Option, {\n                value: docmodels.id,\n                type_id: docmodels.type_id,\n                is_inverse: docmodels.is_inverse,\n                detail: docmodels.detail,\n                children: docmodels.detail\n              });\n            })\n          }), displaydatarelations.length < 1 && /*#__PURE__*/_jsxs(\"p\", {\n            className: \"jsx-3560212516\" + \" \" + \"text-red-500 text-sm\",\n            children: [\"Data Relationship Type kosong, silahkan tambah data melalui \", /*#__PURE__*/_jsx(Link, {\n              href: `/admin/assets/detail/${asset_id}?active=relationship`,\n              children: \"Asset Ini\"\n            })]\n          }), /*#__PURE__*/_jsx(_JSXStyle, {\n            id: \"3560212516\",\n            children: [\".relitemtambah.jsx-3560212516::before{content:'*';color:red;}\"]\n          })]\n        }), reltipeitemdata === -1 || reltipeitemdata === -2 ? /*#__PURE__*/_jsx(\"div\", {\n          className: \"flex mb-5\",\n          children: /*#__PURE__*/_jsxs(\"div\", {\n            className: \" w-full mr-1 grid grid-cols-12\",\n            children: [/*#__PURE__*/_jsx(\"div\", {\n              className: \"col-span-11 mr-1\",\n              children: /*#__PURE__*/_jsx(_Input, {\n                style: {\n                  width: `100%`,\n                  marginRight: `0.5rem`\n                },\n                placeholder: \"Cari Nama Item\",\n                onChange: e => onChangeSearch(e),\n                allowClear: true\n              })\n            }), /*#__PURE__*/_jsx(\"div\", {\n              className: \" col-span-1\",\n              children: /*#__PURE__*/_jsx(_Button, {\n                type: \"primary\",\n                style: {\n                  width: `100%`\n                },\n                onClick: onFinalClick,\n                children: /*#__PURE__*/_jsx(SearchOutlined, {})\n              })\n            })]\n          })\n        }) : null, /*#__PURE__*/_jsx(_Table, {\n          rowSelection: {\n            onChange: (selectedRowKeys, selectedRows) => {\n              if (selectedRows.length > 0) {\n                setdisabledrel(false);\n              } else {\n                setdisabledrel(true);\n              }\n\n              setselectedrelitemdata(selectedRows);\n              setnewdata(_objectSpread(_objectSpread({}, newdata), {}, {\n                connected_ids: reltipeitemdata === -1 || reltipeitemdata === -2 ? selectedRows.map(doc => doc.id) : selectedRows.map(doc => doc.id)\n              }));\n            },\n            checkStrictly: true\n          },\n          defaultExpandedRowKeys: [1],\n          pagination: {\n            pageSize: 9\n          },\n          rowKey: reltipeitemdata === -1 || reltipeitemdata === -2 ? \"id\" : \"id\",\n          scroll: {\n            x: 200\n          },\n          dataSource: relitemdata,\n          columns: reltipeitemdata === -1 || reltipeitemdata === -2 ? columns12 : reltipeitemdata === -3 ? columns3 : columns4,\n          loading: relitemloading\n        })]\n      })\n    }), /*#__PURE__*/_jsx(_Modal, {\n      title: /*#__PURE__*/_jsx(_Fragment, {\n        children: \"Apakah Anda yakin ingin menambahkan Relationship ke Item berikut ini?\"\n      }),\n      visible: modaladd,\n      onCancel: () => {\n        setmodaladd(false);\n      },\n      okText: \"Ya\",\n      cancelText: \"Tidak\",\n      onOk: handleAddRelationshipItem,\n      okButtonProps: {\n        loading: loadingadd\n      },\n      width: 700,\n      children: /*#__PURE__*/_jsxs(\"div\", {\n        className: \"flex flex-col\",\n        children: [/*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col border-b mb-5\",\n          children: [/*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex flex-col mb-3\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold mb-0\",\n              children: \"Relationship Type:\"\n            }), /*#__PURE__*/_jsx(\"p\", {\n              className: \"mb-0\",\n              children: reldetailitemdata\n            })]\n          }), /*#__PURE__*/_jsxs(\"div\", {\n            className: \"flex flex-col mb-3\",\n            children: [/*#__PURE__*/_jsx(\"h1\", {\n              className: \"font-semibold mb-0\",\n              children: \"Item:\"\n            }), selectedrelitemdata.map((doc, idx) => /*#__PURE__*/_jsxs(\"p\", {\n              className: \"mb-0\",\n              children: [\"- \", reltipeitemdata === -1 || reltipeitemdata === -2 ? doc.name : reltipeitemdata === -3 ? doc.title : reltipeitemdata === -4 ? doc.inventory_name : null]\n            }))]\n          })]\n        }), /*#__PURE__*/_jsxs(\"div\", {\n          className: \"flex flex-col\",\n          children: [/*#__PURE__*/_jsx(\"p\", {\n            className: \"mb-0\",\n            children: \"Notes\"\n          }), /*#__PURE__*/_jsx(_Input, {\n            placeholder: \"Masukkan Notes\",\n            onChange: e => {// setdataApiremoved({ ...dataApiremoved, notes: e.target.value })\n            }\n          })]\n        })]\n      })\n    })]\n  });\n};\n\nexport async function getServerSideProps({\n  req,\n  res,\n  params\n}) {\n  var initProps = {};\n  const itemid = params.itemId;\n\n  if (!req.headers.cookie) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  const cookiesJSON1 = httpcookie.parse(req.headers.cookie);\n\n  if (!cookiesJSON1.token) {\n    return {\n      redirect: {\n        permanent: false,\n        destination: '/login'\n      }\n    };\n  }\n\n  initProps = cookiesJSON1.token;\n  const resourcesGP = await fetch(`https://boiling-thicket-46501.herokuapp.com/detailProfile`, {\n    method: `GET`,\n    headers: {\n      'Authorization': JSON.parse(initProps)\n    }\n  });\n  const resjsonGP = await resourcesGP.json();\n  const dataProfile = resjsonGP; // if (![107, 108, 109, 110, 111, 112, 132].every((curr) => dataProfile.data.registered_feature.includes(curr))) {\n  //     res.writeHead(302, { Location: '/dashboard/admin' })\n  //     res.end()\n  // }\n\n  return {\n    props: {\n      initProps,\n      dataProfile,\n      sidemenu: \"3\",\n      itemid\n    }\n  };\n}\nexport default CreateRelationshipItem;","map":null,"metadata":{},"sourceType":"module"}